KIDS Distribution saved on Feb 02, 2015@09:20:43
RG UTILITIES 3.
**KIDS**:RG UTILITIES 3.0^

**INSTALL NAME**
RG UTILITIES 3.0
"BLD",8984,0)
RG UTILITIES 3.0^RUN TIME LIBRARY^0^3150202^n
"BLD",8984,1,0)
^^3^3^3150202^^^
"BLD",8984,1,1,0)
This is the set of routines common to all modules occupying the RG namespace.  
"BLD",8984,1,2,0)
They perform generic functions.  
"BLD",8984,1,3,0)
 
"BLD",8984,4,0)
^9.64PA^^
"BLD",8984,6.3)
98
"BLD",8984,"ABNS",0)
^9.66A^1^1
"BLD",8984,"ABNS",1,0)
RG
"BLD",8984,"ABNS",1,1,0)
^9.661A^^
"BLD",8984,"ABNS","B","RG",1)

"BLD",8984,"ABPKG")
n^n
"BLD",8984,"INI")

"BLD",8984,"INIT")
POST^RGUTINIT
"BLD",8984,"KRN",0)
^9.67PA^771^18
"BLD",8984,"KRN",.4,0)
.4
"BLD",8984,"KRN",.4,"NM",0)
^9.68A^^
"BLD",8984,"KRN",.401,0)
.401
"BLD",8984,"KRN",.402,0)
.402
"BLD",8984,"KRN",.403,0)
.403
"BLD",8984,"KRN",.5,0)
.5
"BLD",8984,"KRN",.84,0)
.84
"BLD",8984,"KRN",3.6,0)
3.6
"BLD",8984,"KRN",3.8,0)
3.8
"BLD",8984,"KRN",9.2,0)
9.2
"BLD",8984,"KRN",9.8,0)
9.8
"BLD",8984,"KRN",9.8,"NM",0)
^9.68A^86^52
"BLD",8984,"KRN",9.8,"NM",18,0)
RGUT^^0^B38148711
"BLD",8984,"KRN",9.8,"NM",27,0)
RGUTSTX^^0^B18037383
"BLD",8984,"KRN",9.8,"NM",28,0)
RGUTSTX0^^0^B19756996
"BLD",8984,"KRN",9.8,"NM",29,0)
RGUTSTX1^^0^B21990330
"BLD",8984,"KRN",9.8,"NM",33,0)
RGUTALR^^0^B1394189
"BLD",8984,"KRN",9.8,"NM",34,0)
RGUTBIG^^0^B14928339
"BLD",8984,"KRN",9.8,"NM",35,0)
RGUTDAT^^0^B13607562
"BLD",8984,"KRN",9.8,"NM",36,0)
RGUTDIC^^0^B30172675
"BLD",8984,"KRN",9.8,"NM",37,0)
RGUTDT^^0^B5201713
"BLD",8984,"KRN",9.8,"NM",38,0)
RGUTEDT^^0^B50036890
"BLD",8984,"KRN",9.8,"NM",44,0)
RGUTIMP^^0^B12071934
"BLD",8984,"KRN",9.8,"NM",45,0)
RGUTIN^^1^
"BLD",8984,"KRN",9.8,"NM",46,0)
RGUTIN0^^0^B1456400
"BLD",8984,"KRN",9.8,"NM",47,0)
RGUTIN16^^0^B4324901
"BLD",8984,"KRN",9.8,"NM",48,0)
RGUTIN18^^0^B4545277
"BLD",8984,"KRN",9.8,"NM",49,0)
RGUTIN8^^0^B4187174
"BLD",8984,"KRN",9.8,"NM",50,0)
RGUTLK2^^0^B51777461
"BLD",8984,"KRN",9.8,"NM",51,0)
RGUTLKP^^0^B29106476
"BLD",8984,"KRN",9.8,"NM",52,0)
RGUTMTL^^0^B15092004
"BLD",8984,"KRN",9.8,"NM",53,0)
RGUTOS^^0^B7841558
"BLD",8984,"KRN",9.8,"NM",54,0)
RGUTOS1^^0^B10411038
"BLD",8984,"KRN",9.8,"NM",56,0)
RGUTRPC^^0^B16812427
"BLD",8984,"KRN",9.8,"NM",57,0)
RGUTTSK^^0^B1046191
"BLD",8984,"KRN",9.8,"NM",58,0)
RGUTUSR^^0^B4180510
"BLD",8984,"KRN",9.8,"NM",59,0)
RGUTUU^^0^B2050600
"BLD",8984,"KRN",9.8,"NM",60,0)
RGUTINIT^^0^B6026117
"BLD",8984,"KRN",9.8,"NM",61,0)
RGUTHFS^^0^B5078426
"BLD",8984,"KRN",9.8,"NM",62,0)
RGUTDDR^^0^B59431447
"BLD",8984,"KRN",9.8,"NM",63,0)
RGUTRPRT^^0^B2852241
"BLD",8984,"KRN",9.8,"NM",64,0)
RGUTREG^^0^B709436
"BLD",8984,"KRN",9.8,"NM",65,0)
RGUTBC28^^0^B10811663
"BLD",8984,"KRN",9.8,"NM",66,0)
RGUTBC39^^0^B7717700
"BLD",8984,"KRN",9.8,"NM",67,0)
RGUTBCDA^^0^B8230455
"BLD",8984,"KRN",9.8,"NM",68,0)
RGUTIN8U^^1^
"BLD",8984,"KRN",9.8,"NM",69,0)
RGUTIN68^^0^B4493128
"BLD",8984,"KRN",9.8,"NM",70,0)
RGUTIN58^^0^B5603465
"BLD",8984,"KRN",9.8,"NM",71,0)
RGUT1^^0^B812698
"BLD",8984,"KRN",9.8,"NM",72,0)
RGUTNTEG^^0^B4457644
"BLD",8984,"KRN",9.8,"NM",73,0)
RGXY^^1^
"BLD",8984,"KRN",9.8,"NM",74,0)
RGZOSF^^1^
"BLD",8984,"KRN",9.8,"NM",75,0)
RGCVTDT^^1^
"BLD",8984,"KRN",9.8,"NM",76,0)
RGCVTUU^^1^
"BLD",8984,"KRN",9.8,"NM",77,0)
RGINIT^^1^
"BLD",8984,"KRN",9.8,"NM",78,0)
RGMSCALR^^1^
"BLD",8984,"KRN",9.8,"NM",79,0)
RGMSCDAT^^1^
"BLD",8984,"KRN",9.8,"NM",80,0)
RGMSCDIC^^1^
"BLD",8984,"KRN",9.8,"NM",81,0)
RGMSCEDT^^1^
"BLD",8984,"KRN",9.8,"NM",82,0)
RGMSCIMP^^1^
"BLD",8984,"KRN",9.8,"NM",83,0)
RGMSCLKP^^1^
"BLD",8984,"KRN",9.8,"NM",84,0)
RGMSCMTL^^1^
"BLD",8984,"KRN",9.8,"NM",85,0)
RGMSCTSK^^1^
"BLD",8984,"KRN",9.8,"NM",86,0)
RGMSCUSR^^1^
"BLD",8984,"KRN",9.8,"NM","B","RGCVTDT",75)

"BLD",8984,"KRN",9.8,"NM","B","RGCVTUU",76)

"BLD",8984,"KRN",9.8,"NM","B","RGINIT",77)

"BLD",8984,"KRN",9.8,"NM","B","RGMSCALR",78)

"BLD",8984,"KRN",9.8,"NM","B","RGMSCDAT",79)

"BLD",8984,"KRN",9.8,"NM","B","RGMSCDIC",80)

"BLD",8984,"KRN",9.8,"NM","B","RGMSCEDT",81)

"BLD",8984,"KRN",9.8,"NM","B","RGMSCIMP",82)

"BLD",8984,"KRN",9.8,"NM","B","RGMSCLKP",83)

"BLD",8984,"KRN",9.8,"NM","B","RGMSCMTL",84)

"BLD",8984,"KRN",9.8,"NM","B","RGMSCTSK",85)

"BLD",8984,"KRN",9.8,"NM","B","RGMSCUSR",86)

"BLD",8984,"KRN",9.8,"NM","B","RGUT",18)

"BLD",8984,"KRN",9.8,"NM","B","RGUT1",71)

"BLD",8984,"KRN",9.8,"NM","B","RGUTALR",33)

"BLD",8984,"KRN",9.8,"NM","B","RGUTBC28",65)

"BLD",8984,"KRN",9.8,"NM","B","RGUTBC39",66)

"BLD",8984,"KRN",9.8,"NM","B","RGUTBCDA",67)

"BLD",8984,"KRN",9.8,"NM","B","RGUTBIG",34)

"BLD",8984,"KRN",9.8,"NM","B","RGUTDAT",35)

"BLD",8984,"KRN",9.8,"NM","B","RGUTDDR",62)

"BLD",8984,"KRN",9.8,"NM","B","RGUTDIC",36)

"BLD",8984,"KRN",9.8,"NM","B","RGUTDT",37)

"BLD",8984,"KRN",9.8,"NM","B","RGUTEDT",38)

"BLD",8984,"KRN",9.8,"NM","B","RGUTHFS",61)

"BLD",8984,"KRN",9.8,"NM","B","RGUTIMP",44)

"BLD",8984,"KRN",9.8,"NM","B","RGUTIN",45)

"BLD",8984,"KRN",9.8,"NM","B","RGUTIN0",46)

"BLD",8984,"KRN",9.8,"NM","B","RGUTIN16",47)

"BLD",8984,"KRN",9.8,"NM","B","RGUTIN18",48)

"BLD",8984,"KRN",9.8,"NM","B","RGUTIN58",70)

"BLD",8984,"KRN",9.8,"NM","B","RGUTIN68",69)

"BLD",8984,"KRN",9.8,"NM","B","RGUTIN8",49)

"BLD",8984,"KRN",9.8,"NM","B","RGUTIN8U",68)

"BLD",8984,"KRN",9.8,"NM","B","RGUTINIT",60)

"BLD",8984,"KRN",9.8,"NM","B","RGUTLK2",50)

"BLD",8984,"KRN",9.8,"NM","B","RGUTLKP",51)

"BLD",8984,"KRN",9.8,"NM","B","RGUTMTL",52)

"BLD",8984,"KRN",9.8,"NM","B","RGUTNTEG",72)

"BLD",8984,"KRN",9.8,"NM","B","RGUTOS",53)

"BLD",8984,"KRN",9.8,"NM","B","RGUTOS1",54)

"BLD",8984,"KRN",9.8,"NM","B","RGUTREG",64)

"BLD",8984,"KRN",9.8,"NM","B","RGUTRPC",56)

"BLD",8984,"KRN",9.8,"NM","B","RGUTRPRT",63)

"BLD",8984,"KRN",9.8,"NM","B","RGUTSTX",27)

"BLD",8984,"KRN",9.8,"NM","B","RGUTSTX0",28)

"BLD",8984,"KRN",9.8,"NM","B","RGUTSTX1",29)

"BLD",8984,"KRN",9.8,"NM","B","RGUTTSK",57)

"BLD",8984,"KRN",9.8,"NM","B","RGUTUSR",58)

"BLD",8984,"KRN",9.8,"NM","B","RGUTUU",59)

"BLD",8984,"KRN",9.8,"NM","B","RGXY",73)

"BLD",8984,"KRN",9.8,"NM","B","RGZOSF",74)

"BLD",8984,"KRN",19,0)
19
"BLD",8984,"KRN",19,"NM",0)
^9.68A^^0
"BLD",8984,"KRN",19.1,0)
19.1
"BLD",8984,"KRN",101,0)
101
"BLD",8984,"KRN",409.61,0)
409.61
"BLD",8984,"KRN",771,0)
771
"BLD",8984,"KRN",869.2,0)
869.2
"BLD",8984,"KRN",870,0)
870
"BLD",8984,"KRN",8994,0)
8994
"BLD",8984,"KRN",8994,"NM",0)
^9.68A^11^11
"BLD",8984,"KRN",8994,"NM",1,0)
RGUTRPC DIC^^0
"BLD",8984,"KRN",8994,"NM",2,0)
RGUTRPC FILENT^^0
"BLD",8984,"KRN",8994,"NM",3,0)
RGUTRPC FILNXT^^0
"BLD",8984,"KRN",8994,"NM",4,0)
RGUTRPC MSYNTAX^^0
"BLD",8984,"KRN",8994,"NM",5,0)
RGUTDDR GETDD^^0
"BLD",8984,"KRN",8994,"NM",6,0)
RGUTDDR LOCK^^0
"BLD",8984,"KRN",8994,"NM",7,0)
RGUTDDR MOVETO^^0
"BLD",8984,"KRN",8994,"NM",8,0)
RGUTRPC FILGET^^0
"BLD",8984,"KRN",8994,"NM",9,0)
RGUTDDR CVTPTR^^0
"BLD",8984,"KRN",8994,"NM",10,0)
RGUTRPC STRTODAT^^0
"BLD",8984,"KRN",8994,"NM",11,0)
RGUTDDR FIND^^0
"BLD",8984,"KRN",8994,"NM","B","RGUTDDR CVTPTR",9)

"BLD",8984,"KRN",8994,"NM","B","RGUTDDR FIND",11)

"BLD",8984,"KRN",8994,"NM","B","RGUTDDR GETDD",5)

"BLD",8984,"KRN",8994,"NM","B","RGUTDDR LOCK",6)

"BLD",8984,"KRN",8994,"NM","B","RGUTDDR MOVETO",7)

"BLD",8984,"KRN",8994,"NM","B","RGUTRPC DIC",1)

"BLD",8984,"KRN",8994,"NM","B","RGUTRPC FILENT",2)

"BLD",8984,"KRN",8994,"NM","B","RGUTRPC FILGET",8)

"BLD",8984,"KRN",8994,"NM","B","RGUTRPC FILNXT",3)

"BLD",8984,"KRN",8994,"NM","B","RGUTRPC MSYNTAX",4)

"BLD",8984,"KRN",8994,"NM","B","RGUTRPC STRTODAT",10)

"BLD",8984,"KRN","B",.4,.4)

"BLD",8984,"KRN","B",.401,.401)

"BLD",8984,"KRN","B",.402,.402)

"BLD",8984,"KRN","B",.403,.403)

"BLD",8984,"KRN","B",.5,.5)

"BLD",8984,"KRN","B",.84,.84)

"BLD",8984,"KRN","B",3.6,3.6)

"BLD",8984,"KRN","B",3.8,3.8)

"BLD",8984,"KRN","B",9.2,9.2)

"BLD",8984,"KRN","B",9.8,9.8)

"BLD",8984,"KRN","B",19,19)

"BLD",8984,"KRN","B",19.1,19.1)

"BLD",8984,"KRN","B",101,101)

"BLD",8984,"KRN","B",409.61,409.61)

"BLD",8984,"KRN","B",771,771)

"BLD",8984,"KRN","B",869.2,869.2)

"BLD",8984,"KRN","B",870,870)

"BLD",8984,"KRN","B",8994,8994)

"BLD",8984,"QUES",0)
^9.62^^
"BLD",8984,"REQB",0)
^9.611^^
"INIT")
POST^RGUTINIT
"KRN",8994,3491,-1)
0^1
"KRN",8994,3491,0)
RGUTRPC DIC^DIC^RGUTRPC^2
"KRN",8994,3491,1,0)
^^1^1^3050820.204817
"KRN",8994,3491,1,1,0)
Encapsulates RGUTDIC call for broker.
"KRN",8994,3491,2,0)
^8994.02A^3^3
"KRN",8994,3491,2,1,0)
BOOKMARK^1^255^1^1
"KRN",8994,3491,2,2,0)
COMMAND^1^255^1^2
"KRN",8994,3491,2,3,0)
ARG^1^255^0^3
"KRN",8994,3491,2,"B","ARG",3)

"KRN",8994,3491,2,"B","BOOKMARK",1)

"KRN",8994,3491,2,"B","COMMAND",2)

"KRN",8994,3491,2,"PARAMSEQ",1,1)

"KRN",8994,3491,2,"PARAMSEQ",2,2)

"KRN",8994,3491,2,"PARAMSEQ",3,3)

"KRN",8994,3492,-1)
0^2
"KRN",8994,3492,0)
RGUTRPC FILENT^FILENT^RGUTRPC^4^^^^1
"KRN",8994,3492,1,0)
^8994.01^1^1^3000107^^^^
"KRN",8994,3492,1,1,0)
Returns list of entries in a file.
"KRN",8994,3492,2,0)
^8994.02A^1^1
"KRN",8994,3492,2,1,0)
FILE NUMBER^1^250^1^1
"KRN",8994,3492,2,"B","FILE NUMBER",1)

"KRN",8994,3492,2,"PARAMSEQ",1,1)

"KRN",8994,3493,-1)
0^4
"KRN",8994,3493,0)
RGUTRPC MSYNTAX^MSYNTAX^RGUTRPC^1
"KRN",8994,3493,1,0)
^8994.01^1^1^2970922.224252
"KRN",8994,3493,1,1,0)
Performs syntax check on line of M code.
"KRN",8994,3493,2,0)
^8994.02A^2^2
"KRN",8994,3493,2,1,0)
CODE^1^255^1^1
"KRN",8994,3493,2,2,0)
OPTION^1^255^0^2
"KRN",8994,3493,2,"B","CODE",1)

"KRN",8994,3493,2,"B","OPTION",2)

"KRN",8994,3493,2,"PARAMSEQ",1,1)

"KRN",8994,3493,2,"PARAMSEQ",2,2)

"KRN",8994,3494,-1)
0^3
"KRN",8994,3494,0)
RGUTRPC FILNXT^FILNXT^RGUTRPC^1
"KRN",8994,3494,2,0)
^8994.02A^2^2
"KRN",8994,3494,2,1,0)
FILE NUMBER^1^100^1^1
"KRN",8994,3494,2,2,0)
IEN^1^100^1^2
"KRN",8994,3494,2,"B","FILE NUMBER",1)

"KRN",8994,3494,2,"B","IEN",2)

"KRN",8994,3494,2,"PARAMSEQ",1,1)

"KRN",8994,3494,2,"PARAMSEQ",2,2)

"KRN",8994,3495,-1)
0^5
"KRN",8994,3495,0)
RGUTDDR GETDD^GETDD^RGUTDDR^4^^^^1
"KRN",8994,3496,-1)
0^6
"KRN",8994,3496,0)
RGUTDDR LOCK^LOCK^RGUTDDR^1
"KRN",8994,3497,-1)
0^7
"KRN",8994,3497,0)
RGUTDDR MOVETO^MOVETO^RGUTDDR^1
"KRN",8994,3498,-1)
0^8
"KRN",8994,3498,0)
RGUTRPC FILGET^FILGET^RGUTRPC^4^^^^1
"KRN",8994,3499,-1)
0^9
"KRN",8994,3499,0)
RGUTDDR CVTPTR^CVTPTR^RGUTDDR^1
"KRN",8994,3500,-1)
0^10
"KRN",8994,3500,0)
RGUTRPC STRTODAT^STRTODAT^RGUTRPC^1
"KRN",8994,3500,1,0)
^^1^1^3040313.081942
"KRN",8994,3500,1,1,0)
Converts a date in external format to internal FileMan date format.
"KRN",8994,3501,-1)
0^11
"KRN",8994,3501,0)
RGUTDDR FIND^FIND^RGUTDDR^4^^^^1
"MBREQ")
0
"ORD",0,9.8)
9.8;;1;RTNF^XPDTA;RTNE^XPDTA
"ORD",0,9.8,0)
ROUTINE
"ORD",16,8994)
8994;16;1;;;;;;;RPCDEL^XPDIA1
"ORD",16,8994,0)
REMOTE PROCEDURE
"PKG",535,-1)
1^1
"PKG",535,0)
RUN TIME LIBRARY^RGUT^RUN TIME LIBRARY
"PKG",535,20,0)
^9.402P^^
"PKG",535,22,0)
^9.49I^1^1
"PKG",535,22,1,0)
3.0^3150202^3150202^1
"PKG",535,22,1,1,0)
^^3^3^3150202
"PKG",535,22,1,1,1,0)
This is the set of routines common to all modules occupying the RG namespace.  
"PKG",535,22,1,1,2,0)
They perform generic functions.  
"PKG",535,22,1,1,3,0)
 
"PKG",535,"VERSION")
3.0
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
NO
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
52
"RTN","RGCVTDT")
1^75
"RTN","RGCVTUU")
1^76
"RTN","RGINIT")
1^77
"RTN","RGMSCALR")
1^78
"RTN","RGMSCDAT")
1^79
"RTN","RGMSCDIC")
1^80
"RTN","RGMSCEDT")
1^81
"RTN","RGMSCIMP")
1^82
"RTN","RGMSCLKP")
1^83
"RTN","RGMSCMTL")
1^84
"RTN","RGMSCTSK")
1^85
"RTN","RGMSCUSR")
1^86
"RTN","RGUT")
0^18^B38148711
"RTN","RGUT",1,0)
RGUT ;RG/IND/DKM - General purpose utilities;20-Jan-2015 13:23;DKM
"RTN","RGUT",2,0)
 ;;3.0;RG UTILITIES;**1**;Mar 20, 2007;Build 98
"RTN","RGUT",3,0)
 ;;
"RTN","RGUT",4,0)
 ;=================================================================
"RTN","RGUT",5,0)
 ; Replaces delimited arguments in string, returning result
"RTN","RGUT",6,0)
MSG(%CIATXT,%CIADLM,%CIARPL) ;EP
"RTN","RGUT",7,0)
 N %CIAZ1,%CIAZ2
"RTN","RGUT",8,0)
 I $$NEWERR^%ZTER N $ET S $ET=""
"RTN","RGUT",9,0)
 S:$G(%CIADLM)="" %CIADLM="%"
"RTN","RGUT",10,0)
 S %CIAZ2="",@$$TRAP^RGUTOS("M1^RGUT")
"RTN","RGUT",11,0)
 S:$G(%CIARPL,1) %CIATXT=$TR(%CIATXT,"~","^")
"RTN","RGUT",12,0)
 F  Q:%CIATXT=""  D
"RTN","RGUT",13,0)
 .S %CIAZ2=%CIAZ2_$P(%CIATXT,%CIADLM),%CIAZ1=$P(%CIATXT,%CIADLM,2),%CIATXT=$P(%CIATXT,%CIADLM,3,999)
"RTN","RGUT",14,0)
 .I %CIAZ1="" S:%CIATXT'="" %CIAZ2=%CIAZ2_%CIADLM
"RTN","RGUT",15,0)
 .E  X "S %CIAZ2=%CIAZ2_("_%CIAZ1_")"
"RTN","RGUT",16,0)
M1 Q %CIAZ2
"RTN","RGUT",17,0)
 ; Case-insensitive string comparison
"RTN","RGUT",18,0)
 ; Returns 0: X=Y, 1: X>Y, -1: X<Y
"RTN","RGUT",19,0)
STRICMP(X,Y) ;EP
"RTN","RGUT",20,0)
 S X=$$UP^XLFSTR(X),Y=$$UP^XLFSTR(Y)
"RTN","RGUT",21,0)
 Q $S(X=Y:0,X]]Y:1,1:-1)
"RTN","RGUT",22,0)
 ; Output an underline X bytes long
"RTN","RGUT",23,0)
UND(X) ;EP
"RTN","RGUT",24,0)
 Q $$REPEAT^XLFSTR("-",$G(X,$G(IOM,80)))
"RTN","RGUT",25,0)
 ; Truncate a string if > Y bytes long
"RTN","RGUT",26,0)
TRUNC(X,Y) ;EP
"RTN","RGUT",27,0)
 Q $S($L(X)'>Y:X,1:$E(X,1,Y-3)_"...")
"RTN","RGUT",28,0)
 ; Formatting for singular/plural
"RTN","RGUT",29,0)
SNGPLR(CIANUM,CIASNG,CIAPLR) ;EP
"RTN","RGUT",30,0)
 N CIAZ
"RTN","RGUT",31,0)
 S CIAZ=CIASNG?.E1L.E,CIAPLR=$G(CIAPLR,CIASNG_$S(CIAZ:"s",1:"S"))
"RTN","RGUT",32,0)
 Q $S('CIANUM:$S(CIAZ:"no ",1:"NO ")_CIAPLR,CIANUM=1:"1 "_CIASNG,1:CIANUM_" "_CIAPLR)
"RTN","RGUT",33,0)
 ; Convert code to external form from set of codes
"RTN","RGUT",34,0)
SET(CIACODE,CIASET) ;EP
"RTN","RGUT",35,0)
 N CIAZ,CIAZ1
"RTN","RGUT",36,0)
 F CIAZ=1:1:$L(CIASET,";") D  Q:CIAZ1'=""
"RTN","RGUT",37,0)
 .S CIAZ1=$P(CIASET,";",CIAZ),CIAZ1=$S($P(CIAZ1,":")=CIACODE:$P(CIAZ1,":",2),1:"")
"RTN","RGUT",38,0)
 Q CIAZ1
"RTN","RGUT",39,0)
 ; Replace each occurrence of CIAOLD in CIASTR with CIANEW
"RTN","RGUT",40,0)
SUBST(CIASTR,CIAOLD,CIANEW) ;EP
"RTN","RGUT",41,0)
 N CIAP,CIAL1,CIAL2
"RTN","RGUT",42,0)
 S CIANEW=$G(CIANEW),CIAP=0,CIAL1=$L(CIAOLD),CIAL2=$L(CIANEW)
"RTN","RGUT",43,0)
 F  S CIAP=$F(CIASTR,CIAOLD,CIAP) Q:'CIAP  D
"RTN","RGUT",44,0)
 .S CIASTR=$E(CIASTR,1,CIAP-CIAL1-1)_CIANEW_$E(CIASTR,CIAP,9999)
"RTN","RGUT",45,0)
 .S CIAP=CIAP-CIAL1+CIAL2
"RTN","RGUT",46,0)
 Q CIASTR
"RTN","RGUT",47,0)
 ; Trim leading (Y=-1)/trailing (Y=1)/leading & trailing (Y=0) spaces
"RTN","RGUT",48,0)
TRIM(X,Y) ;EP
"RTN","RGUT",49,0)
 N CIAZ1,CIAZ2
"RTN","RGUT",50,0)
 S Y=+$G(Y),CIAZ1=1,CIAZ2=$L(X)
"RTN","RGUT",51,0)
 I Y'>0 F CIAZ1=1:1 Q:$A(X,CIAZ1)'=32
"RTN","RGUT",52,0)
 I Y'<0 F CIAZ2=CIAZ2:-1 Q:$A(X,CIAZ2)'=32
"RTN","RGUT",53,0)
 Q $E(X,CIAZ1,CIAZ2)
"RTN","RGUT",54,0)
 ; Format a number with commas
"RTN","RGUT",55,0)
FMTNUM(CIANUM) ;EP
"RTN","RGUT",56,0)
 N CIAZ,CIAZ1,CIAZ2,CIAZ3
"RTN","RGUT",57,0)
 S:CIANUM<0 CIANUM=-CIANUM,CIAZ2="-"
"RTN","RGUT",58,0)
 S CIAZ3=CIANUM#1,CIANUM=CIANUM\1
"RTN","RGUT",59,0)
 F CIAZ=$L(CIANUM):-3:1 S CIAZ1=$E(CIANUM,CIAZ-2,CIAZ)_$S($D(CIAZ1):","_CIAZ1,1:"")
"RTN","RGUT",60,0)
 Q $G(CIAZ2)_$G(CIAZ1)_$S(CIAZ3:CIAZ3,1:"")
"RTN","RGUT",61,0)
 ; Convert X to base Y padded to length L
"RTN","RGUT",62,0)
BASE(X,Y,L) ;EP
"RTN","RGUT",63,0)
 Q:(Y<2)!(Y>62) ""
"RTN","RGUT",64,0)
 N CIAZ,CIAZ1
"RTN","RGUT",65,0)
 S CIAZ1="",X=$S(X<0:-X,1:X)
"RTN","RGUT",66,0)
 F  S CIAZ=X#Y,X=X\Y,CIAZ1=$C($S(CIAZ<10:CIAZ+48,CIAZ<36:CIAZ+55,1:CIAZ+61))_CIAZ1 Q:'X
"RTN","RGUT",67,0)
 Q $S('$G(L):CIAZ1,1:$$REPEAT^XLFSTR(0,L-$L(CIAZ1))_$E(CIAZ1,1,L))
"RTN","RGUT",68,0)
 ; Convert a string to its SOUNDEX equivalent
"RTN","RGUT",69,0)
SOUNDEX(CIAVALUE) ;EP
"RTN","RGUT",70,0)
 N CIACODE,CIASOUND,CIAPREV,CIACHAR,CIAPOS,CIATRANS
"RTN","RGUT",71,0)
 S CIACODE="01230129022455012623019202"
"RTN","RGUT",72,0)
 S CIASOUND=$C($A(CIAVALUE)-(CIAVALUE?1L.E*32))
"RTN","RGUT",73,0)
 S CIAPREV=$E(CIACODE,$A(CIAVALUE)-64)
"RTN","RGUT",74,0)
 F CIAPOS=2:1 S CIACHAR=$E(CIAVALUE,CIAPOS) Q:","[CIACHAR  D  Q:$L(CIASOUND)=4
"RTN","RGUT",75,0)
 .Q:CIACHAR'?1A
"RTN","RGUT",76,0)
 .S CIATRANS=$E(CIACODE,$A(CIACHAR)-$S(CIACHAR?1U:64,1:96))
"RTN","RGUT",77,0)
 .Q:CIATRANS=CIAPREV!(CIATRANS=9)
"RTN","RGUT",78,0)
 .S CIAPREV=CIATRANS
"RTN","RGUT",79,0)
 .S:CIATRANS'=0 CIASOUND=CIASOUND_CIATRANS
"RTN","RGUT",80,0)
 Q $E(CIASOUND_"000",1,4)
"RTN","RGUT",81,0)
 ; Display formatted title
"RTN","RGUT",82,0)
TITLE(CIATTL,CIAVER,CIAFN) ;EP
"RTN","RGUT",83,0)
 I '$D(IOM) N IOM,IOF S IOM=80,IOF="#"
"RTN","RGUT",84,0)
 S CIAVER=$G(CIAVER,"1.0")
"RTN","RGUT",85,0)
 S:CIAVER CIAVER="Version "_CIAVER
"RTN","RGUT",86,0)
 U $G(IO,$I)
"RTN","RGUT",87,0)
 W @IOF,$S(IO=IO(0):$C(27,91,55,109),1:""),*13,$$ENTRY^RGUTDT(+$H_","),?(IOM-$L(CIATTL)\2),CIATTL,?(IOM-$L(CIAVER)),CIAVER,!,$S(IO=IO(0):$C(27,91,109),1:$$UND),!
"RTN","RGUT",88,0)
 W:$D(CIAFN) ?(IOM-$L(CIAFN)\2),CIAFN,!
"RTN","RGUT",89,0)
 Q
"RTN","RGUT",90,0)
 ; Display required header for menus
"RTN","RGUT",91,0)
MNUHDR(PKG,VER) ;EP
"RTN","RGUT",92,0)
 Q:$D(ZTQUEUED)
"RTN","RGUT",93,0)
 Q:$E($G(IOST),1,2)'="C-"
"RTN","RGUT",94,0)
 N X,%ZIS,IORVON,IORVOFF,MNU
"RTN","RGUT",95,0)
 S MNU=$P($G(XQY0),U,2),MNU(0)=$P($G(XQY0),U),VER=$G(VER)
"RTN","RGUT",96,0)
 S X=$$GETPKG($S($L($G(PKG)):PKG,1:MNU(0)))
"RTN","RGUT",97,0)
 I $L(X) D
"RTN","RGUT",98,0)
 .S PKG=$P(X,U,2),X=$P(X,U,3)
"RTN","RGUT",99,0)
 .I $L(X),'$L(VER) S VER=$$VERSION^XPDUTL(X)
"RTN","RGUT",100,0)
 S:VER VER="Version "_VER
"RTN","RGUT",101,0)
 S X="IORVON;IORVOFF"
"RTN","RGUT",102,0)
 D ENDR^%ZISS
"RTN","RGUT",103,0)
 U IO
"RTN","RGUT",104,0)
 W @IOF,IORVON,$$GET1^DIQ(4,DUZ(2),.01),?(IOM-$L(PKG)\2),PKG,?(IOM-$L(VER)),VER,!,IORVOFF,!?(IOM-$L(MNU)\2),MNU,!
"RTN","RGUT",105,0)
 Q
"RTN","RGUT",106,0)
 ; Execute menu action, preserving menu headers
"RTN","RGUT",107,0)
MNUEXEC(EXEC,PAUSE) ;EP
"RTN","RGUT",108,0)
 D MNUHDR()
"RTN","RGUT",109,0)
 X EXEC
"RTN","RGUT",110,0)
 R:$G(PAUSE)&'$D(ZTQUEUED) !,"Press ENTER or RETURN to continue...",PAUSE:$G(DTIME,300),!
"RTN","RGUT",111,0)
 Q
"RTN","RGUT",112,0)
 ; Action for editing parameters from menu
"RTN","RGUT",113,0)
MNUPARAM(PARAM) ;EP
"RTN","RGUT",114,0)
 D MNUEXEC("D EDITPAR^XPAREDIT($G(PARAM,$P(XQY0,U)))")
"RTN","RGUT",115,0)
 Q
"RTN","RGUT",116,0)
 ; Action for editing parameter template from menu
"RTN","RGUT",117,0)
MNUTEMPL(TMPL) ;EP
"RTN","RGUT",118,0)
 D MNUEXEC("D TEDH^XPAREDIT($G(TMPL,$P(XQY0,U)),""BA"")")
"RTN","RGUT",119,0)
 Q
"RTN","RGUT",120,0)
 ; Return package reference from namespace
"RTN","RGUT",121,0)
 ; Returns ien^pkg name^pkg namespace
"RTN","RGUT",122,0)
GETPKG(NAME) ;EP
"RTN","RGUT",123,0)
 N PKG,IEN
"RTN","RGUT",124,0)
 S PKG=NAME
"RTN","RGUT",125,0)
 F  S PKG=$O(^DIC(9.4,"C",PKG),-1) Q:$E(NAME,1,$L(PKG))=PKG
"RTN","RGUT",126,0)
 S IEN=$S($L(PKG):+$O(^DIC(9.4,"C",PKG,0)),1:0)
"RTN","RGUT",127,0)
 Q $S(IEN:IEN_U_$P(^DIC(9.4,IEN,0),U)_U_PKG,1:"")
"RTN","RGUT",128,0)
 ; Create a unique 8.3 filename
"RTN","RGUT",129,0)
UFN(Y) ;EP
"RTN","RGUT",130,0)
 N X
"RTN","RGUT",131,0)
 S Y=$E($G(Y),1,3),X=$$BASE($R(100)_$J_$TR($H,","),36,$S($L(Y):8,1:11))_Y
"RTN","RGUT",132,0)
 Q $E(X,1,8)_"."_$E(X,9,11)
"RTN","RGUT",133,0)
 ; Return formatted SSN
"RTN","RGUT",134,0)
SSN(X) ;EP
"RTN","RGUT",135,0)
 Q $S(X="":X,1:$E(X,1,3)_"-"_$E(X,4,5)_"-"_$E(X,6,12))
"RTN","RGUT",136,0)
 ; Performs security check on patient access
"RTN","RGUT",137,0)
DGSEC(Y) ;EP
"RTN","RGUT",138,0)
 N DIC
"RTN","RGUT",139,0)
 S DIC(0)="E"
"RTN","RGUT",140,0)
 D ^DGSEC
"RTN","RGUT",141,0)
 Q $S(Y<1:0,1:Y)
"RTN","RGUT",142,0)
 ; Displays spinning icon to indicate progress
"RTN","RGUT",143,0)
WORKING(CIAST,CIAP,CIAS) ;EP
"RTN","RGUT",144,0)
 Q:'$D(IO(0))!$D(ZTQUEUED) 0
"RTN","RGUT",145,0)
 N CIAZ
"RTN","RGUT",146,0)
 S CIAZ(0)=$I,CIAS=$G(CIAS,"|/-\"),CIAST=+$G(CIAST)
"RTN","RGUT",147,0)
 S CIAST=$S(CIAST<0:0,1:CIAST#$L(CIAS)+1)
"RTN","RGUT",148,0)
 U IO(0)
"RTN","RGUT",149,0)
 W:'$G(CIAP) *8,*$S(CIAST:$A(CIAS,CIAST),1:32)
"RTN","RGUT",150,0)
 R *CIAZ:0
"RTN","RGUT",151,0)
 U CIAZ(0)
"RTN","RGUT",152,0)
 Q CIAZ=94
"RTN","RGUT",153,0)
 ; Ask for Y/N response
"RTN","RGUT",154,0)
ASK(CIAP,CIAD,CIAZ) ;EP
"RTN","RGUT",155,0)
 S CIAD=$G(CIAD,"N")
"RTN","RGUT",156,0)
 S CIAZ=$$GETCH(CIAP_"? ","YN",,,,CIAD)
"RTN","RGUT",157,0)
 S:CIAZ="" CIAZ=$E(CIAD)
"RTN","RGUT",158,0)
 W !
"RTN","RGUT",159,0)
 Q $S(CIAZ[U:"",1:CIAZ="Y")
"RTN","RGUT",160,0)
 ; Pause for user response
"RTN","RGUT",161,0)
PAUSE(CIAP,CIAX,CIAY) ;EP
"RTN","RGUT",162,0)
 Q $$GETCH($G(CIAP,"Press RETURN or ENTER to continue..."),U,.CIAX,.CIAY)
"RTN","RGUT",163,0)
 ; Single character read
"RTN","RGUT",164,0)
GETCH(CIAP,CIAV,CIAX,CIAY,CIAT,CIAD) ;EP
"RTN","RGUT",165,0)
 N CIAZ,CIAC
"RTN","RGUT",166,0)
 W:$D(CIAX)!$D(CIAY) $$XY($G(CIAX,$X),$G(CIAY,$Y))
"RTN","RGUT",167,0)
 W $G(CIAP),$E($G(CIAD)_" "),*8
"RTN","RGUT",168,0)
 S CIAT=$G(CIAT,$G(DTIME,999999)),CIAD=$G(CIAD,U),CIAC=""
"RTN","RGUT",169,0)
 S:$D(CIAV) CIAV=$$UP^XLFSTR(CIAV)_U
"RTN","RGUT",170,0)
 F  D  Q:'$L(CIAZ)
"RTN","RGUT",171,0)
 .R CIAZ#1:CIAT
"RTN","RGUT",172,0)
 .E  S CIAC=CIAD Q
"RTN","RGUT",173,0)
 .W *8
"RTN","RGUT",174,0)
 .Q:'$L(CIAZ)
"RTN","RGUT",175,0)
 .S CIAZ=$$UP^XLFSTR(CIAZ)
"RTN","RGUT",176,0)
 .I $D(CIAV) D
"RTN","RGUT",177,0)
 ..I CIAV[CIAZ S CIAC=CIAZ
"RTN","RGUT",178,0)
 ..E  W *7,*32,*8 S CIAC=""
"RTN","RGUT",179,0)
 .E  S CIAC=CIAZ
"RTN","RGUT",180,0)
 W !
"RTN","RGUT",181,0)
 Q CIAC
"RTN","RGUT",182,0)
 ; Position cursor
"RTN","RGUT",183,0)
XY(DX,DY) ;EP
"RTN","RGUT",184,0)
 D:$G(IOXY)="" HOME^%ZIS
"RTN","RGUT",185,0)
 S DX=$S(+$G(DX)>0:+DX,1:0),DY=$S(+$G(DY)>0:+DY,1:0),$X=0
"RTN","RGUT",186,0)
 X IOXY
"RTN","RGUT",187,0)
 S $X=DX,$Y=DY
"RTN","RGUT",188,0)
 Q ""
"RTN","RGUT",189,0)
 ; Parameterized calls to date routines
"RTN","RGUT",190,0)
DT(CIAD,CIAX) ;EP
"RTN","RGUT",191,0)
 N %D,%P,%C,%H,%I,%X,%Y,CIAZ
"RTN","RGUT",192,0)
 D DT^DILF($G(CIAX),CIAD,.CIAZ)
"RTN","RGUT",193,0)
 W:$D(CIAZ(0)) CIAZ(0),!
"RTN","RGUT",194,0)
 Q $G(CIAZ,-1)
"RTN","RGUT",195,0)
DTC(X1,X2) ;EP
"RTN","RGUT",196,0)
 N X3
"RTN","RGUT",197,0)
 S X2=$$DTF(X1)+X2,X1=X1\1,X3=X2\1,X2=X2-X3
"RTN","RGUT",198,0)
 S:X2<0 X3=X3-1,X2=X2+1
"RTN","RGUT",199,0)
 Q $$FMADD^XLFDT(X1,X3)+$J($$DTT(X2),0,6)
"RTN","RGUT",200,0)
DTD(X1,X2) ;EP
"RTN","RGUT",201,0)
 Q $$FMDIFF^XLFDT(X1\1,X2\1)+($$DTF(X1)-$$DTF(X2))
"RTN","RGUT",202,0)
DTF(X) S X=X#1*100
"RTN","RGUT",203,0)
 Q X\1*3600+(X*100#100\1*60)+(X*10000#100)/86400
"RTN","RGUT",204,0)
DTT(X) S X=X*86400
"RTN","RGUT",205,0)
 Q X\3600*100+(X#3600/3600*60)/10000
"RTN","RGUT1")
0^71^B812698
"RTN","RGUT1",1,0)
RGUT1 ;RG/IND/PLS - General Purpose Utilites - Con't ;04-May-2006 08:19;DKM
"RTN","RGUT1",2,0)
 ;;3.0;RG UTILITIES;;Mar 20, 2007;Build 98
"RTN","RGUT1",3,0)
 ;;
"RTN","RGUT1",4,0)
 ;=================================================================
"RTN","RGUT1",5,0)
 ; Parameterized call to ScreenMan interface
"RTN","RGUT1",6,0)
DDS(DDSFILE,DR,DA,DDSPARM,DDSCHANG,CIAERR) ;
"RTN","RGUT1",7,0)
 S CIAERR=0
"RTN","RGUT1",8,0)
 D:'$D(IOST(0)) HOME^%ZIS
"RTN","RGUT1",9,0)
 D ENS^%ZISS
"RTN","RGUT1",10,0)
 D ^DDS
"RTN","RGUT1",11,0)
 S:$D(DTOUT) CIAERR=1
"RTN","RGUT1",12,0)
 I $D(DIMSG)!($D(DIERR)) D
"RTN","RGUT1",13,0)
 .S CIAERR=1
"RTN","RGUT1",14,0)
 .;D SHOWDLG(23)
"RTN","RGUT1",15,0)
 .W !,?5,"The Screen Manager could not edit this record."
"RTN","RGUT1",16,0)
 .H 5
"RTN","RGUT1",17,0)
 Q
"RTN","RGUT1",18,0)
 ; Prompt for single date date
"RTN","RGUT1",19,0)
 ; PMT = Prompt
"RTN","RGUT1",20,0)
 ; DFL = Default value (optional)
"RTN","RGUT1",21,0)
 ; MIN = Minimum value (optional)
"RTN","RGUT1",22,0)
 ; OPT = Additional options (optional)
"RTN","RGUT1",23,0)
ASKDATE(PMT,DFL,MIN,OPT) ;
"RTN","RGUT1",24,0)
 N %DT,Y
"RTN","RGUT1",25,0)
 S %DT="APEX"_$G(OPT)
"RTN","RGUT1",26,0)
 S %DT("A")=PMT
"RTN","RGUT1",27,0)
 S:$G(MIN) %DT(0)=MIN
"RTN","RGUT1",28,0)
 I $G(DFL) D
"RTN","RGUT1",29,0)
 .S Y=DFL
"RTN","RGUT1",30,0)
 .D DD^%DT
"RTN","RGUT1",31,0)
 .S %DT("B")=Y
"RTN","RGUT1",32,0)
 D ^%DT
"RTN","RGUT1",33,0)
 S:Y<0 POP=1
"RTN","RGUT1",34,0)
 Q Y
"RTN","RGUTALR")
0^33^B1394189
"RTN","RGUTALR",1,0)
RGUTALR ;RG/IND/DKM - Send alert to user(s) via kernel or mail;04-May-2006 08:19;DKM
"RTN","RGUTALR",2,0)
 ;;3.0;RG UTILITIES;;Mar 20, 2007;Build 98
"RTN","RGUTALR",3,0)
 ;;
"RTN","RGUTALR",4,0)
 ;=================================================================
"RTN","RGUTALR",5,0)
 ; Send an alert.
"RTN","RGUTALR",6,0)
 ;   XQAMSG = Message to send
"RTN","RGUTALR",7,0)
 ;   RGUTSR  = A semicolon-delimited list of users to receive alert.
"RTN","RGUTALR",8,0)
 ;=================================================================
"RTN","RGUTALR",9,0)
ALERT(XQAMSG,RGUTSR) ;
"RTN","RGUTALR",10,0)
 N XQA,XQAOPT,XQAFLG,XQAROU,XQADATA,XQAID
"RTN","RGUTALR",11,0)
 S @$$TRAP^RGUTOS("EXIT^RGUTALR"),RGUTSR=$G(RGUTSR,"*"),XQAMSG=$TR(XQAMSG,U,"~")
"RTN","RGUTALR",12,0)
 D ENTRY^RGUTUSR(RGUTSR,.XQA),SETUP^XQALERT:$D(XQA)
"RTN","RGUTALR",13,0)
EXIT Q
"RTN","RGUTALR",14,0)
 ;=================================================================
"RTN","RGUTALR",15,0)
 ; Send a mail message
"RTN","RGUTALR",16,0)
 ;   CIAMSG  = Message to send (single node or array)
"RTN","RGUTALR",17,0)
 ;   XMY    = A semicolon-delimited list (or array) of users
"RTN","RGUTALR",18,0)
 ;   XMSUB  = Subject line (optional)
"RTN","RGUTALR",19,0)
 ;   XMDUZ  = DUZ of sender (optional)
"RTN","RGUTALR",20,0)
 ;=================================================================
"RTN","RGUTALR",21,0)
MAIL(CIAMSG,XMY,XMSUB,XMDUZ) ;
"RTN","RGUTALR",22,0)
 N XMTEXT
"RTN","RGUTALR",23,0)
 S:$D(CIAMSG)=1 CIAMSG(1)=CIAMSG
"RTN","RGUTALR",24,0)
 S XMTEXT="CIAMSG(",@$$TRAP^RGUTOS("EXIT^RGUTALR"),XMY=$G(XMY)
"RTN","RGUTALR",25,0)
 S:$G(XMSUB)="" XMSUB=CIAMSG
"RTN","RGUTALR",26,0)
 S:$G(XMDUZ)="" XMDUZ=$G(DUZ)
"RTN","RGUTALR",27,0)
 F  Q:'$L(XMY)  S X=$P(XMY,";"),XMY=$P(XMY,";",2,999) S:$L(X) XMY(X)=""
"RTN","RGUTALR",28,0)
 D ^XMD:$D(XMY)>9
"RTN","RGUTALR",29,0)
 Q
"RTN","RGUTBC28")
0^65^B10811663
"RTN","RGUTBC28",1,0)
RGUTBC28 ;RG/IND/DKM/PLS - Convert 128 barcode to HPCL-compatible form ;04-May-2006 08:19;DKM
"RTN","RGUTBC28",2,0)
 ;;3.0;RG UTILITIES;;Mar 20, 2007;Build 98
"RTN","RGUTBC28",3,0)
 ;;
"RTN","RGUTBC28",4,0)
 ;=================================================================
"RTN","RGUTBC28",5,0)
 ; Inputs:
"RTN","RGUTBC28",6,0)
 ;     TX = Text to encode.
"RTN","RGUTBC28",7,0)
 ; Outputs:
"RTN","RGUTBC28",8,0)
 ;     Returns encoded text.
"RTN","RGUTBC28",9,0)
 ; Purpose:
"RTN","RGUTBC28",10,0)
 ;     Performs bar code 128 encoding on a text string.
"RTN","RGUTBC28",11,0)
 ;=================================================================
"RTN","RGUTBC28",12,0)
EN(TX) Q:TX="" ""
"RTN","RGUTBC28",13,0)
 N CD,TP,TP1,EN,Z1,Z2
"RTN","RGUTBC28",14,0)
 S TP=0,TP=$$TP(TX),CD=TP,EN=$C(TP+8)
"RTN","RGUTBC28",15,0)
 F  Q:TX=""  D
"RTN","RGUTBC28",16,0)
 .S TP1=$$TP(TX)
"RTN","RGUTBC28",17,0)
 .I TP1'=TP D CD(6-TP1) S TP=TP1
"RTN","RGUTBC28",18,0)
 .S Z1=$E(TX,1,TP=2+1),TX=$E(TX,TP=2+2,255),Z2=$A(Z1)
"RTN","RGUTBC28",19,0)
 .I TP=2 D CD($S(Z1>95:Z1-95,Z1:Z1+32,1:31))
"RTN","RGUTBC28",20,0)
 .E  D CD($S(Z2<32:Z2+96,Z2=32:31,1:Z2))
"RTN","RGUTBC28",21,0)
 S CD=CD#103,CD=$S('CD:31,CD>95:CD-95,1:CD+32)
"RTN","RGUTBC28",22,0)
 Q EN_$C(CD,11)
"RTN","RGUTBC28",23,0)
TP(X) Q $S(X?2N.E:2,$A(X)<32:0,$A(X)>95:1,TP=2:0,1:TP)
"RTN","RGUTBC28",24,0)
CD(X) S CD=$S(X=31:0,X<11:X+95,1:X-32)*$L(EN)+$G(CD),EN=EN_$C(X)
"RTN","RGUTBC28",25,0)
 Q
"RTN","RGUTBC28",26,0)
 ;=================================================================
"RTN","RGUTBC28",27,0)
 ; Inputs:
"RTN","RGUTBC28",28,0)
 ;   TXT = Data string to print in bar code
"RTN","RGUTBC28",29,0)
 ;   ORN = Orientation of bar code
"RTN","RGUTBC28",30,0)
 ;         0 = portrait (default)
"RTN","RGUTBC28",31,0)
 ;         1 = landscape
"RTN","RGUTBC28",32,0)
 ;   HGT = Height of bar code in dots (1/300 inch)
"RTN","RGUTBC28",33,0)
 ;   HOR = Horizontal position on page in dots
"RTN","RGUTBC28",34,0)
 ;   VER = Vertical position on page in dots
"RTN","RGUTBC28",35,0)
 ;   WID = Width of bar in dots (3=default)
"RTN","RGUTBC28",36,0)
 ; Purpose:
"RTN","RGUTBC28",37,0)
 ;   Accepts a barcode 128 string and writes an HPCL-compatible
"RTN","RGUTBC28",38,0)
 ;   string that will display the barcode on an HP laser printer.
"RTN","RGUTBC28",39,0)
 ;   A barcode font cartridge is not required.  The print position
"RTN","RGUTBC28",40,0)
 ;   on entry is restored on exit.
"RTN","RGUTBC28",41,0)
 ;=================================================================
"RTN","RGUTBC28",42,0)
BC(TXT,ORN,HGT,HOR,VER,WID) ;
"RTN","RGUTBC28",43,0)
 N Z,Z1,Z2,Z3,Z4,Z5,C,P,X
"RTN","RGUTBC28",44,0)
 S X=0 X ^%ZOSF("RM")
"RTN","RGUTBC28",45,0)
 S TXT=$$EN(TXT),C=$C(27)_"*c",P=$C(27)_"*p+",WID=$G(WID,3.5),HGT=$G(HGT,60),ORN=''$G(ORN)+1
"RTN","RGUTBC28",46,0)
 W $C(27),"&f0S"                                                       ;Push cursor position
"RTN","RGUTBC28",47,0)
 W:$D(HOR) $C(27)_"*p"_+HOR_"X"
"RTN","RGUTBC28",48,0)
 W:$D(VER) $C(27)_"*p"_+VER_"Y"
"RTN","RGUTBC28",49,0)
 W C_HGT_$E("BA",ORN)
"RTN","RGUTBC28",50,0)
 F Z=1:1:$L(TXT) D
"RTN","RGUTBC28",51,0)
 .S Z1=$P($T(@$A(TXT,Z)),";;",2),Z4=11,Z5=0
"RTN","RGUTBC28",52,0)
 .F Z2=1:1:$L(Z1) D
"RTN","RGUTBC28",53,0)
 ..S Z3=+$E(Z1,Z2),Z4=Z4-Z3,Z3=Z3*WID
"RTN","RGUTBC28",54,0)
 ..Q:'Z3
"RTN","RGUTBC28",55,0)
 ..I Z2#2 W C_Z3_$E("ab",ORN)_"0P" S Z5=Z3
"RTN","RGUTBC28",56,0)
 ..E  W P_(Z3+Z5)_$E("XY",ORN) S Z5=0
"RTN","RGUTBC28",57,0)
 .S Z4=Z4*WID+Z5
"RTN","RGUTBC28",58,0)
 .W:Z4>0 P_Z4_$E("XY",ORN)
"RTN","RGUTBC28",59,0)
 W $C(27),"&f1S"                                                       ;Pop cursor position
"RTN","RGUTBC28",60,0)
 Q ""
"RTN","RGUTBC28",61,0)
1 ;;11431
"RTN","RGUTBC28",62,0)
2 ;;41111
"RTN","RGUTBC28",63,0)
3 ;;41131
"RTN","RGUTBC28",64,0)
4 ;;11314
"RTN","RGUTBC28",65,0)
5 ;;11413
"RTN","RGUTBC28",66,0)
6 ;;31114
"RTN","RGUTBC28",67,0)
7 ;;41113
"RTN","RGUTBC28",68,0)
8 ;;21141
"RTN","RGUTBC28",69,0)
9 ;;21121
"RTN","RGUTBC28",70,0)
10 ;;21123
"RTN","RGUTBC28",71,0)
11 ;;2331112
"RTN","RGUTBC28",72,0)
31 ;;21222
"RTN","RGUTBC28",73,0)
33 ;;22212
"RTN","RGUTBC28",74,0)
34 ;;22222
"RTN","RGUTBC28",75,0)
35 ;;12122
"RTN","RGUTBC28",76,0)
36 ;;12132
"RTN","RGUTBC28",77,0)
37 ;;13122
"RTN","RGUTBC28",78,0)
38 ;;12221
"RTN","RGUTBC28",79,0)
39 ;;12231
"RTN","RGUTBC28",80,0)
40 ;;13221
"RTN","RGUTBC28",81,0)
41 ;;22121
"RTN","RGUTBC28",82,0)
42 ;;22131
"RTN","RGUTBC28",83,0)
43 ;;23121
"RTN","RGUTBC28",84,0)
44 ;;11223
"RTN","RGUTBC28",85,0)
45 ;;12213
"RTN","RGUTBC28",86,0)
46 ;;12223
"RTN","RGUTBC28",87,0)
47 ;;11322
"RTN","RGUTBC28",88,0)
48 ;;12312
"RTN","RGUTBC28",89,0)
49 ;;12322
"RTN","RGUTBC28",90,0)
50 ;;22321
"RTN","RGUTBC28",91,0)
51 ;;22113
"RTN","RGUTBC28",92,0)
52 ;;22123
"RTN","RGUTBC28",93,0)
53 ;;21321
"RTN","RGUTBC28",94,0)
54 ;;22311
"RTN","RGUTBC28",95,0)
55 ;;31213
"RTN","RGUTBC28",96,0)
56 ;;31122
"RTN","RGUTBC28",97,0)
57 ;;32112
"RTN","RGUTBC28",98,0)
58 ;;32122
"RTN","RGUTBC28",99,0)
59 ;;31221
"RTN","RGUTBC28",100,0)
60 ;;32211
"RTN","RGUTBC28",101,0)
61 ;;32221
"RTN","RGUTBC28",102,0)
62 ;;21212
"RTN","RGUTBC28",103,0)
63 ;;21232
"RTN","RGUTBC28",104,0)
64 ;;23212
"RTN","RGUTBC28",105,0)
65 ;;11132
"RTN","RGUTBC28",106,0)
66 ;;13112
"RTN","RGUTBC28",107,0)
67 ;;13132
"RTN","RGUTBC28",108,0)
68 ;;11231
"RTN","RGUTBC28",109,0)
69 ;;13211
"RTN","RGUTBC28",110,0)
70 ;;13231
"RTN","RGUTBC28",111,0)
71 ;;21131
"RTN","RGUTBC28",112,0)
72 ;;23111
"RTN","RGUTBC28",113,0)
73 ;;23131
"RTN","RGUTBC28",114,0)
74 ;;11213
"RTN","RGUTBC28",115,0)
75 ;;11233
"RTN","RGUTBC28",116,0)
76 ;;13213
"RTN","RGUTBC28",117,0)
77 ;;11312
"RTN","RGUTBC28",118,0)
78 ;;11332
"RTN","RGUTBC28",119,0)
79 ;;13312
"RTN","RGUTBC28",120,0)
80 ;;31312
"RTN","RGUTBC28",121,0)
81 ;;21133
"RTN","RGUTBC28",122,0)
82 ;;23113
"RTN","RGUTBC28",123,0)
83 ;;21311
"RTN","RGUTBC28",124,0)
84 ;;21331
"RTN","RGUTBC28",125,0)
85 ;;21313
"RTN","RGUTBC28",126,0)
86 ;;31112
"RTN","RGUTBC28",127,0)
87 ;;31132
"RTN","RGUTBC28",128,0)
88 ;;33112
"RTN","RGUTBC28",129,0)
89 ;;31211
"RTN","RGUTBC28",130,0)
90 ;;31231
"RTN","RGUTBC28",131,0)
91 ;;33211
"RTN","RGUTBC28",132,0)
92 ;;31411
"RTN","RGUTBC28",133,0)
93 ;;22141
"RTN","RGUTBC28",134,0)
94 ;;43111
"RTN","RGUTBC28",135,0)
95 ;;11122
"RTN","RGUTBC28",136,0)
96 ;;11142
"RTN","RGUTBC28",137,0)
97 ;;12112
"RTN","RGUTBC28",138,0)
98 ;;12142
"RTN","RGUTBC28",139,0)
99 ;;14112
"RTN","RGUTBC28",140,0)
100 ;;14122
"RTN","RGUTBC28",141,0)
101 ;;11221
"RTN","RGUTBC28",142,0)
102 ;;11241
"RTN","RGUTBC28",143,0)
103 ;;12211
"RTN","RGUTBC28",144,0)
104 ;;12241
"RTN","RGUTBC28",145,0)
105 ;;14211
"RTN","RGUTBC28",146,0)
106 ;;14221
"RTN","RGUTBC28",147,0)
107 ;;24121
"RTN","RGUTBC28",148,0)
108 ;;22111
"RTN","RGUTBC28",149,0)
109 ;;41311
"RTN","RGUTBC28",150,0)
110 ;;24111
"RTN","RGUTBC28",151,0)
111 ;;13411
"RTN","RGUTBC28",152,0)
112 ;;11124
"RTN","RGUTBC28",153,0)
113 ;;12114
"RTN","RGUTBC28",154,0)
114 ;;12124
"RTN","RGUTBC28",155,0)
115 ;;11421
"RTN","RGUTBC28",156,0)
116 ;;12411
"RTN","RGUTBC28",157,0)
117 ;;12421
"RTN","RGUTBC28",158,0)
118 ;;41121
"RTN","RGUTBC28",159,0)
119 ;;42111
"RTN","RGUTBC28",160,0)
120 ;;42121
"RTN","RGUTBC28",161,0)
121 ;;21214
"RTN","RGUTBC28",162,0)
122 ;;21412
"RTN","RGUTBC28",163,0)
123 ;;41212
"RTN","RGUTBC28",164,0)
124 ;;11114
"RTN","RGUTBC28",165,0)
125 ;;11134
"RTN","RGUTBC28",166,0)
126 ;;13114
"RTN","RGUTBC28",167,0)
127 ;;11411
"RTN","RGUTBC39")
0^66^B7717700
"RTN","RGUTBC39",1,0)
RGUTBC39 ;RG/IND/PLS - Converts barcode 39 to HPCL-compatible format ;04-May-2006 08:19;DKM
"RTN","RGUTBC39",2,0)
 ;;3.0;RG UTILITIES;;Mar 20, 2007;Build 98
"RTN","RGUTBC39",3,0)
 ;;
"RTN","RGUTBC39",4,0)
 ;=================================================================
"RTN","RGUTBC39",5,0)
 ; Inputs:
"RTN","RGUTBC39",6,0)
 ;   TXT = Data string to print in bar code
"RTN","RGUTBC39",7,0)
 ;   ORN = Orientation of bar code/Check Digit
"RTN","RGUTBC39",8,0)
 ;         0 = portrait/no check digit(default)
"RTN","RGUTBC39",9,0)
 ;         1 = landscape/no check digit
"RTN","RGUTBC39",10,0)
 ;         2 = portrait/check digit
"RTN","RGUTBC39",11,0)
 ;         3 = landscape/check digit
"RTN","RGUTBC39",12,0)
 ;   HGT = Height of bar code in dots (1/300 inch)
"RTN","RGUTBC39",13,0)
 ;   HOR = Horizontal position on page in dots
"RTN","RGUTBC39",14,0)
 ;   VER = Vertical position on page in dots
"RTN","RGUTBC39",15,0)
 ;   WID = Width of bar in dots (3=default)
"RTN","RGUTBC39",16,0)
 ; Purpose:
"RTN","RGUTBC39",17,0)
 ;   Accepts a barcode 39 string and writes an HPCL-compatible
"RTN","RGUTBC39",18,0)
 ;   string that will display the barcode on an HP laser printer.
"RTN","RGUTBC39",19,0)
 ;   A barcode font cartridge is not required.  The print position
"RTN","RGUTBC39",20,0)
 ;   on entry is restored upon exit.
"RTN","RGUTBC39",21,0)
 ;=================================================================
"RTN","RGUTBC39",22,0)
BC(TXT,ORN,HGT,HOR,VER,WID) ;
"RTN","RGUTBC39",23,0)
 N DD,CHK,CH,ZDD,C,P,Z1,Z2,Z3,Z4,Z5,X
"RTN","RGUTBC39",24,0)
 S X=0 X ^%ZOSF("RM")
"RTN","RGUTBC39",25,0)
 S CHK=$S($G(ORN)>1:1,1:0),ORN=$S($G(ORN)#2:1,1:0)
"RTN","RGUTBC39",26,0)
 S TXT=$TR(TXT,"*",""),CH="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ-. $/+Z"
"RTN","RGUTBC39",27,0)
 S DD="" F ZDD=1:1:$L(TXT) S DD=DD_$S(CH[$E(TXT,ZDD):$E(TXT,ZDD),1:"") ;STRIP UNPRINTABLE CHARACTERS
"RTN","RGUTBC39",28,0)
 S TXT=DD I +$G(CHK) S TXT=$$CHK(TXT)                             ;ADD CHECKSUM CHARACTER
"RTN","RGUTBC39",29,0)
 S TXT="*"_TXT_"*"                                                     ;ADD START AND STOP CODES
"RTN","RGUTBC39",30,0)
 S C=$C(27)_"*c",P=$C(27)_"*p+",WID=$G(WID,3),HGT=$G(HGT,60),ORN=''$G(ORN)+1
"RTN","RGUTBC39",31,0)
 W $C(27),"&f0S"                                                       ;Push cursor position
"RTN","RGUTBC39",32,0)
 W:$D(HOR) $C(27)_"*p"_+HOR_"X"
"RTN","RGUTBC39",33,0)
 W:$D(VER) $C(27)_"*p"_+VER_"Y"
"RTN","RGUTBC39",34,0)
 W C_HGT_$E("BA",ORN)
"RTN","RGUTBC39",35,0)
 F Z=1:1:$L(TXT) D
"RTN","RGUTBC39",36,0)
 .S Z1=$S($E(TXT,Z)="*":$P($T(99),";",4),1:$P($T(@($F(CH,$E(TXT,Z))-2)),";",4)),Z4=15,Z5=0
"RTN","RGUTBC39",37,0)
 .F Z2=1:1:$L(Z1) D
"RTN","RGUTBC39",38,0)
 ..S Z3=+$E(Z1,Z2),Z4=Z4-Z3,Z3=Z3*WID
"RTN","RGUTBC39",39,0)
 ..Q:'Z3
"RTN","RGUTBC39",40,0)
 ..I Z2#2 W C_Z3_$E("ab",ORN)_"0P" S Z5=Z3
"RTN","RGUTBC39",41,0)
 ..E  W P_(Z3+Z5)_$E("XY",ORN) S Z5=0
"RTN","RGUTBC39",42,0)
 .S Z4=Z4*WID+Z5
"RTN","RGUTBC39",43,0)
 .W P_(Z5+WID)_$E("XY",ORN)
"RTN","RGUTBC39",44,0)
 W $C(27),"&f1S"                                                       ;Pop cursor position
"RTN","RGUTBC39",45,0)
 Q ""
"RTN","RGUTBC39",46,0)
CHK(X) ;CALCULATE CHECK DIGIT AND RETURN STRING TO PRINT
"RTN","RGUTBC39",47,0)
 Q:X="" ""
"RTN","RGUTBC39",48,0)
 N CHK,Y
"RTN","RGUTBC39",49,0)
 S CHK=0,Y=X
"RTN","RGUTBC39",50,0)
 F  Q:X=""  S CHK=$F(CH,$E(X))-2+CHK,X=$E(X,2,255)
"RTN","RGUTBC39",51,0)
 S CHK=$E(CH,CHK#43+1)
"RTN","RGUTBC39",52,0)
 Q Y_CHK
"RTN","RGUTBC39",53,0)
0 ;;0;111331311
"RTN","RGUTBC39",54,0)
1 ;;1;311311113
"RTN","RGUTBC39",55,0)
2 ;;2;113311113
"RTN","RGUTBC39",56,0)
3 ;;3;313311111
"RTN","RGUTBC39",57,0)
4 ;;4;111331113
"RTN","RGUTBC39",58,0)
5 ;;5;311331111
"RTN","RGUTBC39",59,0)
6 ;;6;113331111
"RTN","RGUTBC39",60,0)
7 ;;7;111311313
"RTN","RGUTBC39",61,0)
8 ;;8;311311311
"RTN","RGUTBC39",62,0)
9 ;;9;113311311
"RTN","RGUTBC39",63,0)
10 ;;A;311113113
"RTN","RGUTBC39",64,0)
11 ;;B;113113113
"RTN","RGUTBC39",65,0)
12 ;;C;313113111
"RTN","RGUTBC39",66,0)
13 ;;D;111133113
"RTN","RGUTBC39",67,0)
14 ;;E;311133111
"RTN","RGUTBC39",68,0)
15 ;;F;113133111
"RTN","RGUTBC39",69,0)
16 ;;G;111113313
"RTN","RGUTBC39",70,0)
17 ;;H;311113311
"RTN","RGUTBC39",71,0)
18 ;;I;113113311
"RTN","RGUTBC39",72,0)
19 ;;J;111133311
"RTN","RGUTBC39",73,0)
20 ;;K;311111133
"RTN","RGUTBC39",74,0)
21 ;;L;113111133
"RTN","RGUTBC39",75,0)
22 ;;M;313111131
"RTN","RGUTBC39",76,0)
23 ;;N;111131133
"RTN","RGUTBC39",77,0)
24 ;;O;311131131
"RTN","RGUTBC39",78,0)
25 ;;P;113131131
"RTN","RGUTBC39",79,0)
26 ;;Q;111111333
"RTN","RGUTBC39",80,0)
27 ;;R;311111331
"RTN","RGUTBC39",81,0)
28 ;;S;113111331
"RTN","RGUTBC39",82,0)
29 ;;T;111131331
"RTN","RGUTBC39",83,0)
30 ;;U;331111113
"RTN","RGUTBC39",84,0)
31 ;;V;133111113
"RTN","RGUTBC39",85,0)
32 ;;W;333111111
"RTN","RGUTBC39",86,0)
33 ;;X;131131113
"RTN","RGUTBC39",87,0)
34 ;;Y;331131111
"RTN","RGUTBC39",88,0)
35 ;;Z;133131111
"RTN","RGUTBC39",89,0)
36 ;;-;131111313
"RTN","RGUTBC39",90,0)
37 ;;.;331111311
"RTN","RGUTBC39",91,0)
38 ;; ;133111311
"RTN","RGUTBC39",92,0)
39 ;;$;131313111
"RTN","RGUTBC39",93,0)
40 ;;/;131311131
"RTN","RGUTBC39",94,0)
41 ;;+;131113131
"RTN","RGUTBC39",95,0)
42 ;;%;111313131
"RTN","RGUTBC39",96,0)
99 ;;*;131131311
"RTN","RGUTBCDA")
0^67^B8230455
"RTN","RGUTBCDA",1,0)
RGUTBCDA ;RG/IND/PLS - Converts barcode CODABAR to HPCL-compatible format ;04-May-2006 08:19;DKM
"RTN","RGUTBCDA",2,0)
 ;;3.0;RG UTILITIES;;Mar 20, 2007;Build 98
"RTN","RGUTBCDA",3,0)
 ;;
"RTN","RGUTBCDA",4,0)
 ;=================================================================
"RTN","RGUTBCDA",5,0)
 ; Inputs:
"RTN","RGUTBCDA",6,0)
 ;   TXT = Data string to print in bar code
"RTN","RGUTBCDA",7,0)
 ;   ORN = Orientation of bar code/Check digit
"RTN","RGUTBCDA",8,0)
 ;         0 = portrait/no check digit(default)
"RTN","RGUTBCDA",9,0)
 ;         1 = landscape/no check digit
"RTN","RGUTBCDA",10,0)
 ;         2 = portrait/check digit
"RTN","RGUTBCDA",11,0)
 ;         3 = landscape/check digit
"RTN","RGUTBCDA",12,0)
 ;   HGT = Height of bar code in dots (1/300 inch)
"RTN","RGUTBCDA",13,0)
 ;   HOR = Horizontal position on page in dots
"RTN","RGUTBCDA",14,0)
 ;   VER = Vertical position on page in dots
"RTN","RGUTBCDA",15,0)
 ;   WID = Width of bar in dots (3=default)
"RTN","RGUTBCDA",16,0)
 ;   SSC = Start/Stop characters (a/a = default)
"RTN","RGUTBCDA",17,0)
 ; Purpose:
"RTN","RGUTBCDA",18,0)
 ;   Accepts a barcode CODABAR string and writes an HPCL-compatible
"RTN","RGUTBCDA",19,0)
 ;   string that will display the barcode on an HP laser printer.
"RTN","RGUTBCDA",20,0)
 ;   A barcode font cartridge is not required.  The print position
"RTN","RGUTBCDA",21,0)
 ;   on entry is restored upon exit.
"RTN","RGUTBCDA",22,0)
 ;=================================================================
"RTN","RGUTBCDA",23,0)
BC(TXT,ORN,HGT,HOR,VER,WID,SSC) ;
"RTN","RGUTBCDA",24,0)
 N DD,CHK,CH,ZDD,C,P,Z,Z1,Z2,Z3,Z4,Z5,X
"RTN","RGUTBCDA",25,0)
 S X=0 X ^%ZOSF("RM")
"RTN","RGUTBCDA",26,0)
 S CHK=$S($G(ORN)>1:1,1:0),ORN=$S($G(ORN)#2:1,1:0)
"RTN","RGUTBCDA",27,0)
 S CH="0123456789-$:/.+"
"RTN","RGUTBCDA",28,0)
 S DD="" F ZDD=1:1:$L(TXT) S DD=DD_$S(CH[$E(TXT,ZDD):$E(TXT,ZDD),1:"") ;STRIP UNPRINTABLE CHARACTERS
"RTN","RGUTBCDA",29,0)
 S TXT=DD,TXT="a"_TXT_"a"                                            ;ADD START AND STOP CODES
"RTN","RGUTBCDA",30,0)
 I +$G(CHK) S TXT=$$CHK(TXT)
"RTN","RGUTBCDA",31,0)
 S C=$C(27)_"*c",P=$C(27)_"*p+",WID=$G(WID,3),HGT=$G(HGT,60),ORN=''$G(ORN)+1
"RTN","RGUTBCDA",32,0)
 W $C(27),"&f0S"                                                       ;Push cursor position
"RTN","RGUTBCDA",33,0)
 W:$D(HOR) $C(27)_"*p"_+HOR_"X"
"RTN","RGUTBCDA",34,0)
 W:$D(VER) $C(27)_"*p"_+VER_"Y"
"RTN","RGUTBCDA",35,0)
 W C_HGT_$E("BA",ORN)
"RTN","RGUTBCDA",36,0)
 F Z=1:1:$L(TXT) D
"RTN","RGUTBCDA",37,0)
 .S Z1=$S("AaTt"[$E(TXT,Z):$P($T(16),";",4),"BbNn"[$E(TXT,Z):$P($T(17),";",4),"Cc*"[$E(TXT,Z):$P($T(18),";",4),"DdEe"[$E(TXT,Z):$P($T(19),";",4),1:$P($T(@($F(CH,$E(TXT,Z))-2)),";",4)),Z4=13,Z5=0
"RTN","RGUTBCDA",38,0)
 .F Z2=1:1:$L(Z1) D
"RTN","RGUTBCDA",39,0)
 ..S Z3=+$E(Z1,Z2),Z4=Z4-Z3,Z3=Z3*WID
"RTN","RGUTBCDA",40,0)
 ..Q:'Z3
"RTN","RGUTBCDA",41,0)
 ..I Z2#2 W C_Z3_$E("ab",ORN)_"0P" S Z5=Z3
"RTN","RGUTBCDA",42,0)
 ..E  W P_(Z3+Z5)_$E("XY",ORN) S Z5=0
"RTN","RGUTBCDA",43,0)
 .S Z4=Z4*WID+Z5
"RTN","RGUTBCDA",44,0)
 .W P_(Z5+WID)_$E("XY",ORN)
"RTN","RGUTBCDA",45,0)
 W $C(27),"&f1S"                                                       ;Pop cursor position
"RTN","RGUTBCDA",46,0)
 Q ""
"RTN","RGUTBCDA",47,0)
CHK(X) ;CALCULATE CHECK DIGIT AND RETURN STRING TO PRINT
"RTN","RGUTBCDA",48,0)
 Q:X="" ""
"RTN","RGUTBCDA",49,0)
 N Z1,Y,CHK,XX
"RTN","RGUTBCDA",50,0)
 S CHK=0,Y=X
"RTN","RGUTBCDA",51,0)
 S XX=$E(X,1)_$E(X,$L(X))                                             ;STRIP OFF S/S CODES AND CALCULATE CHECKSUM
"RTN","RGUTBCDA",52,0)
 F Z1=1:1:$L(XX) S CHK=CHK+$S("AaTt"[$E(XX,Z1):16,"BbNn"[$E(XX,Z1):17,"Cc*"[$E(XX,Z1):18,"DdEe"[$E(XX,Z1):19,1:0)
"RTN","RGUTBCDA",53,0)
 ;ADD TO CHECKSUM THE VALUES OF THE DATA
"RTN","RGUTBCDA",54,0)
 S X=$E(X,2,$L(X)-1) F  Q:X=""  S CHK=$F(CH,$E(X))-2+CHK,X=$E(X,2,255)
"RTN","RGUTBCDA",55,0)
 S CHK=$E(CH,$S('CHK#16:1,1:16-CHK#16+1))
"RTN","RGUTBCDA",56,0)
 Q $E(Y,1,$L(Y)-1)_CHK_$E(Y,$L(Y))
"RTN","RGUTBCDA",57,0)
0 ;;0;1111133
"RTN","RGUTBCDA",58,0)
1 ;;1;1111331
"RTN","RGUTBCDA",59,0)
2 ;;2;1113113
"RTN","RGUTBCDA",60,0)
3 ;;3;3311111
"RTN","RGUTBCDA",61,0)
4 ;;4;1131131
"RTN","RGUTBCDA",62,0)
5 ;;5;3111131
"RTN","RGUTBCDA",63,0)
6 ;;6;1311113
"RTN","RGUTBCDA",64,0)
7 ;;7;1311311
"RTN","RGUTBCDA",65,0)
8 ;;8;1331111
"RTN","RGUTBCDA",66,0)
9 ;;9;3113111
"RTN","RGUTBCDA",67,0)
10 ;;-;1113311
"RTN","RGUTBCDA",68,0)
11 ;;$;1133111
"RTN","RGUTBCDA",69,0)
12 ;;:;3111313
"RTN","RGUTBCDA",70,0)
13 ;;/;3131113
"RTN","RGUTBCDA",71,0)
14 ;;.;3131311
"RTN","RGUTBCDA",72,0)
15 ;;+;1131313
"RTN","RGUTBCDA",73,0)
16 ;;AaTt;1133131
"RTN","RGUTBCDA",74,0)
17 ;;BbNn;1313113
"RTN","RGUTBCDA",75,0)
18 ;;Cc*;1113133
"RTN","RGUTBCDA",76,0)
19 ;;DdEe;1113331
"RTN","RGUTBIG")
0^34^B14928339
"RTN","RGUTBIG",1,0)
RGUTBIG ;RG/IND/PLS - Print a banner in large letters;04-May-2006 08:19;DKM
"RTN","RGUTBIG",2,0)
 ;;3.0;RG UTILITIES;;Mar 20, 2007;Build 98
"RTN","RGUTBIG",3,0)
 ;;
"RTN","RGUTBIG",4,0)
 ;=================================================================
"RTN","RGUTBIG",5,0)
 ; Prints CIABIG to the current output device in large letters.
"RTN","RGUTBIG",6,0)
 ; Inputs:
"RTN","RGUTBIG",7,0)
 ;   CIABIG = Big letter string
"RTN","RGUTBIG",8,0)
 ;   CIARPT = # times to repeat (default=2)
"RTN","RGUTBIG",9,0)
 ;   CIATXT = Full text string (optional)
"RTN","RGUTBIG",10,0)
 ;=================================================================
"RTN","RGUTBIG",11,0)
ENTRY(CIABIG,CIARPT,CIATXT) ;
"RTN","RGUTBIG",12,0)
 N CIALT,CIAFS,CIAZ,CIAZ1,CIALEN,CIAPF,CIALN
"RTN","RGUTBIG",13,0)
 S CIAFS="ABCDEFGHIJKLMNOPQRSTUVWXYZ 0123456789,-/.!#'$()*+?\=^&%"
"RTN","RGUTBIG",14,0)
 S:$D(CIATXT) CIATXT=$$REPEAT^XLFSTR("*"_CIATXT,$G(IOM,80)\($L(CIATXT)+1))
"RTN","RGUTBIG",15,0)
 S CIALEN=$L(CIABIG),CIARPT=$G(CIARPT,2)
"RTN","RGUTBIG",16,0)
 W !
"RTN","RGUTBIG",17,0)
 F CIALT=1:1:CIARPT D
"RTN","RGUTBIG",18,0)
 .W !
"RTN","RGUTBIG",19,0)
 .F CIAZ=1:8:65 D
"RTN","RGUTBIG",20,0)
 ..W !
"RTN","RGUTBIG",21,0)
 ..F CIAZ1=1:1:CIALEN D
"RTN","RGUTBIG",22,0)
 ...S CIALN=$F(CIAFS,$E(CIABIG,CIAZ1))-1
"RTN","RGUTBIG",23,0)
 ...S CIAPF=$P($T(TBL+CIALN),";;",2,99)
"RTN","RGUTBIG",24,0)
 ...W $E(CIAPF,CIAZ,CIAZ+7)
"RTN","RGUTBIG",25,0)
 ...W:CIAZ1<CIALEN ?(CIAZ1*12)
"RTN","RGUTBIG",26,0)
 .W !!,$G(CIATXT)
"RTN","RGUTBIG",27,0)
 Q
"RTN","RGUTBIG",28,0)
TBL ;; Table of character "raster images"
"RTN","RGUTBIG",29,0)
 ;; AAAAAA AA    AAAA    AAAAAAAAAAAAAAAAAAAA    AAAA    AAAA    AA
"RTN","RGUTBIG",30,0)
 ;;BBBBBBB BB    BBBB    BBBBBBBBB BBBBBBB BB    BBBB    BBBBBBBBB
"RTN","RGUTBIG",31,0)
 ;;CCCCCCCCCC      CC      CC      CC      CC      CC      CCCCCCCC
"RTN","RGUTBIG",32,0)
 ;;DDDDDD  DD   DD DD    DDDD    DDDD    DDDD    DDDD   DD DDDDDD
"RTN","RGUTBIG",33,0)
 ;;EEEEEEEEEE      EE      EEEEEE  EEEEEE  EE      EE      EEEEEEEE
"RTN","RGUTBIG",34,0)
 ;;FFFFFFFFFF      FF      FFFFFF  FFFFFF  FF      FF      FF
"RTN","RGUTBIG",35,0)
 ;;GGGGGGGGGG      GG      GG  GGGGGG  GGGGGG    GGGG    GGGGGGGGGG
"RTN","RGUTBIG",36,0)
 ;;HH    HHHH    HHHH     HHHHHHHHHHHHHHHHHHH    HHHH    HHHH    HH
"RTN","RGUTBIG",37,0)
 ;;IIIIIIII   II      II      II      II      II      II   IIIIIIII
"RTN","RGUTBIG",38,0)
 ;;JJJJJJJJ    JJ      JJ      JJ      JJ      JJ  JJ  JJ  JJJJJJ
"RTN","RGUTBIG",39,0)
 ;;KK    KKKK   KK KK  KK  KKKK    KKKK    KK  KK  KK   KK KK    KK
"RTN","RGUTBIG",40,0)
 ;;LL      LL      LL      LL      LL      LL      LL      LLLLLLLL
"RTN","RGUTBIG",41,0)
 ;;MM    MMMMM  MMMM MMMM MMM MM MMMM    MMMM    MMMM    MMMM    MM
"RTN","RGUTBIG",42,0)
 ;;N     NNNN    NNNNN   NNNN N  NNNN  N NNNN   NNNNN    NNNN     N
"RTN","RGUTBIG",43,0)
 ;; OOOOOO OO    OOOO    OOOO    OOOO    OOOO    OOOO    OO OOOOOO
"RTN","RGUTBIG",44,0)
 ;;PPPPPPP PP    PPPP    PPPPPPPPP PP      PP      PP      PP
"RTN","RGUTBIG",45,0)
 ;; QQQQQQ QQ    QQQQ    QQQQ    QQQQ  Q QQQQ   Q Q QQQQQQ        Q
"RTN","RGUTBIG",46,0)
 ;;RRRRRRR RR    RRRR    RRRRRRRRR RR RR   RR  RR  RR   RR RR    RR
"RTN","RGUTBIG",47,0)
 ;;SSSSSSSSSS      SS      SSSSSSSSSSSSSSSS      SS      SSSSSSSSSS
"RTN","RGUTBIG",48,0)
 ;;TTTTTTTT   TT      TT      TT      TT      TT      TT      TT
"RTN","RGUTBIG",49,0)
 ;;UU    UUUU    UUUU    UUUU    UUUU    UUUU    UUUUUUUUUU UUUUUU
"RTN","RGUTBIG",50,0)
 ;;VV    VVVV    VVVV    VVVV    VV VV  VV  VV  VV   VVVV     VV
"RTN","RGUTBIG",51,0)
 ;;WW    WWWW    WWWW    WWWW    WWWW    WWWW WW WWWWW  WWWWW    WW
"RTN","RGUTBIG",52,0)
 ;;XX    XXXX    XX XX  XX   XXXX     XX     XXXX   XX  XX XX    XX
"RTN","RGUTBIG",53,0)
 ;;YY    YY YY  YY   Y  Y     YY      YY      YY      YY      YY
"RTN","RGUTBIG",54,0)
 ;;ZZZZZZZZZZZZZZZZ     ZZ     ZZ    ZZ      ZZ    ZZZZZZZZZZZZZZZZ
"RTN","RGUTBIG",55,0)
 ;;
"RTN","RGUTBIG",56,0)
 ;;  0000 0 00  00 00   00000  0 0000 0  00000   00 00  00 0 0000
"RTN","RGUTBIG",57,0)
 ;;   11     111    1111      11      11      11      11   1111111
"RTN","RGUTBIG",58,0)
 ;;  2222   22  22 22    22      22    22    22     22     2222222
"RTN","RGUTBIG",59,0)
 ;;3333333      33     33   33333       33       33     33 33333
"RTN","RGUTBIG",60,0)
 ;;      44     444   44 44 44   44 4444444      44      44      44
"RTN","RGUTBIG",61,0)
 ;;5555555555      55      5555555       55      55     55 555555
"RTN","RGUTBIG",62,0)
 ;;   666   66  66 66      66      66 6666 666   66 66   66  6666
"RTN","RGUTBIG",63,0)
 ;;77777777      77     77    77      77     77     77      77
"RTN","RGUTBIG",64,0)
 ;;  8888   88  88 88  88   8888   88  88  88    88 88  88   8888
"RTN","RGUTBIG",65,0)
 ;;  99999 99    9999    99 9999999      99      99     99   9999
"RTN","RGUTBIG",66,0)
 ;;                                         ''        '      '
"RTN","RGUTBIG",67,0)
 ;;                        ----------------
"RTN","RGUTBIG",68,0)
 ;;              //     //     //    //      //      //
"RTN","RGUTBIG",69,0)
 ;;                                         ....    ....    ....
"RTN","RGUTBIG",70,0)
 ;;    !!     !!      !!      !!     !!               ....    ....
"RTN","RGUTBIG",71,0)
 ;;  #  #  ########  #  #  ########  #  #
"RTN","RGUTBIG",72,0)
 ;;
"RTN","RGUTBIG",73,0)
 ;;   $$   $$$$$$$$$$ $$   $$$$$$$$   $$ $$$$$$$$$$   $$
"RTN","RGUTBIG",74,0)
 ;;   ((     ((     ((     ((      ((       ((       ((
"RTN","RGUTBIG",75,0)
 ;;   ))      ))        ))       ))      ))     ))     ))    ))
"RTN","RGUTBIG",76,0)
 ;;*  **  * * ** *   ****  ********  ****   * ** * *  **  *
"RTN","RGUTBIG",77,0)
 ;;           ++      ++   ++++++++++++++++   ++      ++
"RTN","RGUTBIG",78,0)
 ;;  ???   ??   ??      ??     ??     ??      ??     ....    ....
"RTN","RGUTBIG",79,0)
 ;;         \\       \\       \\       \\       \\       \\
"RTN","RGUTBIG",80,0)
 ;;        ================       =================
"RTN","RGUTBIG",81,0)
 ;;    ^      ^^^    ^^ ^^  ^^   ^^
"RTN","RGUTBIG",82,0)
 ;; &&&    &   &   &   &    &&&  &  &&& && &   &&  &   &&   &&&   &
"RTN","RGUTBIG",83,0)
 ;;  %    % % %  %   %  %      %      %      %  %   %  % % %     %
"RTN","RGUTDAT")
0^35^B13607562
"RTN","RGUTDAT",1,0)
RGUTDAT ;RG/IND/DKM - Date range input;20-Jan-2015 13:23;DKM
"RTN","RGUTDAT",2,0)
 ;;3.0;RG UTILITIES;;Mar 20, 2007;Build 98
"RTN","RGUTDAT",3,0)
 ;;
"RTN","RGUTDAT",4,0)
 ;=================================================================
"RTN","RGUTDAT",5,0)
 ; Prompt for date range (normal format)
"RTN","RGUTDAT",6,0)
NORMAL D D1("P1"),D2("P2"):CIADAT1
"RTN","RGUTDAT",7,0)
 Q
"RTN","RGUTDAT",8,0)
 ; Prompt for date range (inverse format)
"RTN","RGUTDAT",9,0)
INVRSE D D1("PI1"),D2("PI2"):CIADAT1
"RTN","RGUTDAT",10,0)
 Q
"RTN","RGUTDAT",11,0)
 ; Prompt for starting date
"RTN","RGUTDAT",12,0)
D1(CIAOPT) ;
"RTN","RGUTDAT",13,0)
 S CIADAT1=$$ENTRY("Start date: ",.CIAOPT,"",0,$Y)
"RTN","RGUTDAT",14,0)
 Q
"RTN","RGUTDAT",15,0)
 ; Prompt for ending date
"RTN","RGUTDAT",16,0)
D2(CIAOPT) ;
"RTN","RGUTDAT",17,0)
 S CIADAT2=$$ENTRY("End date  : ",.CIAOPT,"",0,$Y+1)
"RTN","RGUTDAT",18,0)
 Q
"RTN","RGUTDAT",19,0)
 ; Prompt for a date
"RTN","RGUTDAT",20,0)
ENTRY(%CIAP,%CIAOPT,%CIADAT,%CIAX,%CIAY,%CIATRP,%CIAHLP) ;
"RTN","RGUTDAT",21,0)
 N %CIAD,%CIAI,%CIADT,%CIAZ,%CIADISV
"RTN","RGUTDAT",22,0)
 S %CIAX=$G(%CIAX,$X),%CIAY=$G(%CIAY,$Y),DUZ=+$G(DUZ),DTIME=$G(DTIME,999999),%CIAOPT=$$UP^XLFSTR($G(%CIAOPT)),%CIADISV=""
"RTN","RGUTDAT",23,0)
 S %CIATRP=$G(%CIATRP),%CIADAT=$G(%CIADAT)
"RTN","RGUTDAT",24,0)
 S:$G(%CIAHLP)="" %CIAHLP="HELP^RGUTDAT"
"RTN","RGUTDAT",25,0)
 S:$G(%CIAP)="" %CIAP="Enter date: "
"RTN","RGUTDAT",26,0)
 F %CIAZ=0:1:9 I %CIAOPT[%CIAZ S %CIADISV="CIADAT"_%CIAZ Q
"RTN","RGUTDAT",27,0)
DAT1 S %CIADT="",@$$TRAP^RGUTOS("DAT1^RGUTDAT")
"RTN","RGUTDAT",28,0)
 F %CIAZ="P","T","F","X" S:%CIAOPT[%CIAZ %CIADT=%CIADT_%CIAZ
"RTN","RGUTDAT",29,0)
 F  D  Q:$D(%CIAI)
"RTN","RGUTDAT",30,0)
 .W $$XY^RGUT(%CIAX,%CIAY)_%CIAP,*27,"[J"
"RTN","RGUTDAT",31,0)
 .S $X=%CIAX+$L(%CIAP)
"RTN","RGUTDAT",32,0)
 .I %CIAOPT["E" S %CIAI=$$ENTRY^RGUTEDT(%CIADAT,79-$X,$X,$Y,"","R")
"RTN","RGUTDAT",33,0)
 .E  I %CIADAT'="" S %CIAI=%CIADAT,%CIADAT=""
"RTN","RGUTDAT",34,0)
 .E  R %CIAI:DTIME
"RTN","RGUTDAT",35,0)
 .I $E(%CIAI)="?" D  Q
"RTN","RGUTDAT",36,0)
 ..W !
"RTN","RGUTDAT",37,0)
 ..I %CIAI["??" D HELP
"RTN","RGUTDAT",38,0)
 ..E  D @%CIAHLP
"RTN","RGUTDAT",39,0)
 ..D PAUSE()
"RTN","RGUTDAT",40,0)
 ..K %CIAI
"RTN","RGUTDAT",41,0)
 .I %CIAI=" " S %CIAI=$S(%CIADISV="":"",1:$G(^DISV(DUZ,%CIADISV))) K:%CIAI="" CIAZ1
"RTN","RGUTDAT",42,0)
 .W $$XY^RGUT(%CIAX+$L(%CIAP),%CIAY),*27,"[K"
"RTN","RGUTDAT",43,0)
 I %CIAI="",%CIATRP'="" S %CIAI=$G(@%CIATRP@(" "))
"RTN","RGUTDAT",44,0)
 S %CIAI=$$UP^XLFSTR(%CIAI),%CIAD=""
"RTN","RGUTDAT",45,0)
 Q:"^^"[%CIAI -$L(%CIAI)
"RTN","RGUTDAT",46,0)
 I %CIATRP'="" D  I %CIAD'="" S %CIAOPT=$TR(%CIAOPT,"I") G DAT2
"RTN","RGUTDAT",47,0)
 .I $D(@%CIATRP@(%CIAI)) S %CIAD=@%CIATRP@(%CIAI)
"RTN","RGUTDAT",48,0)
 .E  D
"RTN","RGUTDAT",49,0)
 ..N X
"RTN","RGUTDAT",50,0)
 ..S X=%CIAI,%CIAZ=""
"RTN","RGUTDAT",51,0)
 ..F  S %CIAZ=$O(@%CIATRP@("?",%CIAZ)) Q:%CIAZ=""  I %CIAI?@%CIAZ D  Q
"RTN","RGUTDAT",52,0)
 ...S %CIAD=$$MSG^RGUT($G(@%CIATRP@("?",%CIAZ)))
"RTN","RGUTDAT",53,0)
 S %CIAI=$$DT^RGUT(%CIAI,%CIADT)
"RTN","RGUTDAT",54,0)
 G:%CIAI=-1 DAT1
"RTN","RGUTDAT",55,0)
 I %CIAOPT["+",%CIAI<$S(%CIAI=%CIAI\1:$$DT^XLFDT,1:$$NOW^XLFDT) D  G DAT1
"RTN","RGUTDAT",56,0)
 .D PAUSE("Must be on or after current date.")
"RTN","RGUTDAT",57,0)
 I %CIAOPT["-",%CIAI>$S(%CIAI=%CIAI\1:$$DT^XLFDT,1:$$NOW^XLFDT) D  G DAT1
"RTN","RGUTDAT",58,0)
 .D PAUSE("Must be on or before current date.")
"RTN","RGUTDAT",59,0)
 S %CIAD=$$ENTRY^RGUTDT(%CIAI)
"RTN","RGUTDAT",60,0)
DAT2 W %CIAD
"RTN","RGUTDAT",61,0)
 S:%CIADISV'="" ^DISV(DUZ,%CIADISV)=%CIAI
"RTN","RGUTDAT",62,0)
 Q $S(%CIAOPT["I":9999999-%CIAI,1:%CIAI)
"RTN","RGUTDAT",63,0)
HELP W ?2,"Enter a valid ",$S(%CIAOPT["+":"future ",%CIAOPT["-":"past ",1:""),"date using one of the following formats:",!!
"RTN","RGUTDAT",64,0)
 W ?5,"Format",?20,"Example",?35,"Explanation",?60,"Comments",!
"RTN","RGUTDAT",65,0)
 W ?5,"------",?20,"-------",?35,"-----------",?60,"--------",!
"RTN","RGUTDAT",66,0)
 W ?5,"mm/dd/yy",?20,"6/20/93",?35,"June 20, 1993",?60,"If you omit the",!
"RTN","RGUTDAT",67,0)
 W ?5,"dd-mmm-yy",?20,"27-JUL-58",?35,"July 27, 1958",?60,"year, the "_$S(%CIAOPT["P":"most",%CIAOPT["F":"closest",1:"current"),!
"RTN","RGUTDAT",68,0)
 W ?5,"mmddyy",?20,"070457",?35,"July 4, 1957",?60,$S(%CIAOPT["P":"recent past date",%CIAOPT["F":"future date",1:"calendar year"),!
"RTN","RGUTDAT",69,0)
 W ?5,"mmm dd yyyy",?20,"JAN 5, 1984",?35,"January 5, 1984",?60,"is assumed.",!
"RTN","RGUTDAT",70,0)
 W ?5,"T-n",?20,"T-5",?35,"Today's date - 5 days.",!!
"RTN","RGUTDAT",71,0)
 Q
"RTN","RGUTDAT",72,0)
PAUSE(%CIAZ) ;
"RTN","RGUTDAT",73,0)
 W $$XY^RGUT(0,22),$G(%CIAZ)
"RTN","RGUTDAT",74,0)
 I $$PAUSE^RGUT
"RTN","RGUTDAT",75,0)
 Q
"RTN","RGUTDDR")
0^62^B59431447
"RTN","RGUTDDR",1,0)
RGUTDDR ;RG/IND/DKM - FileMan RPC Extensions ;04-May-2006 08:19;DKM
"RTN","RGUTDDR",2,0)
 ;;3.0;RG UTILITIES;;Mar 20, 2007;Build 98
"RTN","RGUTDDR",3,0)
 ;;
"RTN","RGUTDDR",4,0)
 ;=================================================================
"RTN","RGUTDDR",5,0)
 ; RPC: Retrieve DD information about a file.
"RTN","RGUTDDR",6,0)
 ; FNUM = File # or name
"RTN","RGUTDDR",7,0)
 ; FLDS = Semi-colon delimited field list (optional)
"RTN","RGUTDDR",8,0)
 ; IENS = IENS (for subfile entries)
"RTN","RGUTDDR",9,0)
 ; FLGS = Control flags:
"RTN","RGUTDDR",10,0)
 ;   D = Fix duplicate field names
"RTN","RGUTDDR",11,0)
 ;   M = Retrieve multiples
"RTN","RGUTDDR",12,0)
 ; Return data:
"RTN","RGUTDDR",13,0)
 ;  DATA(0)   = -1^Error text or
"RTN","RGUTDDR",14,0)
 ;            = File #^File name^Rec count^Field count^Readonly^Parent File
"RTN","RGUTDDR",15,0)
 ;  DATA(n)   = Field #^Field name^Datatype^Size^Required^Readonly^Help lines^Xref^Calculated
"RTN","RGUTDDR",16,0)
 ;  DATA(n,0) = Supplemental data (set mappings)
"RTN","RGUTDDR",17,0)
 ;  DATA(n,1) = Prompt Text
"RTN","RGUTDDR",18,0)
 ;  DATA(n,2) = Help Text
"RTN","RGUTDDR",19,0)
GETDD(DATA,FNUM,FLDS,IENS,FLGS) ;
"RTN","RGUTDDR",20,0)
 N X,Y,Z,CNT,N0,FLD,PF,MULT,DUPS
"RTN","RGUTDDR",21,0)
 S DATA=$NA(^TMP("RGUTDDR",$J))
"RTN","RGUTDDR",22,0)
 K @DATA
"RTN","RGUTDDR",23,0)
 S FNUM=$G(FNUM),FLDS=$G(FLDS),FLGS=$G(FLGS),MULT=FLGS["M",DUPS=FLGS["D"
"RTN","RGUTDDR",24,0)
 I $L(FNUM),FNUM'=+FNUM D
"RTN","RGUTDDR",25,0)
 .S FNUM=$O(^DIC("B",FNUM,0))
"RTN","RGUTDDR",26,0)
 .I FNUM,$O(^(FNUM)) S FNUM=""
"RTN","RGUTDDR",27,0)
 S X=$$ROOT^DILFD(FNUM,$G(IENS),1),PF=$G(^DD(+FNUM,0,"UP"))
"RTN","RGUTDDR",28,0)
 S:$L(X) X=$G(@X@(0))
"RTN","RGUTDDR",29,0)
 S:PF $P(X,U)=$P($G(^DD(+FNUM,0)),U)
"RTN","RGUTDDR",30,0)
 I '$L(X) D SETERR("Table not found") Q
"RTN","RGUTDDR",31,0)
 S N0=FNUM_U_$P(X,U)_U_$P(X,U,4),CNT=0
"RTN","RGUTDDR",32,0)
 F X=1:1:$L(FLDS,";") D  Q:'X
"RTN","RGUTDDR",33,0)
 .S FLD=$P(FLDS,";",X)
"RTN","RGUTDDR",34,0)
 .Q:'$L(FLD)
"RTN","RGUTDDR",35,0)
 .S:FLD="*" FLD="0-9999999999999999"
"RTN","RGUTDDR",36,0)
 .I $TR(FLD,".")?1.N1"-"1.N D
"RTN","RGUTDDR",37,0)
 ..S Z=+$P(FLD,"-"),Y=+$P(FLD,"-",2)
"RTN","RGUTDDR",38,0)
 ..S:Z<0 Z=0
"RTN","RGUTDDR",39,0)
 ..I Z=0 S:'$$GETFL(0,0) X=0
"RTN","RGUTDDR",40,0)
 ..I Z>0,$D(^DD(FNUM,Z,0)) S:'$$GETFL(Z,MULT) X=0
"RTN","RGUTDDR",41,0)
 ..F  Q:'X  S Z=$O(^DD(FNUM,Z)) Q:'Z  Q:Z>Y  S:'$$GETFL(Z,MULT) X=0
"RTN","RGUTDDR",42,0)
 .E  I '$$GETFL(FLD,1) S X=0
"RTN","RGUTDDR",43,0)
 S:X @DATA@(0)=N0_U_CNT_U_($P($G(^DD(FNUM,0,"DI")),U,2)["Y")_U_PF
"RTN","RGUTDDR",44,0)
 Q
"RTN","RGUTDDR",45,0)
 ; Setup type info for field
"RTN","RGUTDDR",46,0)
 ;  FLDX = Field # or name
"RTN","RGUTDDR",47,0)
 ;  MULT = Allow multiples
"RTN","RGUTDDR",48,0)
 ; Note: Datatype (TP) maps to TFMFieldType enum:
"RTN","RGUTDDR",49,0)
 ;   0 = unknown, 1 = free text, 2 = numeric, 3 = boolean,
"RTN","RGUTDDR",50,0)
 ;   4 = date/time, 5 = wp, 6 = pointer, 7 = set, 8 = subfile
"RTN","RGUTDDR",51,0)
GETFL(FLDX,MULT) ;
"RTN","RGUTDDR",52,0)
 N X,Z,LN,TP,HC,DD,FLD,MLT,NAM
"RTN","RGUTDDR",53,0)
 S FLD=$$FLDNUM(FNUM,FLDX),MLT=0
"RTN","RGUTDDR",54,0)
 S DD=$S('$L(FLD):"",FLD:$G(^DD(FNUM,FLD,0)),1:"#^RICJ8,5"),X=$P(DD,U,2)
"RTN","RGUTDDR",55,0)
 I '$L(DD) D SETERR("Field not found: "_FLDX) Q 0
"RTN","RGUTDDR",56,0)
 I X,$P($G(^DD(X,.01,0)),U,2)'["W" S MLT=1
"RTN","RGUTDDR",57,0)
 I 'MULT,MLT Q 1
"RTN","RGUTDDR",58,0)
 S (LN,TP,HC,Z)=0,DX="",NAM=$P(DD,U),CNT=CNT+1
"RTN","RGUTDDR",59,0)
 I DUPS,$O(^(+$O(^DD(FNUM,"B",NAM,0)))) S NAM=NAM_"("_FLD_")"
"RTN","RGUTDDR",60,0)
 I MLT S TP=8,DX=+X
"RTN","RGUTDDR",61,0)
 E  I X["B" S TP=3
"RTN","RGUTDDR",62,0)
 E  I X["D" S TP=4,DX=$P($P($P(DD,U,5),"%DT=",2),"""",2)
"RTN","RGUTDDR",63,0)
 E  I X["F"!(X["K") S TP=1,LN=+$P($P(DD,U,5),"$L(X)>",2) S:'LN LN=30
"RTN","RGUTDDR",64,0)
 E  I X["J" S TP=2,DX=$P(X,"J",2) S:DX'["," LN=DX,DX="",TP=1
"RTN","RGUTDDR",65,0)
 E  I X["P"!(X["p") S TP=6,DX=+$P($TR(X,"p","P"),"P",2),LN=$$GETLN(DX)
"RTN","RGUTDDR",66,0)
 E  I X["S" S TP=7,DX=$P(DD,U,3)
"RTN","RGUTDDR",67,0)
 E  I X=+X S TP=5
"RTN","RGUTDDR",68,0)
 I 'FLD S HC=1,@DATA@(CNT,2,HC)="Internal record number."
"RTN","RGUTDDR",69,0)
 E  F  S Z=$O(^DD(FNUM,FLD,21,Z)) Q:'Z  S HC=HC+1,@DATA@(CNT,2,HC)=^(Z,0)
"RTN","RGUTDDR",70,0)
 S @DATA@(CNT)=FLD_U_NAM_U_TP_U_LN_U_(X["R")_U_(X["I")_U_HC_U_$$XREF(FNUM,FLD)_U_(X["C")
"RTN","RGUTDDR",71,0)
 S @DATA@(CNT,0)=DX,@DATA@(CNT,1)=$G(^DD(FNUM,FLD,3))
"RTN","RGUTDDR",72,0)
 Q 1
"RTN","RGUTDDR",73,0)
 ; Get length of .01 for file
"RTN","RGUTDDR",74,0)
GETLN(FNUM) ;
"RTN","RGUTDDR",75,0)
 N DD,X
"RTN","RGUTDDR",76,0)
 S DD=$G(^DD(FNUM,.01,0)),X=$P(DD,U,2)
"RTN","RGUTDDR",77,0)
 S X=+$S(X["P":$$GETLN(+$E(X,2,99)),X["F":$P($P(DD,U,5),"$L(X)>",2),1:0)
"RTN","RGUTDDR",78,0)
 Q $S(X:X,1:30)
"RTN","RGUTDDR",79,0)
SETERR(ERR) ;
"RTN","RGUTDDR",80,0)
 K @DATA
"RTN","RGUTDDR",81,0)
 S @DATA@(0)="-1^"_ERR
"RTN","RGUTDDR",82,0)
 Q
"RTN","RGUTDDR",83,0)
 ; RPC: RGUTDDR MOVETO
"RTN","RGUTDDR",84,0)
 ; Move to specified record (returns IEN only)
"RTN","RGUTDDR",85,0)
 ; FNUM: File #
"RTN","RGUTDDR",86,0)
 ; IEN : Current IEN
"RTN","RGUTDDR",87,0)
 ; DIR : 0 = current; 1 = next; 2 = prior
"RTN","RGUTDDR",88,0)
 ; IENS: Subfile IENS
"RTN","RGUTDDR",89,0)
 ; SCRN: Screens (optional)
"RTN","RGUTDDR",90,0)
 ; INDX: Index (optional)
"RTN","RGUTDDR",91,0)
 ; Returns IEN or <error code>^<error text>
"RTN","RGUTDDR",92,0)
MOVETO(DATA,FNUM,IEN,DIR,IENS,SCRN,INDX) ;
"RTN","RGUTDDR",93,0)
 N GBL,IDX,IDF,OK
"RTN","RGUTDDR",94,0)
 S GBL=$$ROOT^DILFD(FNUM,$G(IENS),1),DIR=+$G(DIR),INDX=$G(INDX)
"RTN","RGUTDDR",95,0)
 S DIR=$S(DIR=1:1,DIR=2:-1,1:0)
"RTN","RGUTDDR",96,0)
 S:$L($G(SCRN)) SCRN(-1)=SCRN
"RTN","RGUTDDR",97,0)
 I '$L(GBL) S DATA="-4^Table not found" Q
"RTN","RGUTDDR",98,0)
 I $L(INDX) D  Q:$G(DATA)
"RTN","RGUTDDR",99,0)
 .I '$O(^DD(FNUM,0,"IX",INDX,"")) S DATA="-5^Index "_INDX_" not found" Q
"RTN","RGUTDDR",100,0)
 .S IDF=$$XREFFLD(FNUM,INDX)
"RTN","RGUTDDR",101,0)
 .I 'IDF S DATA="-6^Index "_INDX_" is not a standard index" Q
"RTN","RGUTDDR",102,0)
 .S IDX=$S(IEN=-1:"",IEN=-2:$C(255),1:$E($$FLDVAL(FNUM,IDF,IEN,GBL),1,30))
"RTN","RGUTDDR",103,0)
 E  S IEN=$S(IEN=-1:0,IEN=-2:$O(@GBL@($C(1)),-1)+1,1:+IEN)
"RTN","RGUTDDR",104,0)
 F  D  Q:OK!'IEN
"RTN","RGUTDDR",105,0)
 .S IEN=+$$NXTIEN
"RTN","RGUTDDR",106,0)
 .;S OK=IEN&(IEN\1=IEN)&$D(@GBL@(IEN,0)),SCRN=""
"RTN","RGUTDDR",107,0)
 .S OK=IEN&$D(@GBL@(IEN,0)),SCRN=""
"RTN","RGUTDDR",108,0)
 .F  Q:'OK  S SCRN=$O(SCRN(SCRN)) Q:'$L(SCRN)  D
"RTN","RGUTDDR",109,0)
 ..N Y
"RTN","RGUTDDR",110,0)
 ..S Y=IEN
"RTN","RGUTDDR",111,0)
 ..I $D(@GBL@(Y,0))
"RTN","RGUTDDR",112,0)
 ..X SCRN(SCRN)
"RTN","RGUTDDR",113,0)
 ..S OK=$T
"RTN","RGUTDDR",114,0)
 .I 'OK,'DIR S IEN=0
"RTN","RGUTDDR",115,0)
 S DATA=$S(OK:IEN,'DIR:"-3^Record not found",DIR=1:"-2^End of file",1:"-1^Beginning of file")
"RTN","RGUTDDR",116,0)
 Q
"RTN","RGUTDDR",117,0)
 ; Return next IEN
"RTN","RGUTDDR",118,0)
NXTIEN() Q:'DIR IEN
"RTN","RGUTDDR",119,0)
 Q:'$L(INDX) $O(@GBL@(IEN),DIR)
"RTN","RGUTDDR",120,0)
 N OK
"RTN","RGUTDDR",121,0)
 F  D  Q:OK!'$L(IDX)
"RTN","RGUTDDR",122,0)
 .S:IEN'>0 IDX=$O(@GBL@(INDX,IDX),DIR),IEN=""
"RTN","RGUTDDR",123,0)
 .S IEN=$S($L(IDX):$O(@GBL@(INDX,IDX,IEN),DIR),1:0)
"RTN","RGUTDDR",124,0)
 .;S OK=$S('IEN:0,1:$E($$FLDVAL(FNUM,IDF,IEN,GBL),1,30)=IDX)
"RTN","RGUTDDR",125,0)
 .S OK=$S('IEN:0,1:$D(@GBL@(IEN,0)))
"RTN","RGUTDDR",126,0)
 Q IEN
"RTN","RGUTDDR",127,0)
 ; Return field value (internal)
"RTN","RGUTDDR",128,0)
 ;  FIL  = File or subfile #
"RTN","RGUTDDR",129,0)
 ;  FLD  = Field #
"RTN","RGUTDDR",130,0)
 ;  IEN  = Record #
"RTN","RGUTDDR",131,0)
 ;  ROOT = Global root of file or subfile, or IENS of subfile
"RTN","RGUTDDR",132,0)
FLDVAL(FIL,FLD,IEN,ROOT) ;
"RTN","RGUTDDR",133,0)
 I FLD=0!(FLD="#") Q IEN
"RTN","RGUTDDR",134,0)
 N PC,ND,DD
"RTN","RGUTDDR",135,0)
 S:FLD'=+FLD FLD=+$O(^DD(FIL,"B",FLD,0))
"RTN","RGUTDDR",136,0)
 S DD=$G(^DD(FIL,FLD,0))
"RTN","RGUTDDR",137,0)
 Q:$P(DD,U,2)["C" $$GET1^DIQ(FIL,IEN_","_$P(ROOT,",",2,999),FLD,"I")
"RTN","RGUTDDR",138,0)
 S ND=$P(DD,U,4),PC=$P(ND,";",2),ND=$P(ND,";")
"RTN","RGUTDDR",139,0)
 S:$E(ROOT)'=U ROOT=$$ROOT^DILFD(FIL,ROOT,1)
"RTN","RGUTDDR",140,0)
 Q $S('$L(ND):"",1:$P($G(@ROOT@(IEN,ND)),U,PC))
"RTN","RGUTDDR",141,0)
 ; RPC: Lock/unlock a record
"RTN","RGUTDDR",142,0)
 ;   FNUM = File #
"RTN","RGUTDDR",143,0)
 ;   IENS = Record # (IENS format)
"RTN","RGUTDDR",144,0)
 ;   WAIT = If >=0, seconds to wait for lock.
"RTN","RGUTDDR",145,0)
 ;          If missing or null, perform unlock operation.
"RTN","RGUTDDR",146,0)
 ;   DATA = Returns 0 if successful, -n^Error Text if not.
"RTN","RGUTDDR",147,0)
LOCK(DATA,FNUM,IENS,WAIT) ;
"RTN","RGUTDDR",148,0)
 N X,IEN,OK,$ET
"RTN","RGUTDDR",149,0)
 S @$$TRAP^RGUTOS("LOCKERR^RGUTDDR")
"RTN","RGUTDDR",150,0)
 S $ET="",X=$$ROOT^DILFD(FNUM,IENS,1),DATA=0,IEN=+IENS
"RTN","RGUTDDR",151,0)
 I '$L(X) S DATA="-1^Table not found"  Q
"RTN","RGUTDDR",152,0)
 K:$G(WAIT)="" WAIT
"RTN","RGUTDDR",153,0)
 D LOCK^CIANBRPC(.OK,$NA(@X@(IEN)),.WAIT)
"RTN","RGUTDDR",154,0)
 S:'OK DATA="-2^Record locked by another process"
"RTN","RGUTDDR",155,0)
 Q
"RTN","RGUTDDR",156,0)
LOCKERR S DATA="-3^Unexpected error"
"RTN","RGUTDDR",157,0)
 Q
"RTN","RGUTDDR",158,0)
 ; RPC: Convert pointer internal<->external
"RTN","RGUTDDR",159,0)
CVTPTR(DATA,FNUM,VAL,EXT) ;
"RTN","RGUTDDR",160,0)
 I EXT S DATA=$$GET1^DIQ(FNUM,VAL,.01)
"RTN","RGUTDDR",161,0)
 E  D
"RTN","RGUTDDR",162,0)
 .N ROOT
"RTN","RGUTDDR",163,0)
 .S ROOT=$$ROOT^DILFD(FNUM,,1)
"RTN","RGUTDDR",164,0)
 .I '$L(ROOT) S DATA=""
"RTN","RGUTDDR",165,0)
 .E  I VAL?1"`"1.N D
"RTN","RGUTDDR",166,0)
 ..S VAL=+$E(VAL,2,999),DATA=$S('VAL:"",$D(@ROOT@(VAL,0))#2:VAL,1:"")
"RTN","RGUTDDR",167,0)
 .E  D
"RTN","RGUTDDR",168,0)
 ..N LP
"RTN","RGUTDDR",169,0)
 ..F LP=0:1:3 S DATA=$$CP(LP) Q:DATA
"RTN","RGUTDDR",170,0)
 Q
"RTN","RGUTDDR",171,0)
 ; Lookup value in "B" xref
"RTN","RGUTDDR",172,0)
CP(XFM) N RTN,LKP
"RTN","RGUTDDR",173,0)
 S LKP=$S(XFM#2:$E(VAL,1,30),1:VAL),LKP=$S(XFM\2:$$UP^XLFSTR(LKP),1:LKP),RTN=0
"RTN","RGUTDDR",174,0)
 F  S RTN=$O(@ROOT@("B",LKP,RTN)) Q:'RTN  Q:$P($G(@ROOT@(RTN,0)),U)=VAL
"RTN","RGUTDDR",175,0)
 Q RTN
"RTN","RGUTDDR",176,0)
 ; RPC: Find an entry using specified fields and values
"RTN","RGUTDDR",177,0)
 ;   FNUM = File number to search
"RTN","RGUTDDR",178,0)
 ;   IENS = IENS for subfile
"RTN","RGUTDDR",179,0)
 ;   FLGS = Search flags.  Combination of:
"RTN","RGUTDDR",180,0)
 ;       P = partial match
"RTN","RGUTDDR",181,0)
 ;       I = case insensitive
"RTN","RGUTDDR",182,0)
 ;   FLDS = Field #'s or names to search.  Can be ;-delimited or list.
"RTN","RGUTDDR",183,0)
 ;   VALS = Values to search.  Can be single value or list.
"RTN","RGUTDDR",184,0)
 ;   MAX  = Maximum entries to return (default=all)
"RTN","RGUTDDR",185,0)
 ;   Returns list of one or all IENs matching criteria or
"RTN","RGUTDDR",186,0)
 ;     -n^error text if error.
"RTN","RGUTDDR",187,0)
FIND(DATA,FNUM,IENS,FLGS,FLDS,VALS,MAX) ;
"RTN","RGUTDDR",188,0)
 N ROOT,QUIT,XRF,XKY,CNT,X
"RTN","RGUTDDR",189,0)
 S IENS=$G(IENS)
"RTN","RGUTDDR",190,0)
 I $L(IENS),$E(IENS)'="," S IENS=","_IENS
"RTN","RGUTDDR",191,0)
 S ROOT=$$ROOT^DILFD(FNUM,IENS,1),QUIT=0,FLGS=$G(FLGS),MAX=+$G(MAX),CNT=0
"RTN","RGUTDDR",192,0)
 S:$D(VALS)=1 VALS(1)=VALS
"RTN","RGUTDDR",193,0)
 I $D(FLDS)=1 F X=1:1:$L(FLDS,";") S FLDS(X)=$P(FLDS,";",X)
"RTN","RGUTDDR",194,0)
 F FLDS=0:0 S FLDS=$O(FLDS(FLDS)) Q:'FLDS  D  Q:QUIT
"RTN","RGUTDDR",195,0)
 .I '$D(VALS(FLDS)) S QUIT="-1^Not enough lookup values." Q
"RTN","RGUTDDR",196,0)
 .S X=$$FLDNUM(FNUM,FLDS(FLDS))
"RTN","RGUTDDR",197,0)
 .I '$L(X) S QUIT="-2^Unknown field "_FLDS(FLDS)_"." Q
"RTN","RGUTDDR",198,0)
 .S FLDS(FLDS)=X
"RTN","RGUTDDR",199,0)
 .I '$D(XRF) D
"RTN","RGUTDDR",200,0)
 ..S X=$$XREF(FNUM,X)
"RTN","RGUTDDR",201,0)
 ..S:$L(X) XRF=X,XKY=$S(FLGS["I":$$UP^XLFSTR(VALS(FLDS)),1:VALS(FLDS))
"RTN","RGUTDDR",202,0)
 I 'QUIT,'$D(XRF) S QUIT="-3^At least one field must be a key field."
"RTN","RGUTDDR",203,0)
 D:'QUIT FINDX
"RTN","RGUTDDR",204,0)
 I QUIT<0 K @DATA S @DATA@(0)=QUIT
"RTN","RGUTDDR",205,0)
 Q
"RTN","RGUTDDR",206,0)
FINDX G FINDN:XRF="#",FINDP:FLGS["P",FINDE
"RTN","RGUTDDR",207,0)
 ; Find by IEN
"RTN","RGUTDDR",208,0)
FINDN D FINDF(XKY)
"RTN","RGUTDDR",209,0)
 Q
"RTN","RGUTDDR",210,0)
 ; Find exact match
"RTN","RGUTDDR",211,0)
FINDE N XKT,IEN
"RTN","RGUTDDR",212,0)
 S IEN=0,XKT=$E(XKY,1,30)
"RTN","RGUTDDR",213,0)
 F  S IEN=$O(@ROOT@(XRF,XKT,IEN)) Q:'IEN  D  Q:QUIT
"RTN","RGUTDDR",214,0)
 .D FINDF(IEN)
"RTN","RGUTDDR",215,0)
 Q
"RTN","RGUTDDR",216,0)
 ; Partial match
"RTN","RGUTDDR",217,0)
FINDP N XKT,VAL,IEN,LEN
"RTN","RGUTDDR",218,0)
 S XKT=$E(XKY,1,30),VAL=XKT,LEN=$L(XKT)
"RTN","RGUTDDR",219,0)
 F  D  S VAL=$O(@ROOT@(XRF,VAL)) Q:$E(VAL,1,LEN)'=XKT!QUIT
"RTN","RGUTDDR",220,0)
 .S IEN=0
"RTN","RGUTDDR",221,0)
 .F  S IEN=$O(@ROOT@(XRF,VAL,IEN)) Q:'IEN  D  Q:QUIT
"RTN","RGUTDDR",222,0)
 ..D FINDF(IEN)
"RTN","RGUTDDR",223,0)
 Q
"RTN","RGUTDDR",224,0)
 ; Check fields for match.  Add to output if all match
"RTN","RGUTDDR",225,0)
FINDF(IEN) ;
"RTN","RGUTDDR",226,0)
 N FND
"RTN","RGUTDDR",227,0)
 S FLDS=0,FND=1
"RTN","RGUTDDR",228,0)
 F  S FLDS=$O(FLDS(FLDS)) Q:'FLDS  D  Q:'FND
"RTN","RGUTDDR",229,0)
 .S FND=$$FINDM(FLDS(FLDS),VALS(FLDS),IEN)
"RTN","RGUTDDR",230,0)
 I FND D
"RTN","RGUTDDR",231,0)
 .S CNT=CNT+1,@DATA@(CNT)=IEN
"RTN","RGUTDDR",232,0)
 .I MAX,CNT'<MAX S QUIT=1
"RTN","RGUTDDR",233,0)
 Q
"RTN","RGUTDDR",234,0)
 ; Check for match
"RTN","RGUTDDR",235,0)
FINDM(FLD,VAL,IEN) ;
"RTN","RGUTDDR",236,0)
 N VALX
"RTN","RGUTDDR",237,0)
 S VALX=$$FLDVAL(FNUM,FLD,IEN,ROOT)
"RTN","RGUTDDR",238,0)
 S:FLGS["I" VAL=$$UP^XLFSTR(VAL),VALX=$$UP^XLFSTR(VALX)
"RTN","RGUTDDR",239,0)
 Q $S(FLGS["P":$E(VALX,1,$L(VAL))=VAL,1:VAL=VALX)
"RTN","RGUTDDR",240,0)
 ; Return field number from name
"RTN","RGUTDDR",241,0)
FLDNUM(FNUM,FLD) ;EP
"RTN","RGUTDDR",242,0)
 Q $S(FLD=+FLD:FLD,FLD="#":0,1:$O(^DD(FNUM,"B",FLD,0)))
"RTN","RGUTDDR",243,0)
 ; Returns the standard xref for the specified field.
"RTN","RGUTDDR",244,0)
XREF(FNUM,FLD,LAST) ;EP
"RTN","RGUTDDR",245,0)
 N XREF
"RTN","RGUTDDR",246,0)
 S LAST=+$G(LAST),XREF="",FLD=$$FLDNUM(FNUM,FLD)
"RTN","RGUTDDR",247,0)
 Q:'$L(FLD) ""
"RTN","RGUTDDR",248,0)
 Q:'FLD "#"
"RTN","RGUTDDR",249,0)
 F  S LAST=$O(^DD(FNUM,FLD,1,LAST)) Q:'LAST  I $D(^(LAST,0)),$P(^(0),U,3)="" S XREF=$P(^(0),U,2) Q
"RTN","RGUTDDR",250,0)
 Q XREF
"RTN","RGUTDDR",251,0)
 ; Returns field # if xref is a standard type, or 0 if not.
"RTN","RGUTDDR",252,0)
XREFFLD(FNUM,XREF) ;EP
"RTN","RGUTDDR",253,0)
 N FLD,LAST,X
"RTN","RGUTDDR",254,0)
 S FLD=$O(^DD(FNUM,0,"IX",XREF,FNUM,0))
"RTN","RGUTDDR",255,0)
 Q:'FLD 0
"RTN","RGUTDDR",256,0)
 F  S X=$$XREF(FNUM,FLD,.LAST) Q:'$L(X)!(X=XREF)
"RTN","RGUTDDR",257,0)
 Q $S($L(X):FLD,1:0)
"RTN","RGUTDIC")
0^36^B30172675
"RTN","RGUTDIC",1,0)
RGUTDIC ;RG/IND/DKM - Encapsulated FileMan API;15-Feb-2007 10:32;DKM
"RTN","RGUTDIC",2,0)
 ;;3.0;RG UTILITIES;;Mar 20, 2007;Build 98
"RTN","RGUTDIC",3,0)
 ;;
"RTN","RGUTDIC",4,0)
 ;=================================================================
"RTN","RGUTDIC",5,0)
 ; Parameterized routine to add/edit/extract an entry in a
"RTN","RGUTDIC",6,0)
 ; FileMan file.  Encapsulates global structure info so no
"RTN","RGUTDIC",7,0)
 ; need to specify this directly.
"RTN","RGUTDIC",8,0)
 ; Inputs:
"RTN","RGUTDIC",9,0)
 ;    %CIADIC = Global root, file number, or bookmark
"RTN","RGUTDIC",10,0)
 ;    %CIACMD = n    : IEN of entry to process
"RTN","RGUTDIC",11,0)
 ;             0    : Process last IEN referenced
"RTN","RGUTDIC",12,0)
 ;             +n   : Move down to subfile n
"RTN","RGUTDIC",13,0)
 ;             -    : Move up to parent file
"RTN","RGUTDIC",14,0)
 ;             @n   : Delete IEN #n (or last referenced if missing)
"RTN","RGUTDIC",15,0)
 ;             =x;y : Lookup y at current level using options in x
"RTN","RGUTDIC",16,0)
 ;             ?x;y ; Lookup y using RGUTLKP utility with options in x
"RTN","RGUTDIC",17,0)
 ;             >x;y : Read fields specified in y using options in x
"RTN","RGUTDIC",18,0)
 ;             <x;y : Write fields specified in y using options in x
"RTN","RGUTDIC",19,0)
 ;             ~x;y : Same as <, but creates new entry
"RTN","RGUTDIC",20,0)
 ;             %n   : Force DINUM to n
"RTN","RGUTDIC",21,0)
 ; Outputs:
"RTN","RGUTDIC",22,0)
 ;     Returns in the first piece the IEN of the entry or...
"RTN","RGUTDIC",23,0)
 ;      0 = Entry was deleted
"RTN","RGUTDIC",24,0)
 ;     -1 = Entry was rejected
"RTN","RGUTDIC",25,0)
 ;     -2 = Entry locked by another process
"RTN","RGUTDIC",26,0)
 ;     -3 = Unexpected error
"RTN","RGUTDIC",27,0)
 ;=================================================================
"RTN","RGUTDIC",28,0)
ENTRY(%CIADIC,%CIACMD) ;
"RTN","RGUTDIC",29,0)
 S %CIADIC(0)=+$G(DUZ)
"RTN","RGUTDIC",30,0)
 N DUZ,DIC,DINUM,DIE,DIQ,DIQUIET,DIK,%CIAX,%CIAIEN,%CIAARG,%CIAN1,%CIAN2,%CIAZ,X,Y
"RTN","RGUTDIC",31,0)
 N DA,DC,DD,DG,DH,DK,DL,DO,DQ,DR,DU,DV,DW,DY
"RTN","RGUTDIC",32,0)
 S DUZ=%CIADIC(0),DUZ(0)="@",@$$TRAP^RGUTOS("ERROR^RGUTDIC"),%CIACMD=$G(%CIACMD),%CIAIEN="",DIQUIET=1
"RTN","RGUTDIC",33,0)
 ; Build the bookmark if a global reference or file # passed
"RTN","RGUTDIC",34,0)
 I %CIADIC'[U D
"RTN","RGUTDIC",35,0)
 .S:%CIADIC'=+%CIADIC %CIADIC=+$O(^DIC("B",%CIADIC,0))
"RTN","RGUTDIC",36,0)
 .S %CIADIC=$$ROOT^DILFD(%CIADIC)_U_U_%CIADIC
"RTN","RGUTDIC",37,0)
 I $P(%CIADIC,U,4)="" D
"RTN","RGUTDIC",38,0)
 .S %CIAZ=U_$P(%CIADIC,U,2),%CIAZ=$E(%CIAZ,1,$L(%CIAZ)-1),%CIAZ=%CIAZ_$S(%CIAZ["(":")",1:"")
"RTN","RGUTDIC",39,0)
 .S $P(%CIADIC,U,4)=$P(@%CIAZ@(0),U,2)
"RTN","RGUTDIC",40,0)
 F %CIAN1=1:1:$L(%CIACMD,"|") S %CIAARG=$P(%CIACMD,"|",%CIAN1),%CIAZ=$E(%CIAARG) D  Q:%CIAIEN<0
"RTN","RGUTDIC",41,0)
 .S %CIAN2=$F("-+=@><~?%",%CIAZ)
"RTN","RGUTDIC",42,0)
 .S:%CIAN2 %CIAN2=%CIAN2-1,%CIAARG=$E(%CIAARG,2,999)
"RTN","RGUTDIC",43,0)
 .D DA,@%CIAN2
"RTN","RGUTDIC",44,0)
 .S:%CIAIEN>0 $P(%CIADIC,U,3)=%CIAIEN
"RTN","RGUTDIC",45,0)
 S $P(%CIADIC,U)=%CIAIEN
"RTN","RGUTDIC",46,0)
 Q %CIADIC
"RTN","RGUTDIC",47,0)
 ; Set IEN
"RTN","RGUTDIC",48,0)
0 S:%CIAARG'<0 %CIAIEN=$S($D(@%CIADIC(2)@(+%CIAARG)):+%CIAARG,1:0),$P(%CIADIC,U,3)=%CIAIEN
"RTN","RGUTDIC",49,0)
 Q
"RTN","RGUTDIC",50,0)
 ; Move up to parent file
"RTN","RGUTDIC",51,0)
1 N %CIAX,%CIAY
"RTN","RGUTDIC",52,0)
 S $P(%CIADIC,U,4)=$P($P(%CIADIC,U,4),"|",2,999)
"RTN","RGUTDIC",53,0)
 S %CIAY=$P(%CIADIC,U,2),%CIAX=$L(%CIAY,"|"),$P(%CIADIC,U,2)=$P(%CIAY,"|",1,%CIAX-1)
"RTN","RGUTDIC",54,0)
 S %CIAIEN=+$P(%CIAY,"|",%CIAX),$P(%CIADIC,U,3)=%CIAIEN
"RTN","RGUTDIC",55,0)
 D DA
"RTN","RGUTDIC",56,0)
 Q
"RTN","RGUTDIC",57,0)
 ; Move down to subfile
"RTN","RGUTDIC",58,0)
2 N %CIAX,%CIAY,%CIAZ
"RTN","RGUTDIC",59,0)
 I $P(%CIADIC,U,3)'>0 S %CIAIEN=-1 Q
"RTN","RGUTDIC",60,0)
 S %CIAY=+$P(%CIADIC,U,4)
"RTN","RGUTDIC",61,0)
 S:%CIAARG'=+%CIAARG %CIAARG=+$O(^DD(%CIAY,"B",%CIAARG,0)),%CIAARG=+$P($G(^DD(%CIAY,%CIAARG,0)),U,2)
"RTN","RGUTDIC",62,0)
 S %CIAX=+%CIAARG,%CIAZ=+$O(^DD(%CIAY,"SB",%CIAX,0)),%CIAZ=$P($P(^DD(%CIAY,%CIAZ,0),U,4),";"),%CIAX=$P(^(0),U,2)
"RTN","RGUTDIC",63,0)
 S:%CIAZ'=+%CIAZ %CIAZ=""""_%CIAZ_""""
"RTN","RGUTDIC",64,0)
 S $P(%CIADIC,U,4)=%CIAX_"|"_$P(%CIADIC,U,4),$P(%CIADIC,U,2)=$P(%CIADIC,U,2)_"|"_$P(%CIADIC,U,3)_","_%CIAZ_","
"RTN","RGUTDIC",65,0)
 S %CIAIEN="",$P(%CIADIC,U,3)=""
"RTN","RGUTDIC",66,0)
 D DA
"RTN","RGUTDIC",67,0)
 Q
"RTN","RGUTDIC",68,0)
 ; Lookup an entry
"RTN","RGUTDIC",69,0)
3 N X,Y
"RTN","RGUTDIC",70,0)
 I %CIAARG[";" S DIC(0)=$P(%CIAARG,";"),%CIAARG=$P(%CIAARG,";",2,999)
"RTN","RGUTDIC",71,0)
 E  S DIC(0)="XMF"
"RTN","RGUTDIC",72,0)
 S DIC=%CIADIC(1),X=%CIAARG
"RTN","RGUTDIC",73,0)
 D ^DIC
"RTN","RGUTDIC",74,0)
 S %CIAIEN=+Y
"RTN","RGUTDIC",75,0)
 Q
"RTN","RGUTDIC",76,0)
 ; Delete an entry
"RTN","RGUTDIC",77,0)
4 N X,Y
"RTN","RGUTDIC",78,0)
 S:%CIAARG DA=%CIAARG
"RTN","RGUTDIC",79,0)
 S DIK=%CIADIC(1),%CIAIEN=0
"RTN","RGUTDIC",80,0)
 D ^DIK
"RTN","RGUTDIC",81,0)
 Q
"RTN","RGUTDIC",82,0)
 ; Extract data
"RTN","RGUTDIC",83,0)
5 N %CIAZ,%CIAZ1,%CIAX,%CIAY
"RTN","RGUTDIC",84,0)
 I '%CIAIEN S %CIAIEN=-1 Q
"RTN","RGUTDIC",85,0)
 S DR=""
"RTN","RGUTDIC",86,0)
 F %CIAX=2:1:$L(%CIAARG,";") D
"RTN","RGUTDIC",87,0)
 .S %CIAY=$P(%CIAARG,";",%CIAX)
"RTN","RGUTDIC",88,0)
 .I %CIAY["=" S %CIAZ=$$FLD($P(%CIAY,"=",2)),%CIAZ1(%CIAZ,$P(%CIAY,"="))="",%CIAY=%CIAZ
"RTN","RGUTDIC",89,0)
 .S DR=DR_$S($L(DR):";",1:"")_%CIAY
"RTN","RGUTDIC",90,0)
 S DIC=%CIADIC(1),DIQ(0)=$P(%CIAARG,";")
"RTN","RGUTDIC",91,0)
 S:DIQ(0)="" DIQ(0)="E"
"RTN","RGUTDIC",92,0)
 K ^UTILITY("DIQ1",$J)
"RTN","RGUTDIC",93,0)
 D
"RTN","RGUTDIC",94,0)
 .N X,Y
"RTN","RGUTDIC",95,0)
 .D EN^DIQ1
"RTN","RGUTDIC",96,0)
 F %CIAX=0:0 S %CIAX=$O(%CIAZ1(%CIAX)),%CIAZ="" Q:'%CIAX  D
"RTN","RGUTDIC",97,0)
 .F  S %CIAZ=$O(%CIAZ1(%CIAX,%CIAZ)),%CIAZ1="" Q:%CIAZ=""  D
"RTN","RGUTDIC",98,0)
 ..F %CIAY="E","I" D
"RTN","RGUTDIC",99,0)
 ...S:$D(^UTILITY("DIQ1",$J,+$P(%CIADIC,U,4),%CIAIEN,%CIAX,%CIAY)) %CIAZ1=%CIAZ1_$S($L(%CIAZ1):U,1:"")_^(%CIAY)
"RTN","RGUTDIC",100,0)
 ..S @%CIAZ=%CIAZ1
"RTN","RGUTDIC",101,0)
 Q
"RTN","RGUTDIC",102,0)
 ; Edit existing entry
"RTN","RGUTDIC",103,0)
6 S DIC(0)=$P(%CIAARG,";"),DIC("P")=$P($P(%CIADIC,U,4),"|"),%CIAARG=$P(%CIAARG,";",2,999)
"RTN","RGUTDIC",104,0)
 I %CIAIEN'>0 S %CIAIEN=-1 Q
"RTN","RGUTDIC",105,0)
 S DIE=%CIADIC(1),DR=%CIAARG
"RTN","RGUTDIC",106,0)
 L +@%CIADIC(2)@(%CIAIEN):$S(DIC(0)["!":9999999,1:0)
"RTN","RGUTDIC",107,0)
 E  S %CIAIEN=-2 Q
"RTN","RGUTDIC",108,0)
 D ^DIE
"RTN","RGUTDIC",109,0)
 L -@%CIADIC(2)@(%CIAIEN)
"RTN","RGUTDIC",110,0)
 S %CIAIEN=+$G(DA)
"RTN","RGUTDIC",111,0)
 Q
"RTN","RGUTDIC",112,0)
 ; Create new entry
"RTN","RGUTDIC",113,0)
7 N X,Y,DD,DO,DLAYGO
"RTN","RGUTDIC",114,0)
 S DIC=%CIADIC(1),DIC(0)=$P(%CIAARG,";")_"L",DIC("P")=$P($P(%CIADIC,U,4),"|"),Y=$P(%CIAARG,";",2),%CIAARG=DIC(0)_";"_$P(%CIAARG,";",3,999),DLAYGO=DIC("P")\1
"RTN","RGUTDIC",115,0)
 I +Y'=.01 S %CIAIEN=-1 Q
"RTN","RGUTDIC",116,0)
 S X=$P(Y,"/",4)
"RTN","RGUTDIC",117,0)
 S:X="" X=$P(Y,"/",5)
"RTN","RGUTDIC",118,0)
 X:$E(X)=U $E(X,2,999)
"RTN","RGUTDIC",119,0)
 I $P(^DD(+DIC("P"),.01,0),U,2)["W" D
"RTN","RGUTDIC",120,0)
 .D WP
"RTN","RGUTDIC",121,0)
 E  D ^DIC:DIC(0)'["U",FILE^DICN:DIC(0)["U"
"RTN","RGUTDIC",122,0)
 S %CIAIEN=+Y
"RTN","RGUTDIC",123,0)
 I %CIAIEN>0,$P(%CIAARG,";",2,99)'="" D DA,6
"RTN","RGUTDIC",124,0)
 K DINUM
"RTN","RGUTDIC",125,0)
 Q
"RTN","RGUTDIC",126,0)
8 ; Lookup entry
"RTN","RGUTDIC",127,0)
 N %CIAOPT,%CIAP,CIAFN
"RTN","RGUTDIC",128,0)
 S %CIAOPT=$P(%CIAARG,";"),%CIAARG=$P(%CIAARG,";",2,999),CIAFN=+$P(%CIADIC,U,4)
"RTN","RGUTDIC",129,0)
 S %CIAP=+$P(%CIADIC,U,4),%CIAP=$P($G(^DD(%CIAP,.01,0)),U)
"RTN","RGUTDIC",130,0)
 S:$L(%CIAP) %CIAP=%CIAP_": "
"RTN","RGUTDIC",131,0)
 S %CIAIEN=$$ENTRY^RGUTLKP(%CIADIC(2),%CIAOPT,%CIAP,"",%CIAARG,"","",$X,$Y,"","","HLP^RGUTDIC")
"RTN","RGUTDIC",132,0)
 Q
"RTN","RGUTDIC",133,0)
 ; Force DINUM
"RTN","RGUTDIC",134,0)
9 S DINUM=%CIAARG
"RTN","RGUTDIC",135,0)
 Q
"RTN","RGUTDIC",136,0)
HLP W $G(^DD(+CIAFN,.01,3)),!
"RTN","RGUTDIC",137,0)
 Q
"RTN","RGUTDIC",138,0)
 ; Word processing field (special case of #7)
"RTN","RGUTDIC",139,0)
WP N %CIAZ,%CIAZ1
"RTN","RGUTDIC",140,0)
 I X="@" D
"RTN","RGUTDIC",141,0)
 .K @%CIADIC(2)
"RTN","RGUTDIC",142,0)
 .S Y=0
"RTN","RGUTDIC",143,0)
 E  D
"RTN","RGUTDIC",144,0)
 .S %CIAZ=$G(@%CIADIC(2)@(0)),Y=$G(DINUM,1+$O(^($C(1)),-1))
"RTN","RGUTDIC",145,0)
 .S %CIAZ1=+$P(%CIAZ,U,4),%CIAZ=+$P(%CIAZ,U,3)
"RTN","RGUTDIC",146,0)
 .S:Y>%CIAZ %CIAZ=Y
"RTN","RGUTDIC",147,0)
 .S:'$D(^(Y)) %CIAZ1=%CIAZ1+1
"RTN","RGUTDIC",148,0)
 .S ^(0)=U_U_%CIAZ_U_%CIAZ1_U_$G(DT),^(Y,0)=X
"RTN","RGUTDIC",149,0)
 Q:$P(^DD(+DIC("P"),.01,0),U,2)'["a"
"RTN","RGUTDIC",150,0)
 S %CIAIEN=Y
"RTN","RGUTDIC",151,0)
 D DA,WPAUDIT^CCCODAUD(+DIC("P"),.DA,X,"")
"RTN","RGUTDIC",152,0)
 Q
"RTN","RGUTDIC",153,0)
 ; Trap unexpected error
"RTN","RGUTDIC",154,0)
ERROR S $P(%CIADIC,U)=-3
"RTN","RGUTDIC",155,0)
 Q %CIADIC
"RTN","RGUTDIC",156,0)
 ; Return field #
"RTN","RGUTDIC",157,0)
FLD(X) Q $S(X=+X:X,1:+$O(^DD(+$P(%CIADIC,U,4),"B",X,0)))
"RTN","RGUTDIC",158,0)
 ; Set up DA array
"RTN","RGUTDIC",159,0)
DA N %CIAZ,%CIAZ1,%CIAZ2
"RTN","RGUTDIC",160,0)
 K DA
"RTN","RGUTDIC",161,0)
 S:'$G(%CIAIEN) %CIAIEN=$P(%CIADIC,U,3)
"RTN","RGUTDIC",162,0)
 S %CIAZ=$P(%CIADIC,U,2),%CIAZ2=$L(%CIAZ,"|"),DA=%CIAIEN
"RTN","RGUTDIC",163,0)
 F %CIAZ1=2:1:%CIAZ2 S DA(%CIAZ2-%CIAZ1+1)=+$P(%CIAZ,"|",%CIAZ1)
"RTN","RGUTDIC",164,0)
 S %CIADIC(1)=U_$TR($P(%CIADIC,U,2),"|"),%CIADIC(2)=$E(%CIADIC(1),1,$L(%CIADIC(1))-1),%CIADIC(2)=%CIADIC(2)_$S(%CIADIC(2)["(":")",1:"")
"RTN","RGUTDIC",165,0)
 Q
"RTN","RGUTDT")
0^37^B5201713
"RTN","RGUTDT",1,0)
RGUTDT ;RG/IND/DKM - FM date to formatted date;04-May-2006 08:19;DKM
"RTN","RGUTDT",2,0)
 ;;3.0;RG UTILITIES;;Mar 20, 2007;Build 98
"RTN","RGUTDT",3,0)
 ;;
"RTN","RGUTDT",4,0)
 ;=================================================================
"RTN","RGUTDT",5,0)
 ; Inputs:
"RTN","RGUTDT",6,0)
 ;   CIADAT = date to format (DHCP format or $H format)
"RTN","RGUTDT",7,0)
 ;   CIAFMT = date and time format control (optional)
"RTN","RGUTDT",8,0)
 ;      xxx0 = dd-mmm-yyyy
"RTN","RGUTDT",9,0)
 ;      xxx1 = mmm dd,yyyy
"RTN","RGUTDT",10,0)
 ;      xxx2 = mm/dd/yyyy
"RTN","RGUTDT",11,0)
 ;      xxx3 = mm-dd-yyyy
"RTN","RGUTDT",12,0)
 ;      xx0x = hh:mm
"RTN","RGUTDT",13,0)
 ;      xx1x = hh:mm xx
"RTN","RGUTDT",14,0)
 ;      x0xx = use space to separate date/time
"RTN","RGUTDT",15,0)
 ;      x1xx = use @ to separate date/time
"RTN","RGUTDT",16,0)
 ;      0xxx = allow leading zeros
"RTN","RGUTDT",17,0)
 ;      1xxx = remove leading zeros
"RTN","RGUTDT",18,0)
 ; Outputs:
"RTN","RGUTDT",19,0)
 ;   Returns formatted date
"RTN","RGUTDT",20,0)
 ;=================================================================
"RTN","RGUTDT",21,0)
ENTRY(CIADAT,CIAFMT) ; EP
"RTN","RGUTDT",22,0)
 S CIADAT=$G(CIADAT,$H)
"RTN","RGUTDT",23,0)
 Q:'CIADAT ""
"RTN","RGUTDT",24,0)
 N CIAZ1,CIAZ2,CIAZ3,CIAZ4,CIADLM,CIATM
"RTN","RGUTDT",25,0)
 S:CIADAT?1.N1",".N CIADAT=$$HTFM^XLFDT(CIADAT)
"RTN","RGUTDT",26,0)
 S CIAFMT=$G(CIAFMT)#100000,CIAFMT=CIAFMT#10000,CIAZ4=CIAFMT\1000,CIAFMT=CIAFMT#1000,CIADLM=$S(CIAFMT>99:"@",1:" "),CIAFMT=CIAFMT#100,CIATM=CIAFMT\10,CIAFMT=CIAFMT#10
"RTN","RGUTDT",27,0)
 I CIADAT\1 D
"RTN","RGUTDT",28,0)
 .S CIAZ3=CIADAT\1+17000000,CIAZ1=$E(CIAZ3,7,8),CIAZ2=$E(CIAZ3,5,6),CIAZ3=$E(CIAZ3,1,4)
"RTN","RGUTDT",29,0)
 .S:CIAZ4 CIAZ1=+CIAZ1,CIAZ2=+CIAZ2
"RTN","RGUTDT",30,0)
 .S:CIAFMT<2 CIAZ2=$P("Jan,Feb,Mar,Apr,May,Jun,Jul,Aug,Sep,Oct,Nov,Dec",",",CIAZ2)
"RTN","RGUTDT",31,0)
 .S CIAZ1=$S('CIAFMT:CIAZ1_"-"_CIAZ2_"-"_CIAZ3,CIAFMT=1:CIAZ2_" "_CIAZ1_","_CIAZ3,CIAFMT=2:CIAZ2_"/"_CIAZ1_"/"_CIAZ3,1:CIAZ2_"-"_CIAZ1_"-"_CIAZ3)
"RTN","RGUTDT",32,0)
 E  S CIAZ1=""
"RTN","RGUTDT",33,0)
 S CIAZ2=CIADAT#1*10000+10000\1
"RTN","RGUTDT",34,0)
 I CIAZ2=10000!(CIAZ2>12400) S CIAZ2=""
"RTN","RGUTDT",35,0)
 E  D
"RTN","RGUTDT",36,0)
 .S:CIATM CIAZ2=$S(CIAZ2=12400:CIAZ2-1200_" am",CIAZ2>11299:CIAZ2-1200_" pm",CIAZ2>11199:CIAZ2_" pm",CIAZ2<10099:CIAZ2+1200_" am",1:CIAZ2_" am")
"RTN","RGUTDT",37,0)
 .S CIAZ3=$S(CIAZ4:+$E(CIAZ2,2,3),1:$E(CIAZ2,2,3)),CIAZ2=CIAZ3_":"_$E(CIAZ2,4,8)
"RTN","RGUTDT",38,0)
 Q CIAZ1_$S('$L(CIAZ2):"",$L(CIAZ1):CIADLM,1:"")_CIAZ2
"RTN","RGUTEDT")
0^38^B50036890
"RTN","RGUTEDT",1,0)
RGUTEDT ;RG/IND/DKM - Screen-oriented line editor;20-Jan-2015 13:23;DKM
"RTN","RGUTEDT",2,0)
 ;;3.0;RG UTILITIES;;Mar 20, 2007;Build 98
"RTN","RGUTEDT",3,0)
 ;;
"RTN","RGUTEDT",4,0)
 ;=================================================================
"RTN","RGUTEDT",5,0)
 ; Inputs:
"RTN","RGUTEDT",6,0)
 ;   CIADATA  = Data to edit
"RTN","RGUTEDT",7,0)
 ;   CIALEN   = Maximum length of data
"RTN","RGUTEDT",8,0)
 ;   CIAX     = Starting column position
"RTN","RGUTEDT",9,0)
 ;   CIAY     = Starting row position
"RTN","RGUTEDT",10,0)
 ;   CIAVALD  = List of valid inputs (optional)
"RTN","RGUTEDT",11,0)
 ;   CIADISV  = DISV node to save under (optional)
"RTN","RGUTEDT",12,0)
 ;   CIATERM  = Valid input terminators (default=<CR>)
"RTN","RGUTEDT",13,0)
 ;   CIAABRT  = Valid input abort characters (default=none)
"RTN","RGUTEDT",14,0)
 ;   CIARM    = Right margin setting (default=IOM or 80)
"RTN","RGUTEDT",15,0)
 ;   CIAQUIT  = Exit code (returned)
"RTN","RGUTEDT",16,0)
 ;   CIAOPT   = Input options
"RTN","RGUTEDT",17,0)
 ;      C = Mark <CR> with ~
"RTN","RGUTEDT",18,0)
 ;      E = Echo off
"RTN","RGUTEDT",19,0)
 ;      H = Horizontal scroll
"RTN","RGUTEDT",20,0)
 ;      I = No timeout
"RTN","RGUTEDT",21,0)
 ;      L = Lowercase only
"RTN","RGUTEDT",22,0)
 ;      O = Overwrite mode
"RTN","RGUTEDT",23,0)
 ;      Q = Quiet mode
"RTN","RGUTEDT",24,0)
 ;      R = Reverse video
"RTN","RGUTEDT",25,0)
 ;      T = Auto-terminate
"RTN","RGUTEDT",26,0)
 ;      U = Uppercase only
"RTN","RGUTEDT",27,0)
 ;      V = Up/down cursor keys terminate input
"RTN","RGUTEDT",28,0)
 ;      X = Suppress auto-erase
"RTN","RGUTEDT",29,0)
 ; Outputs:
"RTN","RGUTEDT",30,0)
 ;   Return value = Edited data
"RTN","RGUTEDT",31,0)
 ;=================================================================
"RTN","RGUTEDT",32,0)
ENTRY(CIADATA,CIALEN,CIAX,CIAY,CIAVALD,CIAOPT,CIADISV,CIATERM,CIAABRT,CIARM,CIAQUIT) ;
"RTN","RGUTEDT",33,0)
 N CIAZ,CIAZ1,CIAZ2,CIASAVE,CIAINS,CIAAE,CIABUF,CIATAB,CIAPOS,CIAEON,CIALEFT,CIABEL,CIAMAX,CIARVON,CIARVOFF,CIAC,CIAW
"RTN","RGUTEDT",34,0)
 S CIAVALD=$G(CIAVALD),CIAOPT=$$UP^XLFSTR($G(CIAOPT)),CIABEL=$S(CIAOPT'["Q":$C(7),1:""),CIADISV=$G(CIADISV)
"RTN","RGUTEDT",35,0)
 S:$G(CIATERM)="" CIATERM=$C(13)                                         ; Valid line terminators
"RTN","RGUTEDT",36,0)
 S CIAABRT=$G(CIAABRT)                                                   ; Valid input abort keys
"RTN","RGUTEDT",37,0)
 S CIARVON=$C(27,91,55,109),CIARVOFF=$C(27,91,109)                       ; Reverse video control
"RTN","RGUTEDT",38,0)
 S CIAINS=CIAOPT'["O"                                                    ; Default mode = insert
"RTN","RGUTEDT",39,0)
 S CIAAE=CIAOPT'["X"                                                     ; Auto-erase option
"RTN","RGUTEDT",40,0)
 S CIAEON=CIAOPT'["E"                                                    ; No echo option
"RTN","RGUTEDT",41,0)
 I CIAOPT["I"!'$D(DTIME) N DTIME S DTIME=999999                          ; Suppress timeout option
"RTN","RGUTEDT",42,0)
 S CIABUF=""
"RTN","RGUTEDT",43,0)
 S CIARM=$G(CIARM,$G(IOM,80))                                            ; Display width
"RTN","RGUTEDT",44,0)
 S CIATAB=$C(9)                                                         ; Tab character
"RTN","RGUTEDT",45,0)
 S CIAX=$G(CIAX,$X),CIAY=$G(CIAY,$Y),CIAW=CIARM-CIAX
"RTN","RGUTEDT",46,0)
 S:CIAW'>0 CIAW=1
"RTN","RGUTEDT",47,0)
 S:'$G(CIALEN) CIALEN=CIAW                                                ; Default field width
"RTN","RGUTEDT",48,0)
 S CIAMAX=$S(CIAOPT["H":250,1:CIALEN)                                     ; Maximum data length
"RTN","RGUTEDT",49,0)
 S (CIASAVE,CIADATA)=$E($G(CIADATA),1,CIAMAX)                              ; Truncate data if too long
"RTN","RGUTEDT",50,0)
 I $$NEWERR^%ZTER N $ET S $ET=""
"RTN","RGUTEDT",51,0)
 S @$$TRAP^RGUTOS("ERROR^RGUTEDT")
"RTN","RGUTEDT",52,0)
 D RM^RGUTOS(0)
"RTN","RGUTEDT",53,0)
 X ^%ZOSF("EOFF")
"RTN","RGUTEDT",54,0)
 F  Q:CIADATA'[CIATAB  S CIAZ=$P(CIADATA,CIATAB),CIADATA=CIAZ_$J("",8-($L(CIAZ)#8))_$P(CIADATA,CIATAB,2,999)
"RTN","RGUTEDT",55,0)
RESTART D RESET
"RTN","RGUTEDT",56,0)
AGAIN F CIAQUIT=0:0 Q:CIAQUIT  D NXT S CIAAE=0
"RTN","RGUTEDT",57,0)
 X ^%ZOSF("EON")
"RTN","RGUTEDT",58,0)
 W $$XY^RGUT(CIAX,CIAY),$S(CIAOPT["R":CIARVOFF,1:"")
"RTN","RGUTEDT",59,0)
 I CIADISV'="" Q:"^^"[CIADATA CIADATA S:CIADATA=" " CIADATA=$G(^DISV(DUZ,CIADISV))
"RTN","RGUTEDT",60,0)
 S:CIADISV'="" ^DISV(DUZ,CIADISV)=CIADATA
"RTN","RGUTEDT",61,0)
 Q CIADATA                                                              ; Return to calling routine
"RTN","RGUTEDT",62,0)
NXT D POSCUR()                                                            ; Position cursor
"RTN","RGUTEDT",63,0)
 R *CIAC:DTIME                                                          ; Next character typed
"RTN","RGUTEDT",64,0)
 I CIAC=27 D ESC Q:'CIAC
"RTN","RGUTEDT",65,0)
 I CIAC<1!(CIAABRT[$C(CIAC)) S CIADATA=U,CIAQUIT=1 Q
"RTN","RGUTEDT",66,0)
 I CIATERM[$C(CIAC) D TERM Q
"RTN","RGUTEDT",67,0)
 I CIAC<28 D:CIAC'=27 @("CTL"_$C(CIAC+64)) Q
"RTN","RGUTEDT",68,0)
 I CIAC=127!(CIAC=240) D CTLH Q
"RTN","RGUTEDT",69,0)
 I CIAC>64,CIAC<91,CIAOPT["L" S CIAC=CIAC+32
"RTN","RGUTEDT",70,0)
 E  I CIAC>96,CIAC<123,CIAOPT["U" S CIAC=CIAC-32
"RTN","RGUTEDT",71,0)
 I $L(CIAVALD),CIAVALD'[$C(CIAC) D RAISE^RGUTOS()
"RTN","RGUTEDT",72,0)
 D:CIAAE CTLK,POSCUR()                                                  ; Erase buffer if auto erase on
"RTN","RGUTEDT",73,0)
 D INSW($C(CIAC))
"RTN","RGUTEDT",74,0)
 S CIAQUIT=CIAPOS=CIALEN&(CIAOPT["T")
"RTN","RGUTEDT",75,0)
 Q
"RTN","RGUTEDT",76,0)
CTLA S CIAINS='CIAINS                                                        ; Toggle insert mode
"RTN","RGUTEDT",77,0)
 Q
"RTN","RGUTEDT",78,0)
CTLB D MOVETO(0)                                                           ; Move cursor to beginning
"RTN","RGUTEDT",79,0)
 Q
"RTN","RGUTEDT",80,0)
CTLX S CIADATA=CIASAVE                                                       ; Restore buffer to original
"RTN","RGUTEDT",81,0)
 G RESET
"RTN","RGUTEDT",82,0)
CTLE D MOVETO($L(CIADATA))                                                  ; Move cursor to end
"RTN","RGUTEDT",83,0)
 Q
"RTN","RGUTEDT",84,0)
CTLI D INSW($J("",8-(CIAPOS#8)))                                            ; Insert expanded tab
"RTN","RGUTEDT",85,0)
 Q
"RTN","RGUTEDT",86,0)
CTLJ F CIAZ=CIAPOS:-1:1 Q:$A(CIADATA,CIAZ)'=32                                     ; Find previous nonspace
"RTN","RGUTEDT",87,0)
 F CIAZ=CIAZ:-1:1 Q:$A(CIADATA,CIAZ)=32                                          ; Find previous space
"RTN","RGUTEDT",88,0)
 S CIABUF=$E(CIADATA,CIAZ,CIAPOS)                                            ; Save deleted portion
"RTN","RGUTEDT",89,0)
 S CIADATA=$E(CIADATA,1,CIAZ-1)_$E(CIADATA,CIAPOS+1,CIALEN)                    ; Remove word
"RTN","RGUTEDT",90,0)
 D MOVETO(CIAZ-1)
"RTN","RGUTEDT",91,0)
 Q
"RTN","RGUTEDT",92,0)
CTLK S CIABUF=CIADATA                                                        ; Save buffer
"RTN","RGUTEDT",93,0)
 S CIADATA=""                                                           ; Erase buffer
"RTN","RGUTEDT",94,0)
 D RESET
"RTN","RGUTEDT",95,0)
 Q
"RTN","RGUTEDT",96,0)
CTLL S CIABUF=$E(CIADATA,CIAPOS+1,CIALEN)                                      ; Save deleted portion
"RTN","RGUTEDT",97,0)
 S CIADATA=$E(CIADATA,1,CIAPOS)                                           ; Truncate at current position
"RTN","RGUTEDT",98,0)
 D DSPLY(CIAPOS)
"RTN","RGUTEDT",99,0)
 Q
"RTN","RGUTEDT",100,0)
CTLM D POSCUR(CIAPOS),INSW("~"):CIAOPT["C",MOVETO(CIAPOS-$X+CIAX+CIAW)
"RTN","RGUTEDT",101,0)
 Q
"RTN","RGUTEDT",102,0)
CTLR D INSW(CIABUF)                                                         ; Insert at current position
"RTN","RGUTEDT",103,0)
 Q
"RTN","RGUTEDT",104,0)
CTLT D CTLL
"RTN","RGUTEDT",105,0)
 Q
"RTN","RGUTEDT",106,0)
CTLU S CIABUF=$E(CIADATA,1,CIAPOS)                                            ; Save deleted portion
"RTN","RGUTEDT",107,0)
 S CIADATA=$E(CIADATA,CIAPOS+1,CIALEN)                                     ; Remove to left of cursor
"RTN","RGUTEDT",108,0)
 D RESET
"RTN","RGUTEDT",109,0)
 Q
"RTN","RGUTEDT",110,0)
CTLH I 'CIAPOS W CIABEL Q
"RTN","RGUTEDT",111,0)
 D LEFT
"RTN","RGUTEDT",112,0)
CTLD S CIADATA=$E(CIADATA,1,CIAPOS)_$E(CIADATA,CIAPOS+2,CIAMAX)                  ; Delete character to left
"RTN","RGUTEDT",113,0)
 D DSPLY(CIAPOS,1)
"RTN","RGUTEDT",114,0)
 Q
"RTN","RGUTEDT",115,0)
TERM S CIAQUIT=2
"RTN","RGUTEDT",116,0)
 Q
"RTN","RGUTEDT",117,0)
ESC R *CIAZ:1
"RTN","RGUTEDT",118,0)
 R:CIAZ>0 *CIAZ:1
"RTN","RGUTEDT",119,0)
 S CIAC=0
"RTN","RGUTEDT",120,0)
 G UP:CIAZ=65,DOWN:CIAZ=66,RIGHT:CIAZ=67,LEFT:CIAZ=68                              ;Execute code
"RTN","RGUTEDT",121,0)
 S CIAC=27
"RTN","RGUTEDT",122,0)
 Q
"RTN","RGUTEDT",123,0)
DSPLY(CIAP1,CIAP2) ;
"RTN","RGUTEDT",124,0)
 Q:'CIAEON                                                              ; Refresh buffer display starting at position CIAP1
"RTN","RGUTEDT",125,0)
 N CIAZ,CIAZ1
"RTN","RGUTEDT",126,0)
 S CIAP1=+$G(CIAP1,CIALEFT),CIAZ=$E(CIADATA,CIAP1+1,CIALEFT+CIALEN),CIAP2=$S($D(CIAP2):CIAP2+$L(CIAZ),1:CIALEN-CIAP1+CIALEFT)
"RTN","RGUTEDT",127,0)
 S:CIAP2>CIALEN CIAP2=CIALEN
"RTN","RGUTEDT",128,0)
 S CIAZ=CIAZ_$J("",CIAP2-$L(CIAZ))
"RTN","RGUTEDT",129,0)
 F  D  Q:CIAZ=""
"RTN","RGUTEDT",130,0)
 .D POSCUR(CIAP1)
"RTN","RGUTEDT",131,0)
 .S CIAZ1=CIARM-$X
"RTN","RGUTEDT",132,0)
 .S:CIAZ1<1 CIAZ1=1
"RTN","RGUTEDT",133,0)
 .W $E(CIAZ,1,CIAZ1)
"RTN","RGUTEDT",134,0)
 .S CIAZ=$E(CIAZ,CIAZ1+1,999),CIAP1=CIAP1+CIAZ1
"RTN","RGUTEDT",135,0)
 Q
"RTN","RGUTEDT",136,0)
INSW(CIATXT) ;
"RTN","RGUTEDT",137,0)
 S:CIAPOS>$L(CIADATA) CIADATA=CIADATA_$J("",CIAPOS-$L(CIADATA))              ; Pad if past end of buffer
"RTN","RGUTEDT",138,0)
 S CIADATA=$E($E(CIADATA,1,CIAPOS)_CIATXT_$E(CIADATA,CIAPOS+2-CIAINS,CIAMAX),1,CIAMAX)
"RTN","RGUTEDT",139,0)
 D DSPLY(CIAPOS,0),MOVETO(CIAPOS+$L(CIATXT))
"RTN","RGUTEDT",140,0)
 Q
"RTN","RGUTEDT",141,0)
POSCUR(CIAP) ;
"RTN","RGUTEDT",142,0)
 N CIAZX,CIAZY
"RTN","RGUTEDT",143,0)
 S CIAP=+$G(CIAP,CIAPOS),CIAZX=CIAP-CIALEFT,CIAZY=CIAZX\CIAW+CIAY,CIAZX=CIAZX#CIAW+CIAX
"RTN","RGUTEDT",144,0)
 W $$XY^RGUT(CIAZX,CIAZY)
"RTN","RGUTEDT",145,0)
 Q
"RTN","RGUTEDT",146,0)
MOVETO(CIAP) ;
"RTN","RGUTEDT",147,0)
 I CIAP>CIAMAX!(CIAP<0) W CIABEL Q
"RTN","RGUTEDT",148,0)
 S CIAPOS=CIAP,CIAP=CIALEFT
"RTN","RGUTEDT",149,0)
 S:CIAPOS<CIALEFT CIALEFT=CIAPOS-CIAW-1
"RTN","RGUTEDT",150,0)
 S:CIALEFT+CIALEN<CIAPOS CIALEFT=CIAPOS-CIAW+1
"RTN","RGUTEDT",151,0)
 S:CIALEFT'<CIAMAX CIALEFT=CIAMAX-CIAW
"RTN","RGUTEDT",152,0)
 S:CIALEFT<0 CIALEFT=0
"RTN","RGUTEDT",153,0)
 D DSPLY():CIALEFT'=CIAP,POSCUR()
"RTN","RGUTEDT",154,0)
 Q
"RTN","RGUTEDT",155,0)
UP I CIAOPT["V" S CIAQUIT=3
"RTN","RGUTEDT",156,0)
 E  D MOVETO(CIAPOS-CIAW)
"RTN","RGUTEDT",157,0)
 Q
"RTN","RGUTEDT",158,0)
DOWN I CIAOPT["V" S CIAQUIT=4
"RTN","RGUTEDT",159,0)
 E  D MOVETO(CIAPOS+CIAW)
"RTN","RGUTEDT",160,0)
 Q
"RTN","RGUTEDT",161,0)
RIGHT D MOVETO(CIAPOS+1)
"RTN","RGUTEDT",162,0)
 Q
"RTN","RGUTEDT",163,0)
LEFT D MOVETO(CIAPOS-1)
"RTN","RGUTEDT",164,0)
 Q
"RTN","RGUTEDT",165,0)
RESET W $S(CIAOPT["R":CIARVON,1:CIARVOFF)
"RTN","RGUTEDT",166,0)
 S (CIAPOS,CIALEFT)=0                                                    ; Current edit offset
"RTN","RGUTEDT",167,0)
 D DSPLY()                                                             ; Refresh display
"RTN","RGUTEDT",168,0)
 Q
"RTN","RGUTEDT",169,0)
ERROR W CIABEL                                                               ; Sound bell
"RTN","RGUTEDT",170,0)
 S @$$TRAP^RGUTOS("ERROR^RGUTEDT")
"RTN","RGUTEDT",171,0)
 G AGAIN
"RTN","RGUTHFS")
0^61^B5078426
"RTN","RGUTHFS",1,0)
RGUTHFS ;RG/IND/DKM - Host IO Support ;04-May-2006 08:19;DKM
"RTN","RGUTHFS",2,0)
 ;;3.0;RG UTILITIES;;Mar 20, 2007;Build 98
"RTN","RGUTHFS",3,0)
 ;;
"RTN","RGUTHFS",4,0)
 ;=================================================================
"RTN","RGUTHFS",5,0)
 ; Capture output to HFS and optionally redirect to global
"RTN","RGUTHFS",6,0)
 ;   EXEC = Code to execute
"RTN","RGUTHFS",7,0)
 ;   ROOT = Global root to receive output (or null to leave in HFS)
"RTN","RGUTHFS",8,0)
 ;   RM   = Right margin setting (defaults to 80)
"RTN","RGUTHFS",9,0)
CAPTURE(EXEC,ROOT,RM) ;EP
"RTN","RGUTHFS",10,0)
 N UFN,HNDL,TMP,IOM,IOSL,IOST,IOF,IOT,IOS,$ET
"RTN","RGUTHFS",11,0)
 S $ET="",UFN=$$UFN^RGUT,TMP=$$DEFDIR^RGUTOS,HNDL="RGUTHFS",@$$TRAP^RGUTOS("ERR^RGUTHFS")
"RTN","RGUTHFS",12,0)
 S:$L($G(ROOT)) ROOT=$NA(@ROOT)
"RTN","RGUTHFS",13,0)
 D OPEN^%ZISH(HNDL,TMP,UFN,"W")
"RTN","RGUTHFS",14,0)
 D:'POP IOVAR(.RM),EXEC,HFSCLOSE(HNDL,UFN)
"RTN","RGUTHFS",15,0)
 Q:$Q TMP_UFN
"RTN","RGUTHFS",16,0)
 Q
"RTN","RGUTHFS",17,0)
EXEC X EXEC
"RTN","RGUTHFS",18,0)
 Q
"RTN","RGUTHFS",19,0)
 ; Error trap
"RTN","RGUTHFS",20,0)
ERR D @^%ZOSF("ERRTN"),HFSCLOSE(HNDL,UFN,1)
"RTN","RGUTHFS",21,0)
 Q:$Q ""
"RTN","RGUTHFS",22,0)
 Q
"RTN","RGUTHFS",23,0)
 ; Setup IO variables based on IO Device
"RTN","RGUTHFS",24,0)
IOVAR(XIOM,XIO,XIOSL,XIOST,XIOF,XIOT) ;
"RTN","RGUTHFS",25,0)
 N X
"RTN","RGUTHFS",26,0)
 S ION=$G(XIO,"RGUT HFS DEVICE"),IOS=+$O(^%ZIS(1,"B",ION,0)),IOM=80,IOSL=62,IOST=$G(XIOST,"P-OTHER"),IOF=$G(XIOF,""""""),IOT=$G(XIOT,"HFS")
"RTN","RGUTHFS",27,0)
 S:$D(^%ZIS(1,IOS,0)) IOST(0)=+$G(^("SUBTYPE")),IOT=$G(^("TYPE"),IOT),IOST=$P($G(^%ZIS(2,IOST(0),0),IOST),U)
"RTN","RGUTHFS",28,0)
 S X=$O(^%ZIS(2,"B",IOST,0))
"RTN","RGUTHFS",29,0)
 S:X IOST(0)=X,X=$G(^%ZIS(2,X,1)),IOM=$P(X,U),IOF=$P(X,U,2),IOSL=$P(X,U,3)
"RTN","RGUTHFS",30,0)
 S:$G(XIOM) IOM=XIOM
"RTN","RGUTHFS",31,0)
 S:$G(XIOSL) IOSL=XIOSL
"RTN","RGUTHFS",32,0)
 U IO
"RTN","RGUTHFS",33,0)
 Q
"RTN","RGUTHFS",34,0)
 ; Move HFS data to global (if ROOT specified) and cleanup
"RTN","RGUTHFS",35,0)
HFSCLOSE(HNDL,UFN,BAD) ;
"RTN","RGUTHFS",36,0)
 N DEL
"RTN","RGUTHFS",37,0)
 D GETDEV^%ZISUTL(HNDL)
"RTN","RGUTHFS",38,0)
 I IOT="HFS" D
"RTN","RGUTHFS",39,0)
 .D CLOSE^%ZISH(HNDL)
"RTN","RGUTHFS",40,0)
 E  D RMDEV^%ZISUTL(HNDL)
"RTN","RGUTHFS",41,0)
 Q:'$L($G(ROOT))
"RTN","RGUTHFS",42,0)
 K @ROOT
"RTN","RGUTHFS",43,0)
 I '$G(BAD),$$FTG^%ZISH($$DEFDIR^RGUTOS,UFN,$NA(@ROOT@(1)),$QL(ROOT)+1) D STRIP
"RTN","RGUTHFS",44,0)
 S DEL(UFN)=""
"RTN","RGUTHFS",45,0)
 I $$DEL^%ZISH($$DEFDIR^RGUTOS,"DEL")
"RTN","RGUTHFS",46,0)
 Q
"RTN","RGUTHFS",47,0)
 ; Strip off control chars and remove leading/trailing blank lines
"RTN","RGUTHFS",48,0)
STRIP N I,J,K,X
"RTN","RGUTHFS",49,0)
 S (I,J)=0
"RTN","RGUTHFS",50,0)
 F  S I=$O(@ROOT@(I)) Q:'I  S X=@ROOT@(I) D  S @ROOT@(I)=X
"RTN","RGUTHFS",51,0)
 .I X[$C(8),$L(X,$C(8))=$L(X,$C(95)) S X=$TR(X,$C(7,8,12,95))
"RTN","RGUTHFS",52,0)
 .E  S X=$TR(X,$C(7,8,12))
"RTN","RGUTHFS",53,0)
 .S:$L(X) J=I,K=$G(K,J)
"RTN","RGUTHFS",54,0)
 I $D(K) F  S I=$O(@ROOT@(I)) Q:I=K  K @ROOT@(I)
"RTN","RGUTHFS",55,0)
 F  S J=$O(@ROOT@(J)) Q:'J  K @ROOT@(J)
"RTN","RGUTHFS",56,0)
 Q
"RTN","RGUTIMP")
0^44^B12071934
"RTN","RGUTIMP",1,0)
RGUTIMP ;RG/IND/DKM - Import text into FileMan file;04-May-2006 08:19;DKM
"RTN","RGUTIMP",2,0)
 ;;3.0;RG UTILITIES;;Mar 20, 2007;Build 98
"RTN","RGUTIMP",3,0)
 ;;
"RTN","RGUTIMP",4,0)
 ;=================================================================
"RTN","RGUTIMP",5,0)
 ; Imports data from a specially formatted text file into a
"RTN","RGUTIMP",6,0)
 ; FileMan file.
"RTN","RGUTIMP",7,0)
 ; Inputs:
"RTN","RGUTIMP",8,0)
 ;   CIAINP  = Full input file or global specification.
"RTN","RGUTIMP",9,0)
 ;   CIATRACE= If nonzero, generates a debug trace.
"RTN","RGUTIMP",10,0)
 ; Outputs:
"RTN","RGUTIMP",11,0)
 ;   Returns status code^status message.  Status code of 0 means
"RTN","RGUTIMP",12,0)
 ;   successful completion.
"RTN","RGUTIMP",13,0)
 ;=================================================================
"RTN","RGUTIMP",14,0)
ENTRY(CIAINP,CIATRACE) ;
"RTN","RGUTIMP",15,0)
 N CIALN,CIAFN,CIALVL,CIABM,CIAC,CIALBL,CIAQT,CIAST,CIAIO,CIAGBL
"RTN","RGUTIMP",16,0)
 S @$$TRAP^RGUTOS("ERROR^RGUTIMP")
"RTN","RGUTIMP",17,0)
 S CIAFN=0,CIALVL=-1,CIATRACE=+$G(CIATRACE),CIAST=0,CIAIO=$I,U="^",CIAC=0,CIAGBL=$E(CIAINP)=U
"RTN","RGUTIMP",18,0)
 I CIAGBL S CIAINP=$$CREF^DILF(CIAINP)
"RTN","RGUTIMP",19,0)
 E  D OPEN^RGUTOS(.CIAINP,"R")
"RTN","RGUTIMP",20,0)
 F  Q:$$READ  D  Q:CIAST
"RTN","RGUTIMP",21,0)
 .U CIAIO
"RTN","RGUTIMP",22,0)
 .W:CIATRACE=1 CIAC,*13
"RTN","RGUTIMP",23,0)
 .W:CIATRACE=2 CIAC_": ",$$TRUNC^RGUT(CIALN,$G(IOM,80)-$X-2),!
"RTN","RGUTIMP",24,0)
 .D DOIT(CIALN)
"RTN","RGUTIMP",25,0)
 D:'CIAGBL CLOSE^RGUTOS(.CIAINP)
"RTN","RGUTIMP",26,0)
 Q CIAST
"RTN","RGUTIMP",27,0)
READ() I 'CIAGBL S CIAC=CIAC+1 Q $$READ^RGUTOS(.CIALN,CIAINP)
"RTN","RGUTIMP",28,0)
 S CIAC=$O(@CIAINP@(CIAC))
"RTN","RGUTIMP",29,0)
 Q:'CIAC 1
"RTN","RGUTIMP",30,0)
 I $D(@CIAINP@(CIAC))#2 S CIALN=@CIAINP@(CIAC) Q 0
"RTN","RGUTIMP",31,0)
 I $D(@CIAINP@(CIAC,0))#2 S CIALN=@CIAINP@(CIAC,0) Q 0
"RTN","RGUTIMP",32,0)
 Q 1
"RTN","RGUTIMP",33,0)
ERROR D ERR("Fatal error",$$EC^%ZOSV)
"RTN","RGUTIMP",34,0)
 Q CIAST
"RTN","RGUTIMP",35,0)
DOIT(CIALN) ;
"RTN","RGUTIMP",36,0)
 N CIAZ,CIAL,CIAFLD,CIAWP
"RTN","RGUTIMP",37,0)
 S CIALN=$$TRIM^RGUT(CIALN)
"RTN","RGUTIMP",38,0)
 I ";"[$E(CIALN) W:CIATRACE=3 $P(CIALN,";",2,999),! Q
"RTN","RGUTIMP",39,0)
 F CIAL=0:1 Q:$E(CIALN,CIAL+1)'="."
"RTN","RGUTIMP",40,0)
 S CIALN=$E(CIALN,CIAL+1,999)
"RTN","RGUTIMP",41,0)
 I CIALN'[":" D ERR("Missing label",CIALN) Q
"RTN","RGUTIMP",42,0)
 S CIALBL=$$TRIM^RGUT($P(CIALN,":")),CIALN=$$TRIM^RGUT($P(CIALN,":",2,999))
"RTN","RGUTIMP",43,0)
 I 'CIAL S CIAFN=$$FILE(CIALN) Q
"RTN","RGUTIMP",44,0)
 I CIAL>CIALVL D ERR("Invalid nesting",CIALN) Q
"RTN","RGUTIMP",45,0)
 S CIALVL=CIAL,CIAFN=+$P(CIABM(CIALVL),U,4)
"RTN","RGUTIMP",46,0)
 S CIAFLD=$$FLD(CIALBL,CIAFN)
"RTN","RGUTIMP",47,0)
 S CIAZ=+$P($G(^DD(CIAFN,CIAFLD,0)),U,2)
"RTN","RGUTIMP",48,0)
 I CIAZ D  Q:CIAST
"RTN","RGUTIMP",49,0)
 .S CIALVL=CIALVL+1,CIAFN=CIAZ,CIABM(CIALVL)=$$ENTRY^RGUTDIC(CIABM(CIALVL-1),"+"_CIAFN)
"RTN","RGUTIMP",50,0)
 .I +CIABM(CIALVL)<0 D ERR("Error access subfile entry",CIALBL) Q
"RTN","RGUTIMP",51,0)
 .S CIAFLD=$$FLD(.01,CIAFN)
"RTN","RGUTIMP",52,0)
 I 'CIAFLD D ERR("Unknown field",CIALBL) Q
"RTN","RGUTIMP",53,0)
 I 'CIAWP,CIALN="" Q
"RTN","RGUTIMP",54,0)
 ;S:CIALN="+" CIALN=U_$TR($P(CIABM(CIALVL),U,2),"|",",")_"$C(1))",CIALN=1+$O(@CIALN,-1)\1
"RTN","RGUTIMP",55,0)
 I CIAFLD=.01!'CIABM(CIALVL)!CIAWP D  Q
"RTN","RGUTIMP",56,0)
 .I 'CIAWP,CIAFLD'=.01 D ERR("First field is not primary index",CIALBL) Q
"RTN","RGUTIMP",57,0)
 .I 'CIAWP D
"RTN","RGUTIMP",58,0)
 ..S CIABM(CIALVL)=$$ENTRY^RGUTDIC(CIABM(CIALVL),"="_CIALN)
"RTN","RGUTIMP",59,0)
 ..S:+CIABM(CIALVL)'>0 CIABM(CIALVL)=$$ENTRY^RGUTDIC(CIABM(CIALVL),"="_$$UP^XLFSTR(CIALN))
"RTN","RGUTIMP",60,0)
 .S:+CIABM(CIALVL)'>0!CIAWP CIABM(CIALVL)=$$ENTRY^RGUTDIC(CIABM(CIALVL),$S(CIALN="@"&'CIAWP:CIALN,1:"~LX;.01///^S X=CIALN"))
"RTN","RGUTIMP",61,0)
 .I +CIABM(CIALVL)'>0,CIALN'="@" D ERR("Error adding entry",CIALN)
"RTN","RGUTIMP",62,0)
 S CIABM(CIALVL)=$$ENTRY^RGUTDIC(CIABM(CIALVL),"<;"_CIAFLD_"///^S X=CIALN")
"RTN","RGUTIMP",63,0)
 D:+CIABM(CIALVL)'>0 ERR("Error writing to field",CIALBL)
"RTN","RGUTIMP",64,0)
 Q
"RTN","RGUTIMP",65,0)
FILE(CIAFN) ;
"RTN","RGUTIMP",66,0)
 K CIABM
"RTN","RGUTIMP",67,0)
 S CIABM(1)=$$ENTRY^RGUTDIC(CIAFN),CIALVL=1
"RTN","RGUTIMP",68,0)
 I +CIABM(1)'<0 S CIAFN=+$P(CIABM(1),U,4)
"RTN","RGUTIMP",69,0)
 E  D ERR("Error accessing database",CIAFN)
"RTN","RGUTIMP",70,0)
 Q CIAFN
"RTN","RGUTIMP",71,0)
FLD(CIANM,CIAFN) ;
"RTN","RGUTIMP",72,0)
 N CIAZ
"RTN","RGUTIMP",73,0)
 S CIAZ=$S(CIANM="":.01,CIANM=+CIANM:CIANM,1:+$O(^DD(CIAFN,"B",CIANM,0)))
"RTN","RGUTIMP",74,0)
 I '$D(^DD(CIAFN,CIAZ,0)) S CIAZ=0
"RTN","RGUTIMP",75,0)
 E  S CIAWP=$P(^(0),U,2)["W"
"RTN","RGUTIMP",76,0)
 Q CIAZ
"RTN","RGUTIMP",77,0)
ERR(CIAMSG,CIAX) ;
"RTN","RGUTIMP",78,0)
 S CIAST=CIAC_U_CIAMSG_$S($D(CIAX):": "_CIAX,1:"")
"RTN","RGUTIMP",79,0)
 W:CIATRACE=2 CIAC_": "_$P(CIAST,U,2,999),!
"RTN","RGUTIMP",80,0)
 Q
"RTN","RGUTIN")
1^45
"RTN","RGUTIN0")
0^46^B1456400
"RTN","RGUTIN0",1,0)
RGUTIN0 ;RG/IND/DKM - Platform-dependent operations;04-May-2006 08:19;DKM
"RTN","RGUTIN0",2,0)
 ;;3.0;RG UTILITIES;;Mar 20, 2007;Build 98
"RTN","RGUTIN0",3,0)
 ;;
"RTN","RGUTIN0",4,0)
 ;=================================================================
"RTN","RGUTIN0",5,0)
 ; Return version #
"RTN","RGUTIN0",6,0)
VER() Q $P($T(+2),";",3)
"RTN","RGUTIN0",7,0)
CVTFN(CIAFIL,CIAROOT) ;
"RTN","RGUTIN0",8,0)
 N CIAZ,CIAZ1,CIAD
"RTN","RGUTIN0",9,0)
 S CIAD=$$DIRDLM,CIAROOT=$G(CIAROOT)
"RTN","RGUTIN0",10,0)
 S:$E(CIAROOT,$L(CIAROOT))=$E(CIAD,3) CIAROOT=$E(CIAROOT,1,$L(CIAROOT)-1)
"RTN","RGUTIN0",11,0)
 S CIAZ=$L(CIAFIL,"/"),CIAZ1=$P(CIAFIL,"/",1,CIAZ-1),CIAFIL=$P(CIAFIL,"/",CIAZ)
"RTN","RGUTIN0",12,0)
 S:$L(CIAZ1) CIAROOT=CIAROOT_$E(CIAD,$S($L(CIAROOT):2,1:1))_$TR(CIAZ1,"/.-",$E(CIAD,2))
"RTN","RGUTIN0",13,0)
 Q CIAROOT_$S($L(CIAROOT):$E(CIAD,3),1:"")_CIAFIL
"RTN","RGUTIN0",14,0)
 ; Set right margin
"RTN","RGUTIN0",15,0)
RM(X) ;EP
"RTN","RGUTIN0",16,0)
 X ^%ZOSF("RM")
"RTN","RGUTIN0",17,0)
 Q
"RTN","RGUTIN0",18,0)
 ; Test for tag/routine
"RTN","RGUTIN0",19,0)
TEST(X) ;EP
"RTN","RGUTIN0",20,0)
 N Z
"RTN","RGUTIN0",21,0)
 S:X[U Z=$P(X,U),X=$P(X,U,2)
"RTN","RGUTIN0",22,0)
 Q:'$L(X)!(X'?.1"%"1.AN) 0
"RTN","RGUTIN0",23,0)
 X ^%ZOSF("TEST")
"RTN","RGUTIN0",24,0)
 Q $S('$T:0,$G(Z)="":1,Z'?.1"%"1.AN:0,1:$T(@Z^@X)'="")
"RTN","RGUTIN0",25,0)
ETRAP() Q $$NEWERR^%ZTER
"RTN","RGUTIN0",26,0)
 ; Open a host file
"RTN","RGUTIN0",27,0)
OPENX(X1,X2) ;EP
"RTN","RGUTIN0",28,0)
 D OPEN(.X1,.X2)
"RTN","RGUTIN0",29,0)
 Q X1
"RTN","RGUTIN16")
0^47^B4324901
"RTN","RGUTIN16",1,0)
RGUTIN16 ;RG/IND/DKM - Inits for VMS;04-May-2006 08:19;DKM
"RTN","RGUTIN16",2,0)
 ;;3.0;RG UTILITIES;;Mar 20, 2007;Build 98
"RTN","RGUTIN16",3,0)
 ;;
"RTN","RGUTIN16",4,0)
 ;=================================================================
"RTN","RGUTIN16",5,0)
 ; Open a host file
"RTN","RGUTIN16",6,0)
OPEN(X1,X2) ;EP
"RTN","RGUTIN16",7,0)
 N Z
"RTN","RGUTIN16",8,0)
 S Z="X1"_$S("Rr"[$G(X2):":READONLY:0","Ww"[X2:":(NEWVERSION,RECORDSIZE=65535)","Bb"[X2:":(READONLY,BLOCKSIZE=0)",1:"")
"RTN","RGUTIN16",9,0)
 O @Z
"RTN","RGUTIN16",10,0)
 U X1
"RTN","RGUTIN16",11,0)
 S ^TMP("RGUTHFS",$J,X1)=""
"RTN","RGUTIN16",12,0)
 Q
"RTN","RGUTIN16",13,0)
 ; Close a host file
"RTN","RGUTIN16",14,0)
CLOSE(X) ;EP
"RTN","RGUTIN16",15,0)
 C X
"RTN","RGUTIN16",16,0)
 K ^TMP("RGUTHFS",$J,X)
"RTN","RGUTIN16",17,0)
 Q
"RTN","RGUTIN16",18,0)
 ; Close all open host files
"RTN","RGUTIN16",19,0)
CLOSEALL ;EP
"RTN","RGUTIN16",20,0)
 N Z
"RTN","RGUTIN16",21,0)
 S Z=""
"RTN","RGUTIN16",22,0)
 F  S Z=$O(^TMP("RGUTHFS",$J,Z)) Q:Z=""  C Z
"RTN","RGUTIN16",23,0)
 K ^TMP("RGUTHFS",$J)
"RTN","RGUTIN16",24,0)
 Q
"RTN","RGUTIN16",25,0)
EOF U $I:TRAP
"RTN","RGUTIN16",26,0)
 Q
"RTN","RGUTIN16",27,0)
EOFERR() Q $ZE["ENDOFILE"
"RTN","RGUTIN16",28,0)
 ; Read a line of data
"RTN","RGUTIN16",29,0)
READ(X,Y) ;EP
"RTN","RGUTIN16",30,0)
 U $G(Y,$I):NOTRAP
"RTN","RGUTIN16",31,0)
 R X:5
"RTN","RGUTIN16",32,0)
 Q $S($T:$ZA=-1,1:1)
"RTN","RGUTIN16",33,0)
 ; Delete a host file
"RTN","RGUTIN16",34,0)
DELETE(X) ;EP
"RTN","RGUTIN16",35,0)
 O X::0
"RTN","RGUTIN16",36,0)
 C X:DELETE
"RTN","RGUTIN16",37,0)
 Q
"RTN","RGUTIN16",38,0)
 ; Rename a host file
"RTN","RGUTIN16",39,0)
RENAME(X1,X2) ;EP
"RTN","RGUTIN16",40,0)
 O X1:READONLY:0
"RTN","RGUTIN16",41,0)
 C X1:RENAME=X2
"RTN","RGUTIN16",42,0)
 Q
"RTN","RGUTIN16",43,0)
 ; Return directory of files
"RTN","RGUTIN16",44,0)
DIR(X1,X2,X3) ;EP
"RTN","RGUTIN16",45,0)
 N Z,Z1
"RTN","RGUTIN16",46,0)
 S $ZT="DIRX^RGUTOS",X3=$G(X3,"^UTILITY(""DIR"",$J)")
"RTN","RGUTIN16",47,0)
 K @X3
"RTN","RGUTIN16",48,0)
 S:'$G(X2) X2=9999999999
"RTN","RGUTIN16",49,0)
 F Z=1:1:X2 S Z1=$ZSEARCH(X1),X1="" Q:Z1=""  S @X3@($P(Z1,"]",2))=""
"RTN","RGUTIN16",50,0)
DIRX Q
"RTN","RGUTIN16",51,0)
 ; Return default working directory
"RTN","RGUTIN16",52,0)
DEFDIR(X) ;EP
"RTN","RGUTIN16",53,0)
 Q $G(X,$P($G(^XTV(8989.3,1,"DEV")),U))
"RTN","RGUTIN16",54,0)
 ; Return path delimiters
"RTN","RGUTIN16",55,0)
DIRDLM() ;EP
"RTN","RGUTIN16",56,0)
 Q "[.]"
"RTN","RGUTIN16",57,0)
 ; Parse current error
"RTN","RGUTIN16",58,0)
ERR(X1,X2,X3) ;EP
"RTN","RGUTIN16",59,0)
 S X1=$P($P($ZE,", ",2),"-",3),X2=$P($P($ZE,", "),":"),X3=$P($ZE,", ",$S(X1="ZTRAP":4,1:3))
"RTN","RGUTIN16",60,0)
 Q
"RTN","RGUTIN16",61,0)
 ; Raise an exception
"RTN","RGUTIN16",62,0)
RAISE(X) ;EP
"RTN","RGUTIN16",63,0)
 ZT $G(X)
"RTN","RGUTIN16",64,0)
 ; Set error trap
"RTN","RGUTIN16",65,0)
TRAP(X) ;EP
"RTN","RGUTIN16",66,0)
 Q $S($D(X):"$ZT="""_X_"""",1:"$ZT")
"RTN","RGUTIN16",67,0)
 ; Return size of a file
"RTN","RGUTIN16",68,0)
SIZE(X) ;EP
"RTN","RGUTIN16",69,0)
 Q $ZC(%GETFILE,X,"BLS")*$ZC(%GETFILE,X,"EOF")
"RTN","RGUTIN16",70,0)
 ; Return free disk space
"RTN","RGUTIN16",71,0)
FREE(X) ;EP
"RTN","RGUTIN16",72,0)
 Q $ZC(%GETDVI,X,"FREEBLOCKS")/2048
"RTN","RGUTIN16",73,0)
 ; Return host ip address
"RTN","RGUTIN16",74,0)
HOSTIP() ;EP
"RTN","RGUTIN16",75,0)
 Q ""
"RTN","RGUTIN16",76,0)
 ; Return host name
"RTN","RGUTIN16",77,0)
HOSTNAME() ;EP
"RTN","RGUTIN16",78,0)
 Q ""
"RTN","RGUTIN16",79,0)
 ; Return client ip address
"RTN","RGUTIN16",80,0)
CLIENTIP() ;EP
"RTN","RGUTIN16",81,0)
 N IP,$ET
"RTN","RGUTIN16",82,0)
 S $ET="S $EC=""""",IP=$&%UCXGETPEER
"RTN","RGUTIN16",83,0)
 Q $A(IP,1)_"."_$A(IP,2)_"."_$A(IP,3)_"."_$A(IP,4)
"RTN","RGUTIN18")
0^48^B4545277
"RTN","RGUTIN18",1,0)
RGUTIN18 ;RG/IND/DKM - Inits for Cache (Windows);04-May-2006 08:19;DKM
"RTN","RGUTIN18",2,0)
 ;;3.0;RG UTILITIES;;Mar 20, 2007;Build 98
"RTN","RGUTIN18",3,0)
 ;;
"RTN","RGUTIN18",4,0)
 ;=================================================================
"RTN","RGUTIN18",5,0)
 ; Open a host file
"RTN","RGUTIN18",6,0)
OPEN(X1,X2) ;EP
"RTN","RGUTIN18",7,0)
 O X1:$S("Rr"[$G(X2):"RS","Ww"[X2:"WNS","Bb"[X2:"RF",1:""):0
"RTN","RGUTIN18",8,0)
 E  ZT "NOPEN"
"RTN","RGUTIN18",9,0)
 U X1
"RTN","RGUTIN18",10,0)
 S ^TMP("RGUTHFS",$J,X1)=""
"RTN","RGUTIN18",11,0)
 Q
"RTN","RGUTIN18",12,0)
 ; Close a host file
"RTN","RGUTIN18",13,0)
CLOSE(X) ;EP
"RTN","RGUTIN18",14,0)
 C X
"RTN","RGUTIN18",15,0)
 K ^TMP("RGUTHFS",$J,X)
"RTN","RGUTIN18",16,0)
 Q
"RTN","RGUTIN18",17,0)
 ; Close all host files
"RTN","RGUTIN18",18,0)
CLOSEALL ;EP
"RTN","RGUTIN18",19,0)
 N Z
"RTN","RGUTIN18",20,0)
 S Z=""
"RTN","RGUTIN18",21,0)
 F  S Z=$O(^TMP("RGUTHFS",$J,Z)) Q:Z=""  C Z
"RTN","RGUTIN18",22,0)
 K ^TMP("RGUTHFS",$J)
"RTN","RGUTIN18",23,0)
 Q
"RTN","RGUTIN18",24,0)
EOF ZT:$ZA=-1 "ENDOFFILE"
"RTN","RGUTIN18",25,0)
 Q
"RTN","RGUTIN18",26,0)
EOFERR() Q:$ZE["ENDOFFILE"
"RTN","RGUTIN18",27,0)
 ; Read line of data
"RTN","RGUTIN18",28,0)
READ(X,Y) ;EP
"RTN","RGUTIN18",29,0)
 N $ET
"RTN","RGUTIN18",30,0)
 S $ET="",$ZT="READX^RGUTOS"
"RTN","RGUTIN18",31,0)
 U $G(Y,$I)
"RTN","RGUTIN18",32,0)
 Q:$ZEOF 1
"RTN","RGUTIN18",33,0)
 R X:5
"RTN","RGUTIN18",34,0)
 Q:$T 0
"RTN","RGUTIN18",35,0)
READX Q 1
"RTN","RGUTIN18",36,0)
 ; Delete a host file
"RTN","RGUTIN18",37,0)
DELETE(X) ;EP
"RTN","RGUTIN18",38,0)
 S X=$ZF(-1,"del """_X_"""")
"RTN","RGUTIN18",39,0)
 Q
"RTN","RGUTIN18",40,0)
 ; Rename a host file
"RTN","RGUTIN18",41,0)
RENAME(X1,X2) ;EP
"RTN","RGUTIN18",42,0)
 S X1=$ZF(-1,"ren """_X1_""" """_X2_"""")
"RTN","RGUTIN18",43,0)
 Q
"RTN","RGUTIN18",44,0)
 ; Return directory of files
"RTN","RGUTIN18",45,0)
DIR(X1,X2,X3) ;EP
"RTN","RGUTIN18",46,0)
 N Z,Z1,FDLM
"RTN","RGUTIN18",47,0)
 S FDLM=$E($$DIRDLM,1)
"RTN","RGUTIN18",48,0)
 S X3=$G(X3,$NA(^UTILITY("DIR",$J)))
"RTN","RGUTIN18",49,0)
 K @X3
"RTN","RGUTIN18",50,0)
 S:'$G(X2) X2=9999999999
"RTN","RGUTIN18",51,0)
 F Z=1:1:X2 S Z1=$ZSEARCH(X1),X1="" Q:Z1=""  D
"RTN","RGUTIN18",52,0)
 .S Z1=$P(Z1,FDLM,$L(Z1,FDLM))
"RTN","RGUTIN18",53,0)
 .S:$TR(Z1,".")'="" @X3@(Z1)=""
"RTN","RGUTIN18",54,0)
 Q
"RTN","RGUTIN18",55,0)
 ; Return path delimiters
"RTN","RGUTIN18",56,0)
DIRDLM() ;EP
"RTN","RGUTIN18",57,0)
 Q "\\\"
"RTN","RGUTIN18",58,0)
 ; Return default working directory
"RTN","RGUTIN18",59,0)
DEFDIR(X) ;EP
"RTN","RGUTIN18",60,0)
 N FDLM
"RTN","RGUTIN18",61,0)
 S FDLM=$E($$DIRDLM,1)
"RTN","RGUTIN18",62,0)
 S X=$G(X,$P($G(^XTV(8989.3,1,"DEV")),U))
"RTN","RGUTIN18",63,0)
 S:$E(X,$L(X))'=FDLM X=X_FDLM
"RTN","RGUTIN18",64,0)
 Q X
"RTN","RGUTIN18",65,0)
 ; Parse current error
"RTN","RGUTIN18",66,0)
ERR(X1,X2,X3) ;EP
"RTN","RGUTIN18",67,0)
 S X1=$E($P($ZE,">"),2,99),X2=$P($P($ZE,">",2),":"),X3=X1
"RTN","RGUTIN18",68,0)
 S:X2["*" X2=""
"RTN","RGUTIN18",69,0)
 S:$E(X1)="Z" X3=$E(X1,2,99),X1="ZTRAP"
"RTN","RGUTIN18",70,0)
 Q
"RTN","RGUTIN18",71,0)
 ; Raise an exception
"RTN","RGUTIN18",72,0)
RAISE(X) ;EP
"RTN","RGUTIN18",73,0)
 ZT $G(X)
"RTN","RGUTIN18",74,0)
 ; Set error trap
"RTN","RGUTIN18",75,0)
TRAP(X) ;EP
"RTN","RGUTIN18",76,0)
 Q $S($D(X):"$ZT="""_X_"""",1:"$ZT")
"RTN","RGUTIN18",77,0)
 ; Return size of file
"RTN","RGUTIN18",78,0)
SIZE(X) ;EP
"RTN","RGUTIN18",79,0)
 Q 0
"RTN","RGUTIN18",80,0)
 ; Return free disk space
"RTN","RGUTIN18",81,0)
FREE(X) ;EP
"RTN","RGUTIN18",82,0)
 Q 0
"RTN","RGUTIN18",83,0)
 ; Return host ip address
"RTN","RGUTIN18",84,0)
HOSTIP() ;EP
"RTN","RGUTIN18",85,0)
 Q $P($P($ZU(131,1),","),":",2)
"RTN","RGUTIN18",86,0)
 ; Return host name
"RTN","RGUTIN18",87,0)
HOSTNAME() ;EP
"RTN","RGUTIN18",88,0)
 Q $P($P($ZU(131,1),","),":")
"RTN","RGUTIN18",89,0)
 ; Return client ip address
"RTN","RGUTIN18",90,0)
CLIENTIP() ;EP
"RTN","RGUTIN18",91,0)
 N IP,$ET
"RTN","RGUTIN18",92,0)
 S $ET="S $EC=""""",IP=$ZU(111,0)
"RTN","RGUTIN18",93,0)
 Q $A(IP,1)_"."_$A(IP,2)_"."_$A(IP,3)_"."_$A(IP,4)
"RTN","RGUTIN58")
0^70^B5603465
"RTN","RGUTIN58",1,0)
RGUTIN58 ;RG/IND/DKM/PLS - Inits for MSM-UNIX;04-May-2006 08:19;DKM
"RTN","RGUTIN58",2,0)
 ;;3.0;RG UTILITIES;;Mar 20, 2007;Build 98
"RTN","RGUTIN58",3,0)
 ;;
"RTN","RGUTIN58",4,0)
 ;=================================================================
"RTN","RGUTIN58",5,0)
 ; Open a host file
"RTN","RGUTIN58",6,0)
OPEN(X1,X2) ;EP
"RTN","RGUTIN58",7,0)
 N Z
"RTN","RGUTIN58",8,0)
 S X2=$G(X2,"R")
"RTN","RGUTIN58",9,0)
 F Z=51:1:55 I '$D(^TMP("RGUTHFS",$J,Z)) D  Q
"RTN","RGUTIN58",10,0)
 .ZT:Z=55 "TMOF"
"RTN","RGUTIN58",11,0)
 .O Z:(X1:$S("RrWw"[X2:X2,1:"R")::::$S("Bb"[X2:"",1:$C(10)))
"RTN","RGUTIN58",12,0)
 .U Z
"RTN","RGUTIN58",13,0)
 .ZT:$ZA "OPEN"
"RTN","RGUTIN58",14,0)
 .S ^TMP("RGUTHFS",$J,Z)=X1,X1=Z
"RTN","RGUTIN58",15,0)
 Q
"RTN","RGUTIN58",16,0)
 ; Close a host file
"RTN","RGUTIN58",17,0)
CLOSE(X) ;EP
"RTN","RGUTIN58",18,0)
 N Z
"RTN","RGUTIN58",19,0)
 S Z=X,X=$G(^TMP("RGUTHFS",$J,X))
"RTN","RGUTIN58",20,0)
 K ^(Z)
"RTN","RGUTIN58",21,0)
 C Z
"RTN","RGUTIN58",22,0)
 Q
"RTN","RGUTIN58",23,0)
 ; Close all open host files
"RTN","RGUTIN58",24,0)
CLOSEALL ;EP
"RTN","RGUTIN58",25,0)
 N Z
"RTN","RGUTIN58",26,0)
 F Z=0:0 S Z=$O(^TMP("RGUTHFS",$J,Z)) Q:'Z  C Z
"RTN","RGUTIN58",27,0)
 K ^TMP("RGUTHFS",$J)
"RTN","RGUTIN58",28,0)
 Q
"RTN","RGUTIN58",29,0)
EOF ZT:$ZC "EOF"
"RTN","RGUTIN58",30,0)
 Q
"RTN","RGUTIN58",31,0)
EOFERR() Q $ZE["ZEOF"
"RTN","RGUTIN58",32,0)
 ; Read a line of data
"RTN","RGUTIN58",33,0)
READ(X,Y) ;EP
"RTN","RGUTIN58",34,0)
 U:$G(Y)'="" Y
"RTN","RGUTIN58",35,0)
 R X:5
"RTN","RGUTIN58",36,0)
 Q $S($T:$ZC&'$L(X),1:1)
"RTN","RGUTIN58",37,0)
 ; Delete a host file
"RTN","RGUTIN58",38,0)
DELETE(X) ;EP
"RTN","RGUTIN58",39,0)
 D JW("rm "_X)
"RTN","RGUTIN58",40,0)
 Q
"RTN","RGUTIN58",41,0)
 ; Rename a host file
"RTN","RGUTIN58",42,0)
RENAME(X1,X2) ;EP
"RTN","RGUTIN58",43,0)
 D JW("mv "_X1_" "_X2)
"RTN","RGUTIN58",44,0)
 Q
"RTN","RGUTIN58",45,0)
 ; Generate a directory listing
"RTN","RGUTIN58",46,0)
DIR(X1,X2,X3) ;EP
"RTN","RGUTIN58",47,0)
 N TFN,X,Z
"RTN","RGUTIN58",48,0)
 N $ET
"RTN","RGUTIN58",49,0)
 S $ET="",@$$TRAP("DIRERR^RGUTOS")
"RTN","RGUTIN58",50,0)
 S X1=$G(X1),X2=+$G(X2),X3=$G(X3,"^UTILITY(""DIR"",$J)")
"RTN","RGUTIN58",51,0)
 S TFN=$$DEFDIR_"RGUTAUTO."_$J
"RTN","RGUTIN58",52,0)
 K @X3
"RTN","RGUTIN58",53,0)
 ;
"RTN","RGUTIN58",54,0)
 D DELETE(TFN)
"RTN","RGUTIN58",55,0)
 D JW("ls -d "_X1_" >> "_TFN)
"RTN","RGUTIN58",56,0)
 D OPEN(.TFN,"R")
"RTN","RGUTIN58",57,0)
 F Z=1:1 Q:(X2&(Z>X2))  Q:$$READ(.X,TFN)  D
"RTN","RGUTIN58",58,0)
 .S X=$TR($P(X,"/",$L(X,"/")),$C(10),"")
"RTN","RGUTIN58",59,0)
 .I X]"" S @X3@(X)=""
"RTN","RGUTIN58",60,0)
DIRERR D CLOSE(.TFN)
"RTN","RGUTIN58",61,0)
 D DELETE(TFN)
"RTN","RGUTIN58",62,0)
 Q
"RTN","RGUTIN58",63,0)
 ; Return default working directory
"RTN","RGUTIN58",64,0)
DEFDIR(X) ;EP
"RTN","RGUTIN58",65,0)
 S X=$G(X,$P($G(^XTV(8989.3,1,"DEV")),U))
"RTN","RGUTIN58",66,0)
 S:$E(X,$L(X))'="/" X=X_"/"
"RTN","RGUTIN58",67,0)
 Q X
"RTN","RGUTIN58",68,0)
 ; Return path delimiters
"RTN","RGUTIN58",69,0)
DIRDLM() ;EP
"RTN","RGUTIN58",70,0)
 Q "///"
"RTN","RGUTIN58",71,0)
 ; Return free disk space
"RTN","RGUTIN58",72,0)
FREE(X) ;EP
"RTN","RGUTIN58",73,0)
 S X=$ZOS(9,$E(X))
"RTN","RGUTIN58",74,0)
 Q X*$P(X,"^",2)*$P(X,"^",3)/1048576
"RTN","RGUTIN58",75,0)
 ; Parse current error
"RTN","RGUTIN58",76,0)
ERR(X1,X2,X3) ;EP
"RTN","RGUTIN58",77,0)
 S X1=$E($P($ZE,">"),2,99),X2=$P($P($ZE,">",2),":"),X3=X1
"RTN","RGUTIN58",78,0)
 S:X2["*" X2=""
"RTN","RGUTIN58",79,0)
 S:$E(X1)="Z" X3=$E(X1,2,99),X1="ZTRAP"
"RTN","RGUTIN58",80,0)
 Q
"RTN","RGUTIN58",81,0)
 ; Raise an exception
"RTN","RGUTIN58",82,0)
RAISE(X) ;EP
"RTN","RGUTIN58",83,0)
 ZT $G(X)
"RTN","RGUTIN58",84,0)
 ; Set error trap
"RTN","RGUTIN58",85,0)
TRAP(X) ;EP
"RTN","RGUTIN58",86,0)
 Q $S($D(X):"$ZT="""_X_"""",1:"$ZT")
"RTN","RGUTIN58",87,0)
 ; Return size of a file
"RTN","RGUTIN58",88,0)
SIZE(X) ;EP
"RTN","RGUTIN58",89,0)
 N I,Y,Z
"RTN","RGUTIN58",90,0)
 S Z=$ZOS(12,X,0),Z=$P(Z,"^",2,999),Y=0
"RTN","RGUTIN58",91,0)
 I Z'="" F I=30:-1:27 S Y=Y*256+$A(Z,I)
"RTN","RGUTIN58",92,0)
 Q Y
"RTN","RGUTIN58",93,0)
 ; Return host ip address
"RTN","RGUTIN58",94,0)
HOSTIP() ;EP
"RTN","RGUTIN58",95,0)
 Q ""
"RTN","RGUTIN58",96,0)
 ; Return host name
"RTN","RGUTIN58",97,0)
HOSTNAME() ;EP
"RTN","RGUTIN58",98,0)
 Q ""
"RTN","RGUTIN58",99,0)
 ; Return client ip address
"RTN","RGUTIN58",100,0)
CLIENTIP() ;EP
"RTN","RGUTIN58",101,0)
 Q ""
"RTN","RGUTIN58",102,0)
 ; Issue host command and wait
"RTN","RGUTIN58",103,0)
JW(ZOSHC) ;msm extrinsic
"RTN","RGUTIN58",104,0)
 N ZOSHX
"RTN","RGUTIN58",105,0)
 S ZOSHX=$$JOBWAIT^%HOSTCMD(ZOSHC)
"RTN","RGUTIN58",106,0)
 Q
"RTN","RGUTIN68")
0^69^B4493128
"RTN","RGUTIN68",1,0)
RGUTIN68 ;RG/IND/DKM - Inits for Cache (Unix);04-May-2006 08:19;DKM
"RTN","RGUTIN68",2,0)
 ;;3.0;RG UTILITIES;;Mar 20, 2007;Build 98
"RTN","RGUTIN68",3,0)
 ;;
"RTN","RGUTIN68",4,0)
 ;=================================================================
"RTN","RGUTIN68",5,0)
 ; Open a host file
"RTN","RGUTIN68",6,0)
OPEN(X1,X2) ;EP
"RTN","RGUTIN68",7,0)
 O X1:$S("Rr"[$G(X2):"RS","Ww"[X2:"WNS","Bb"[X2:"RF",1:""):0
"RTN","RGUTIN68",8,0)
 E  ZT "NOPEN"
"RTN","RGUTIN68",9,0)
 U X1
"RTN","RGUTIN68",10,0)
 S ^TMP("RGUTHFS",$J,X1)=""
"RTN","RGUTIN68",11,0)
 Q
"RTN","RGUTIN68",12,0)
 ; Close a host file
"RTN","RGUTIN68",13,0)
CLOSE(X) ;EP
"RTN","RGUTIN68",14,0)
 C X
"RTN","RGUTIN68",15,0)
 K ^TMP("RGUTHFS",$J,X)
"RTN","RGUTIN68",16,0)
 Q
"RTN","RGUTIN68",17,0)
 ; Close all open host files
"RTN","RGUTIN68",18,0)
CLOSEALL ;EP
"RTN","RGUTIN68",19,0)
 N Z
"RTN","RGUTIN68",20,0)
 S Z=""
"RTN","RGUTIN68",21,0)
 F  S Z=$O(^TMP("RGUTHFS",$J,Z)) Q:Z=""  C Z
"RTN","RGUTIN68",22,0)
 K ^TMP("RGUTHFS",$J)
"RTN","RGUTIN68",23,0)
 Q
"RTN","RGUTIN68",24,0)
EOF ZT:$ZA=-1 "ENDOFFILE"
"RTN","RGUTIN68",25,0)
 Q
"RTN","RGUTIN68",26,0)
EOFERR() Q:$ZE["ENDOFFILE"
"RTN","RGUTIN68",27,0)
 ; Read a line of data
"RTN","RGUTIN68",28,0)
READ(X,Y) ;EP
"RTN","RGUTIN68",29,0)
 N $ET
"RTN","RGUTIN68",30,0)
 S $ET="",$ZT="READX"
"RTN","RGUTIN68",31,0)
 U $G(Y,$I)
"RTN","RGUTIN68",32,0)
 Q:$ZEOF 1
"RTN","RGUTIN68",33,0)
 R X:5
"RTN","RGUTIN68",34,0)
 Q:$T 0
"RTN","RGUTIN68",35,0)
READX Q 1
"RTN","RGUTIN68",36,0)
 ; Delete a host file
"RTN","RGUTIN68",37,0)
DELETE(X) ;EP
"RTN","RGUTIN68",38,0)
 S X=$ZF(-1,"rm """_X_"""")
"RTN","RGUTIN68",39,0)
 Q
"RTN","RGUTIN68",40,0)
 ; Rename a host file
"RTN","RGUTIN68",41,0)
RENAME(X1,X2) ;EP
"RTN","RGUTIN68",42,0)
 S X1=$ZF(-1,"mv """_X1_""" """_X2_"""")
"RTN","RGUTIN68",43,0)
 Q
"RTN","RGUTIN68",44,0)
 ; Generate directory listing
"RTN","RGUTIN68",45,0)
DIR(X1,X2,X3) ;EP
"RTN","RGUTIN68",46,0)
 N Z,Z1,FDLM
"RTN","RGUTIN68",47,0)
 S FDLM=$E($$DIRDLM,1)
"RTN","RGUTIN68",48,0)
 S X3=$G(X3,$NA(^UTILITY("DIR",$J)))
"RTN","RGUTIN68",49,0)
 K @X3
"RTN","RGUTIN68",50,0)
 S:'$G(X2) X2=9999999999
"RTN","RGUTIN68",51,0)
 F Z=1:1:X2 S Z1=$ZSEARCH(X1),X1="" Q:Z1=""  D
"RTN","RGUTIN68",52,0)
 .S Z1=$P(Z1,FDLM,$L(Z1,FDLM))
"RTN","RGUTIN68",53,0)
 .S:$TR(Z1,".")'="" @X3@(Z1)=""
"RTN","RGUTIN68",54,0)
 Q
"RTN","RGUTIN68",55,0)
 ; Return path delimiters
"RTN","RGUTIN68",56,0)
DIRDLM() ;EP
"RTN","RGUTIN68",57,0)
 Q "///"
"RTN","RGUTIN68",58,0)
 ; Return default working directory
"RTN","RGUTIN68",59,0)
DEFDIR(X) ;EP
"RTN","RGUTIN68",60,0)
 N FDLM
"RTN","RGUTIN68",61,0)
 S FDLM=$E($$DIRDLM,1)
"RTN","RGUTIN68",62,0)
 S X=$G(X,$P($G(^XTV(8989.3,1,"DEV")),U))
"RTN","RGUTIN68",63,0)
 S:$E(X,$L(X))'=FDLM X=X_FDLM
"RTN","RGUTIN68",64,0)
 Q X
"RTN","RGUTIN68",65,0)
 ; Parse current error
"RTN","RGUTIN68",66,0)
ERR(X1,X2,X3) ;EP
"RTN","RGUTIN68",67,0)
 S X1=$E($P($ZE,">"),2,99),X2=$P($P($ZE,">",2),":"),X3=X1
"RTN","RGUTIN68",68,0)
 S:X2["*" X2=""
"RTN","RGUTIN68",69,0)
 S:$E(X1)="Z" X3=$E(X1,2,99),X1="ZTRAP"
"RTN","RGUTIN68",70,0)
 Q
"RTN","RGUTIN68",71,0)
 ; Raise an exception
"RTN","RGUTIN68",72,0)
RAISE(X) ;EP
"RTN","RGUTIN68",73,0)
 ZT $G(X)
"RTN","RGUTIN68",74,0)
 ; Set error trap
"RTN","RGUTIN68",75,0)
TRAP(X) ;EP
"RTN","RGUTIN68",76,0)
 Q $S($D(X):"$ZT="""_X_"""",1:"$ZT")
"RTN","RGUTIN68",77,0)
 ; Return size of a file
"RTN","RGUTIN68",78,0)
SIZE(X) ;EP
"RTN","RGUTIN68",79,0)
 Q 0
"RTN","RGUTIN68",80,0)
 ; Return free disk space
"RTN","RGUTIN68",81,0)
FREE(X) ;EP
"RTN","RGUTIN68",82,0)
 Q 0
"RTN","RGUTIN68",83,0)
 ; Return host ip address
"RTN","RGUTIN68",84,0)
HOSTIP() ;EP
"RTN","RGUTIN68",85,0)
 Q $P($P($ZU(131,1),","),":",2)
"RTN","RGUTIN68",86,0)
 ; Return host name
"RTN","RGUTIN68",87,0)
HOSTNAME() ;EP
"RTN","RGUTIN68",88,0)
 Q $P($P($ZU(131,1),","),":")
"RTN","RGUTIN68",89,0)
 ; Return client ip address
"RTN","RGUTIN68",90,0)
CLIENTIP() ;EP
"RTN","RGUTIN68",91,0)
 N IP,$ET
"RTN","RGUTIN68",92,0)
 S $ET="S $EC=""""",IP=$ZU(111,0)
"RTN","RGUTIN68",93,0)
 Q $A(IP,1)_"."_$A(IP,2)_"."_$A(IP,3)_"."_$A(IP,4)
"RTN","RGUTIN8")
0^49^B4187174
"RTN","RGUTIN8",1,0)
RGUTIN8 ;RG/IND/DKM - Inits for MSM;04-May-2006 08:19;DKM
"RTN","RGUTIN8",2,0)
 ;;3.0;RG UTILITIES;;Mar 20, 2007;Build 98
"RTN","RGUTIN8",3,0)
 ;;
"RTN","RGUTIN8",4,0)
 ;=================================================================
"RTN","RGUTIN8",5,0)
 ; Open a host file
"RTN","RGUTIN8",6,0)
OPEN(X1,X2) ;EP
"RTN","RGUTIN8",7,0)
 N Z
"RTN","RGUTIN8",8,0)
 S X2=$G(X2,"R")
"RTN","RGUTIN8",9,0)
 F Z=51:1:55 I '$D(^TMP("RGUTHFS",$J,Z)) D  Q
"RTN","RGUTIN8",10,0)
 .ZT:Z=55 "TMOF"
"RTN","RGUTIN8",11,0)
 .O Z:(X1:$S("RrWw"[X2:X2,1:"R")::::$S("Bb"[X2:"",1:$C(13,10)))
"RTN","RGUTIN8",12,0)
 .U Z
"RTN","RGUTIN8",13,0)
 .ZT:$ZA "OPEN"
"RTN","RGUTIN8",14,0)
 .S ^TMP("RGUTHFS",$J,Z)=X1,X1=Z
"RTN","RGUTIN8",15,0)
 Q
"RTN","RGUTIN8",16,0)
 ; Close a host file
"RTN","RGUTIN8",17,0)
CLOSE(X) ;EP
"RTN","RGUTIN8",18,0)
 N Z
"RTN","RGUTIN8",19,0)
 S Z=X,X=$G(^TMP("RGUTHFS",$J,X))
"RTN","RGUTIN8",20,0)
 K ^(Z)
"RTN","RGUTIN8",21,0)
 C Z
"RTN","RGUTIN8",22,0)
 Q
"RTN","RGUTIN8",23,0)
 ; Close all open host files
"RTN","RGUTIN8",24,0)
CLOSEALL ;EP
"RTN","RGUTIN8",25,0)
 N Z
"RTN","RGUTIN8",26,0)
 F Z=0:0 S Z=$O(^TMP("RGUTHFS",$J,Z)) Q:'Z  C Z
"RTN","RGUTIN8",27,0)
 K ^TMP("RGUTHFS",$J)
"RTN","RGUTIN8",28,0)
 Q
"RTN","RGUTIN8",29,0)
EOF ZT:$ZC "EOF"
"RTN","RGUTIN8",30,0)
 Q
"RTN","RGUTIN8",31,0)
EOFERR() Q $ZE["ZEOF"
"RTN","RGUTIN8",32,0)
 ; Read a line of data
"RTN","RGUTIN8",33,0)
READ(X,Y) ;EP
"RTN","RGUTIN8",34,0)
 U:$G(Y)'="" Y
"RTN","RGUTIN8",35,0)
 R X:5
"RTN","RGUTIN8",36,0)
 Q $S($T:$ZC&'$L(X),1:1)
"RTN","RGUTIN8",37,0)
 ; Delete a host file
"RTN","RGUTIN8",38,0)
DELETE(X) ;EP
"RTN","RGUTIN8",39,0)
 S X=$ZOS(2,X)
"RTN","RGUTIN8",40,0)
 Q
"RTN","RGUTIN8",41,0)
 ; Rename a host file
"RTN","RGUTIN8",42,0)
RENAME(X1,X2) ;EP
"RTN","RGUTIN8",43,0)
 N Z
"RTN","RGUTIN8",44,0)
 S Z=$ZOS(3,X1,X2)
"RTN","RGUTIN8",45,0)
 Q
"RTN","RGUTIN8",46,0)
 ; Generate a directory listing
"RTN","RGUTIN8",47,0)
DIR(X1,X2,X3) ;EP
"RTN","RGUTIN8",48,0)
 N Z
"RTN","RGUTIN8",49,0)
 S X1=$ZOS(12,X1,0),X2=+$G(X2),X3=$G(X3,"^UTILITY(""DIR"",$J)")
"RTN","RGUTIN8",50,0)
 K @X3
"RTN","RGUTIN8",51,0)
 F Z=1:1 Q:(X2&(Z>X2))!($P(X1,"^")="")  S @X3@($P(X1,"^"))="",X1=$ZOS(13,X1)
"RTN","RGUTIN8",52,0)
 Q
"RTN","RGUTIN8",53,0)
 ; Return default working directory
"RTN","RGUTIN8",54,0)
DEFDIR(X) ;EP
"RTN","RGUTIN8",55,0)
 S X=$G(X,$P($G(^XTV(8989.3,1,"DEV")),U))
"RTN","RGUTIN8",56,0)
 S:$E(X,$L(X))'="\" X=X_"\"
"RTN","RGUTIN8",57,0)
 Q X
"RTN","RGUTIN8",58,0)
 ; Return path delimiters
"RTN","RGUTIN8",59,0)
DIRDLM() ;EP
"RTN","RGUTIN8",60,0)
 Q "\\\"
"RTN","RGUTIN8",61,0)
 ; Return free disk space
"RTN","RGUTIN8",62,0)
FREE(X) ;EP
"RTN","RGUTIN8",63,0)
 S X=$ZOS(9,$E(X))
"RTN","RGUTIN8",64,0)
 Q X*$P(X,"^",2)*$P(X,"^",3)/1048576
"RTN","RGUTIN8",65,0)
 ; Parse current error
"RTN","RGUTIN8",66,0)
ERR(X1,X2,X3) ;EP
"RTN","RGUTIN8",67,0)
 S X1=$E($P($ZE,">"),2,99),X2=$P($P($ZE,">",2),":"),X3=X1
"RTN","RGUTIN8",68,0)
 S:X2["*" X2=""
"RTN","RGUTIN8",69,0)
 S:$E(X1)="Z" X3=$E(X1,2,99),X1="ZTRAP"
"RTN","RGUTIN8",70,0)
 Q
"RTN","RGUTIN8",71,0)
 ; Raise an exception
"RTN","RGUTIN8",72,0)
RAISE(X) ;EP
"RTN","RGUTIN8",73,0)
 ZT $G(X)
"RTN","RGUTIN8",74,0)
 ; Set error trap
"RTN","RGUTIN8",75,0)
TRAP(X) ;EP
"RTN","RGUTIN8",76,0)
 Q $S($D(X):"$ZT="""_X_"""",1:"$ZT")
"RTN","RGUTIN8",77,0)
 ; Return size of a file
"RTN","RGUTIN8",78,0)
SIZE(X) ;EP
"RTN","RGUTIN8",79,0)
 N I,Y,Z
"RTN","RGUTIN8",80,0)
 S Z=$ZOS(12,X,0),Z=$P(Z,"^",2,999),Y=0
"RTN","RGUTIN8",81,0)
 I Z'="" F I=30:-1:27 S Y=Y*256+$A(Z,I)
"RTN","RGUTIN8",82,0)
 Q Y
"RTN","RGUTIN8",83,0)
 ; Return host ip address
"RTN","RGUTIN8",84,0)
HOSTIP() ;EP
"RTN","RGUTIN8",85,0)
 Q ""
"RTN","RGUTIN8",86,0)
 ; Return host name
"RTN","RGUTIN8",87,0)
HOSTNAME() ;EP
"RTN","RGUTIN8",88,0)
 Q ""
"RTN","RGUTIN8",89,0)
 ; Return client ip address
"RTN","RGUTIN8",90,0)
CLIENTIP() ;EP
"RTN","RGUTIN8",91,0)
 Q ""
"RTN","RGUTIN8U")
1^68
"RTN","RGUTINIT")
0^60^B6026117
"RTN","RGUTINIT",1,0)
RGUTINIT ;RG/IND/DKM - Platform specific inits;04-May-2006 08:19;DKM
"RTN","RGUTINIT",2,0)
 ;;3.0;RG UTILITIES;;Mar 20, 2007;Build 98
"RTN","RGUTINIT",3,0)
 ;;
"RTN","RGUTINIT",4,0)
 ;=================================================================
"RTN","RGUTINIT",5,0)
POST N CIAOS,CIAH,X
"RTN","RGUTINIT",6,0)
 S U="^",X="ERROR^RGUTINIT",@^%ZOSF("TRAP"),CIAOS=$P(^%ZOSF("OS"),U,2)
"RTN","RGUTINIT",7,0)
 I 'CIAOS D
"RTN","RGUTINIT",8,0)
 .D HOME^%ZIS,TITLE^RGUT("Platform-Specific Inits",1.6)
"RTN","RGUTINIT",9,0)
 .S CIAH(1)="Enter the name of this MUMPS environment for the RG-namespace"
"RTN","RGUTINIT",10,0)
 .S CIAH(2)="platform-specific initialization process."
"RTN","RGUTINIT",11,0)
 .S CIAOS=$$ENTRY^RGUTLKP("^DD(""OS"")","UX","Operating System: ","B","*","","",0,5,"","","HELP(.CIAH)")
"RTN","RGUTINIT",12,0)
 .W !!
"RTN","RGUTINIT",13,0)
 D:CIAOS>0 INIT(CIAOS)
"RTN","RGUTINIT",14,0)
 Q
"RTN","RGUTINIT",15,0)
INIT(CIAOS) ;
"RTN","RGUTINIT",16,0)
 N I,X,Y,Z,N,CIAOSZ
"RTN","RGUTINIT",17,0)
 S CIAOSZ=$$OSRTN($G(CIAOS))
"RTN","RGUTINIT",18,0)
 S:$L(CIAOSZ) @("CIAOSZ="_CIAOSZ)
"RTN","RGUTINIT",19,0)
 I '$L(CIAOSZ) D  Q
"RTN","RGUTINIT",20,0)
 .X "ZL RGUTOS1 ZS RGUTOS"
"RTN","RGUTINIT",21,0)
 .D MES("Init not found for specified OS. Will use generic init.")
"RTN","RGUTINIT",22,0)
 S I=0,N="RGUT"
"RTN","RGUTINIT",23,0)
 K ^TMP(N,$J)
"RTN","RGUTINIT",24,0)
 F Z=0,1 F X=$S(Z:3,1:1):1 S Y=$T(+X^@$S(Z:CIAOSZ,1:"RGUTIN0")) Q:Y=""  S I=I+1,^TMP(N,$J,I)=Y
"RTN","RGUTINIT",25,0)
 S $P(^TMP(N,$J,1),";")="RGUTOS "
"RTN","RGUTINIT",26,0)
 X "ZR  F Z=1:1:I ZI ^TMP(N,$J,Z) ZS:Z=I RGUTOS"
"RTN","RGUTINIT",27,0)
 K ^TMP(N,$J)
"RTN","RGUTINIT",28,0)
 F Z=1:1 S X=$P($T(DEVICE+Z),";;",2,99) Q:X=""  S ^TMP(N,$J,Z)=$$MSG^RGUT(X,"|")
"RTN","RGUTINIT",29,0)
 I $$ENTRY^RGUTIMP($NA(^TMP(N,$J))) D
"RTN","RGUTINIT",30,0)
 .D MES("Unable to install RGUT HFS DEVICE.")
"RTN","RGUTINIT",31,0)
 W !!,"Initialization completed for "_$P(^DD("OS",CIAOS,0),"^")_" operating system.",!!
"RTN","RGUTINIT",32,0)
 K ^TMP(N,$J)
"RTN","RGUTINIT",33,0)
 Q
"RTN","RGUTINIT",34,0)
OSRTN(X) Q $P($T(@("OS"_X)),";",4,99)
"RTN","RGUTINIT",35,0)
OS8 ;;MSM;$S($ZV["UNIX":"RGUTIN58",1:"RGUTIN8")
"RTN","RGUTINIT",36,0)
OS16 ;;DSM;RGUTIN16
"RTN","RGUTINIT",37,0)
OS18 ;;Cache;$S($ZV["UNIX":"RGUTIN68",1:"RGUTIN18")
"RTN","RGUTINIT",38,0)
MES(X) D BMES^XPDUTL(X)
"RTN","RGUTINIT",39,0)
 Q
"RTN","RGUTINIT",40,0)
ERROR D MES("An error has occurred during initialization.")
"RTN","RGUTINIT",41,0)
 Q
"RTN","RGUTINIT",42,0)
 ; Return $I for HFS device
"RTN","RGUTINIT",43,0)
HFS() Q $S(CIAOS=16:"TEMP.TMP",CIAOS=8:51,CIAOS=18:"NUL",1:"@")
"RTN","RGUTINIT",44,0)
DEVICE ; Device setup
"RTN","RGUTINIT",45,0)
 ;;:3.5
"RTN","RGUTINIT",46,0)
 ;;.NAME: RGUT HFS DEVICE
"RTN","RGUTINIT",47,0)
 ;;.LOCATION OF TERMINAL: HFS
"RTN","RGUTINIT",48,0)
 ;;.$I: |$$HFS^RGUTINIT|
"RTN","RGUTINIT",49,0)
 ;;.SIGN-ON/SYSTEM DEVICE: N
"RTN","RGUTINIT",50,0)
 ;;.TYPE: HFS
"RTN","RGUTINIT",51,0)
 ;;.SUBTYPE: P-OTHER
"RTN","RGUTINIT",52,0)
 ;;.ASK DEVICE: N
"RTN","RGUTINIT",53,0)
 ;;.ASK PARAMETERS: N
"RTN","RGUTINIT",54,0)
 ;;.ASK HOST FILE: N
"RTN","RGUTINIT",55,0)
 ;;.ASK HFS I/O OPERATION: N
"RTN","RGUTINIT",56,0)
 ;;
"RTN","RGUTLK2")
0^50^B51777461
"RTN","RGUTLK2",1,0)
RGUTLK2 ;RG/IND/DKM - Continuation of RGUTLKP;20-Jan-2015 13:23;DKM
"RTN","RGUTLK2",2,0)
 ;;3.0;RG UTILITIES;;Mar 20, 2007;Build 98
"RTN","RGUTLK2",3,0)
 ;;
"RTN","RGUTLK2",4,0)
 ;=================================================================
"RTN","RGUTLK2",5,0)
LKP(%CIADX) ;
"RTN","RGUTLK2",6,0)
 N %CIAD,%CIAZ,%CIAN
"RTN","RGUTLK2",7,0)
 S %CIAXRN=0,%CIATRNC=0,%CIAIEN="",%CIASCT=0,%CIAD=%CIADX
"RTN","RGUTLK2",8,0)
 W:'%CIAHTML $$XY(%CIAX+$L(%CIAPRMP),%CIAY),$S(%CIAOPT["X":"",1:%CIAD),%CIAEOS,!,"Searching"_$S(%CIAOPT[U:" (press ^ to abort)",1:"")_"...",*13
"RTN","RGUTLK2",9,0)
 I $E(%CIAD)="`" S %CIASLCT=%CIAD G:'%CIAHTML NR5 D SHOW($E(%CIAD,2,999)) Q 1
"RTN","RGUTLK2",10,0)
NXTREF S %CIAXRN=%CIAXRN+1,%CIAXRF=$P(%CIAXRFS,U,%CIAXRN),%CIAD=%CIADX
"RTN","RGUTLK2",11,0)
 I %CIAXRF="" G:%CIASCT NR3 W:'%CIAHTML *7,*13,%CIAEOL,"Not found"_$S(%CIAD="":".",1:": ")_$S(%CIAD'=+%CIAD:%CIAD,%CIAOPT["D":$$ENTRY^RGUTDT(%CIAD),1:%CIAD) S %CIAD1=$S(%CIAOPT["X":U,1:"") Q ""
"RTN","RGUTLK2",12,0)
 S %CIAOPT(0)=%CIAOPT_%CIAXRFS(%CIAXRF)
"RTN","RGUTLK2",13,0)
 I %CIAOPT(0)["D",$L(%CIADX) D  G:%CIAD<1 NXTREF
"RTN","RGUTLK2",14,0)
 .S %CIAD=$$DT^RGUT(%CIADX)
"RTN","RGUTLK2",15,0)
 I %CIAOPT(0)["W" D MTL G NXTREF
"RTN","RGUTLK2",16,0)
 S %CIAKEY=$S(%CIAOPT(0)["P":$P(%CIAD," "),1:%CIAD)_$S(%CIADIR<0:$C(255),1:""),%CIANUM=$S(%CIAKEY=+%CIAKEY:%CIAKEY,1:"")
"RTN","RGUTLK2",17,0)
 I %CIAD'="",$D(@%CIADIC@(%CIAXRF,%CIAD)) S %=%CIASCT+1 D ADD(%CIAD) I %CIASCT=%,%CIAOPT(0)["A" D SLCT(%CIASCT) Q %CIAIEN
"RTN","RGUTLK2",18,0)
NR2 I %CIAOPT(0)[U R %#1:0 I %=U S %CIATRNC=1 G NR3:%CIASCT Q ""
"RTN","RGUTLK2",19,0)
 S %CIAKEY=$O(@%CIADIC@(%CIAXRF,%CIAKEY),%CIADIR)
"RTN","RGUTLK2",20,0)
 I (%CIANUM="")=(%CIAKEY=+%CIAKEY),%CIAD'="" S %CIAKEY=""
"RTN","RGUTLK2",21,0)
 I %CIAKEY'="",%CIAOPT(0)["P",%CIAKEY'=%CIAD S %=$$PARTIAL(%CIAD,%CIAKEY) D ADD(%CIAKEY):%>0 G:%'<0 NR2:%CIASCT<100
"RTN","RGUTLK2",22,0)
 I %CIAKEY'="",%CIAOPT(0)'["P",$E(%CIAKEY,1,$L(%CIAD))=%CIAD D ADD(%CIAKEY) G:%CIASCT<100 NR2
"RTN","RGUTLK2",23,0)
 I %CIANUM'="" S %CIAKEY=%CIANUM_$C($S(%CIADIR<0:255,1:1)),%CIANUM="" G NR2
"RTN","RGUTLK2",24,0)
 I %CIASCT'<100 W:'%CIAHTML *7 S %CIAXALL=0,%CIATRNC=1
"RTN","RGUTLK2",25,0)
 G:'%CIASCT!%CIAXALL NXTREF
"RTN","RGUTLK2",26,0)
NR3 I %CIASCT=1,%CIAOPT(0)[1,'%CIATRNC D SLCT(1) Q %CIAIEN
"RTN","RGUTLK2",27,0)
 S %CIAKEY=%CIASLT,%CIASLT=1,%CIASMAX=$S(%CIAHTML!%CIARS:99999,1:17-%CIAY)
"RTN","RGUTLK2",28,0)
NR4 W:'%CIAHTML $$XY(0,%CIAY+1),%CIAEOS,!
"RTN","RGUTLK2",29,0)
 F %CIAN=%CIAKEY:1:%CIAKEY+%CIASMAX-1 D  Q:%CIAN=%CIASCT
"RTN","RGUTLK2",30,0)
 .F %CIAZ=0:1:%CIACOL-1 D
"RTN","RGUTLK2",31,0)
 ..S %1=IOM/%CIACOL*%CIAZ\1,%CIALAST=%CIAZ*%CIASMAX+%CIAN
"RTN","RGUTLK2",32,0)
 ..Q:%CIALAST>%CIASCT
"RTN","RGUTLK2",33,0)
 ..W:'%CIAHTML $$XY(%1,$Y),%CIAEOL,%CIALAST,?5
"RTN","RGUTLK2",34,0)
 ..D SHOW(^TMP(%CIAPID,%CIALAST),%1+4)
"RTN","RGUTLK2",35,0)
 .W:'%CIAQT !
"RTN","RGUTLK2",36,0)
 Q:%CIAHTML $S(%CIATRNC:-%CIASCT,1:%CIASCT)
"RTN","RGUTLK2",37,0)
 W:%CIALAST<%CIASCT !,%CIASCT-%CIALAST," more choice(s)..."
"RTN","RGUTLK2",38,0)
 W:%CIATRNC "  (list was truncated)",!
"RTN","RGUTLK2",39,0)
 W %CIAEOS_%CIABEL,!!
"RTN","RGUTLK2",40,0)
 R "Enter selection: ",%CIASLCT:DTIME
"RTN","RGUTLK2",41,0)
 S:'$T %CIASLCT=U
"RTN","RGUTLK2",42,0)
 W *13
"RTN","RGUTLK2",43,0)
 I %CIAOPT["K",%CIASLCT="" Q -1
"RTN","RGUTLK2",44,0)
 I "Nn"[%CIASLCT S %CIAKEY=$S(%CIALAST<%CIASCT:%CIALAST+1,1:1) G NR4
"RTN","RGUTLK2",45,0)
 I "Bb"[%CIASLCT S %CIAKEY=$S(%CIAKEY=1:%CIASCT-%CIASMAX+1,%CIAKEY'>%CIASMAX:1,1:%CIAKEY-%CIASMAX) S:%CIAKEY<1 %CIAKEY=1 G NR4
"RTN","RGUTLK2",46,0)
 I "?"[%CIASLCT D HELP2 G NR4
"RTN","RGUTLK2",47,0)
 I "^^"[%CIASLCT S %CIAD2="",%CIAD1=$S(%CIAOPT(0)["X":%CIASLCT,%CIASLCT="^^":%CIASLCT,1:"") Q ""
"RTN","RGUTLK2",48,0)
NR5 F  D  Q:%CIASLCT=""
"RTN","RGUTLK2",49,0)
 .I %CIAOPT(0)["M" S %CIAD=$P(%CIASLCT,";"),%CIASLCT=$P(%CIASLCT,";",2,999)
"RTN","RGUTLK2",50,0)
 .E  S %CIAD=%CIASLCT,%CIASLCT=""
"RTN","RGUTLK2",51,0)
 .Q:'$L(%CIAD)
"RTN","RGUTLK2",52,0)
 .I %CIAD?1.N D SLCT(%CIAD) Q
"RTN","RGUTLK2",53,0)
 .I %CIAOPT(0)["M",%CIAD?1.N1"-".N D  Q
"RTN","RGUTLK2",54,0)
 ..N %1,%2
"RTN","RGUTLK2",55,0)
 ..S %1=+%CIAD,%2=+$P(%CIAD,"-",2)
"RTN","RGUTLK2",56,0)
 ..S:'%2 %2=%CIASCT
"RTN","RGUTLK2",57,0)
 ..S:%1>%2 %CIAD=%1,%1=%2,%2=%CIAD
"RTN","RGUTLK2",58,0)
 ..S:%2>%CIASCT %2=%CIASCT
"RTN","RGUTLK2",59,0)
 ..F %=%1:1:%2 D SLCT(%)
"RTN","RGUTLK2",60,0)
 .I %CIAOPT["X",%CIAOPT'["L" S (%CIASLCT,%CIAD1,%CIAIEN)="" Q
"RTN","RGUTLK2",61,0)
 .I $E(%CIAD)="`" D  Q
"RTN","RGUTLK2",62,0)
 ..S %CIAD=+$E(%CIAD,2,999)
"RTN","RGUTLK2",63,0)
 ..I $$VALD(%CIAD) D DISV(%CIAD) S %CIAIEN=%CIAD
"RTN","RGUTLK2",64,0)
 .S %CIAD1=%CIAD1_";"_%CIAD
"RTN","RGUTLK2",65,0)
 W $$XY(0,%CIAY+1),%CIAEOS,!
"RTN","RGUTLK2",66,0)
 Q %CIAIEN
"RTN","RGUTLK2",67,0)
 ; Add list selection to output
"RTN","RGUTLK2",68,0)
SLCT(%CIASLCT) ;
"RTN","RGUTLK2",69,0)
 I %CIASLCT>0,%CIASLCT'>%CIASCT D
"RTN","RGUTLK2",70,0)
 .S %CIAIEN=+^TMP(%CIAPID,+%CIASLCT)
"RTN","RGUTLK2",71,0)
 .D DISV(%CIAIEN)
"RTN","RGUTLK2",72,0)
 Q
"RTN","RGUTLK2",73,0)
 ; Add IEN to output
"RTN","RGUTLK2",74,0)
DISV(%CIAIEN) ;
"RTN","RGUTLK2",75,0)
 Q:%CIAIEN=""
"RTN","RGUTLK2",76,0)
 I %CIAMUL'="",'$D(@%CIAMUL@(%CIAIEN)) S @%CIAMUL@(%CIAIEN)="" D:'%CIAQT APP(%CIAIEN)
"RTN","RGUTLK2",77,0)
 D:%CIAMUL="" APP(%CIAIEN)
"RTN","RGUTLK2",78,0)
 Q:%CIAOPT(0)["F"
"RTN","RGUTLK2",79,0)
 K:%CIASAME ^DISV(DUZ,%CIADISV)
"RTN","RGUTLK2",80,0)
 S %CIASAME=0,^DISV(DUZ,%CIADISV)=%CIAIEN,^(%CIADISV,%CIAIEN)=""
"RTN","RGUTLK2",81,0)
 Q
"RTN","RGUTLK2",82,0)
 ; Append primary key to key list
"RTN","RGUTLK2",83,0)
APP(%CIAIEN) ;
"RTN","RGUTLK2",84,0)
 N %CIAKEY
"RTN","RGUTLK2",85,0)
 S %CIAKEY=$S(%CIAIEN=+%CIAIEN:$P($G(@%CIADIC@(%CIAIEN,0)),U),1:%CIAIEN)
"RTN","RGUTLK2",86,0)
 S %CIAKEY=$$FMT(%CIAIEN,%CIAKEY)
"RTN","RGUTLK2",87,0)
 Q:'$L(%CIAKEY)!($L(%CIAKEY)+$L(%CIAD2)'<250)
"RTN","RGUTLK2",88,0)
 S %CIAD2=%CIAD2_$S($L(%CIAD2):";",1:"")_%CIAKEY
"RTN","RGUTLK2",89,0)
 I %CIAOPT(0)'["J",%CIAOPT(0)'["M" S %CIAD2=%CIAD2_"  "_$$SID(%CIAIEN)
"RTN","RGUTLK2",90,0)
 Q
"RTN","RGUTLK2",91,0)
 ; Multi-term lookup
"RTN","RGUTLK2",92,0)
MTL N %
"RTN","RGUTLK2",93,0)
 S %=$S(%CIADIC[")":$TR(%CIADIC,")",","),1:%CIADIC_"(")_"%CIAXRF)"
"RTN","RGUTLK2",94,0)
 S %=$$LKP^RGUTMTL(%,%CIAD,"^TMP(""MTL"",%CIAPID)",%CIAOPT(0)[U)
"RTN","RGUTLK2",95,0)
 S:%<0 %CIATRNC=1
"RTN","RGUTLK2",96,0)
 D:% ADD(%CIAPID,"^TMP","MTL")
"RTN","RGUTLK2",97,0)
 K ^TMP("MTL",%CIAPID)
"RTN","RGUTLK2",98,0)
 Q
"RTN","RGUTLK2",99,0)
 ; Add key to selection list
"RTN","RGUTLK2",100,0)
ADD(%CIAKEY,%CIAIDX,%CIASUB) ;
"RTN","RGUTLK2",101,0)
 N %S
"RTN","RGUTLK2",102,0)
 S:'$D(%CIAIDX) %CIAIDX=%CIADIC,%CIASUB=%CIAXRF
"RTN","RGUTLK2",103,0)
 F %S=0:0 S %S=$O(@%CIAIDX@(%CIASUB,%CIAKEY,%S)) Q:'%S  D
"RTN","RGUTLK2",104,0)
 .I %CIAOPT(0)["O",$D(^TMP(%CIAPID,0,%S)) Q
"RTN","RGUTLK2",105,0)
 .I $$VALD(%S) D
"RTN","RGUTLK2",106,0)
 ..S %CIASCT=%CIASCT+1,^TMP(%CIAPID,%CIASCT)=%S_U_$S(%CIAOPT(0)["W":"",1:%CIAKEY),^(0,%S)=""
"RTN","RGUTLK2",107,0)
 ..I %CIAOPT(0)["S",$G(^DISV(DUZ,%CIADISV))=%S S %CIASLT=%CIASCT
"RTN","RGUTLK2",108,0)
 Q
"RTN","RGUTLK2",109,0)
 ; Check entry against screening criteria
"RTN","RGUTLK2",110,0)
VALD(%S) Q:'$D(@%CIADIC@(%S))!'%S 0
"RTN","RGUTLK2",111,0)
 Q:%CIASCN="" 1
"RTN","RGUTLK2",112,0)
 N %,%1
"RTN","RGUTLK2",113,0)
 S %1=1,@$$TRAP^RGUTOS("V3^RGUTLK2")
"RTN","RGUTLK2",114,0)
 F %=0:0 S %=$O(@%CIASCN@(%)) Q:'%  D  Q:%1
"RTN","RGUTLK2",115,0)
 .S %1=0,@$$TRAP^RGUTOS("V2^RGUTLK2")
"RTN","RGUTLK2",116,0)
 .X "S %1="_@%CIASCN@(%)
"RTN","RGUTLK2",117,0)
V2 .Q
"RTN","RGUTLK2",118,0)
 Q %1
"RTN","RGUTLK2",119,0)
V3 Q 0
"RTN","RGUTLK2",120,0)
 ; Show the specified selection
"RTN","RGUTLK2",121,0)
SHOW(%CIASLCT,%CIACOL1,%CIACOL2) ;
"RTN","RGUTLK2",122,0)
 N %S,%Z,%P,%I
"RTN","RGUTLK2",123,0)
 S %S=+%CIASLCT,%Z=$G(@%CIADIC@(%S,0)),%P=$$FMT(%S,$S(%CIAOPT["I":$P(%CIASLCT,U,2),1:$P(%Z,U)))
"RTN","RGUTLK2",124,0)
 ;S %I=$$SID(%S,$P(%CIASLCT,U,2)),%I=$S(%I="":%P,1:%I)
"RTN","RGUTLK2",125,0)
 S %I=$$SID(%S,%P),%I=$S(%I="":%P,1:%I)
"RTN","RGUTLK2",126,0)
 I %CIAHTML D  Q
"RTN","RGUTLK2",127,0)
 .I '%CIAQT W $$MSG^RGUT(%CIAPRMP,"|"),!
"RTN","RGUTLK2",128,0)
 .E  D DISV(%S)
"RTN","RGUTLK2",129,0)
 S %CIACOL1=+$G(%CIACOL1,$X)
"RTN","RGUTLK2",130,0)
 I %CIAOPT(0)["Y" S %CIACOL2=+$G(%CIACOL2,IOM\%CIACOL+%CIACOL1-8-$L(%I))
"RTN","RGUTLK2",131,0)
 E  S %CIACOL2=+$G(%CIACOL2,IOM\%CIACOL\$S(%CIAOPT(0)["D":3,1:2)-3+%CIACOL1)
"RTN","RGUTLK2",132,0)
 W $$XY(%CIACOL1,$Y)
"RTN","RGUTLK2",133,0)
 I %CIAOPT(0)'["J",%I'=%P W $$TRUNC^RGUT(%P,IOM\%CIACOL-6),?%CIACOL2," "_$$TRUNC^RGUT(%I,IOM-%CIACOL2-2)
"RTN","RGUTLK2",134,0)
 E  W $$TRUNC^RGUT(%I,IOM\%CIACOL-6)
"RTN","RGUTLK2",135,0)
 Q
"RTN","RGUTLK2",136,0)
 ; Return external form of result
"RTN","RGUTLK2",137,0)
FMT(%S,%CIAKEY) ;
"RTN","RGUTLK2",138,0)
 Q:%CIAKEY="" %CIAKEY
"RTN","RGUTLK2",139,0)
 I %CIATRP'="",$D(@%CIATRP@(%CIAKEY)) Q @%CIATRP@(%CIAKEY)
"RTN","RGUTLK2",140,0)
 S:%CIAOPT(0)["D" %CIAKEY=$$ENTRY^RGUTDT(%CIAKEY)
"RTN","RGUTLK2",141,0)
 I %CIAOPT(0)["Z",%CIASCN'="",$G(@%CIASCN)'="" S @("%CIAKEY="_@%CIASCN)
"RTN","RGUTLK2",142,0)
 S:%CIAOPT["J" %CIAKEY=$$SID(%S,%CIAKEY)
"RTN","RGUTLK2",143,0)
 Q %CIAKEY
"RTN","RGUTLK2",144,0)
 ; Return secondary identifier
"RTN","RGUTLK2",145,0)
SID(%S,%CIAKEY) ;
"RTN","RGUTLK2",146,0)
 S %CIAKEY=$G(%CIAKEY)
"RTN","RGUTLK2",147,0)
 N %Z
"RTN","RGUTLK2",148,0)
 S %Z=$G(@%CIADIC@(%S,0)),@("%Z="_$S(%CIASID<0:$S(%CIAKEY=$$UP^XLFSTR($P(%Z,U)):"""""",1:"%CIAKEY"),%CIASID="":"%CIASID",1:%CIASID))
"RTN","RGUTLK2",149,0)
 Q %Z
"RTN","RGUTLK2",150,0)
 ; Partial key lookup
"RTN","RGUTLK2",151,0)
PARTIAL(%CIAD,%CIAKEY) ;
"RTN","RGUTLK2",152,0)
 N %,%1,%2
"RTN","RGUTLK2",153,0)
 S (%(1),%(2))=0,%1(1)=%CIAD,%1(2)=%CIAKEY
"RTN","RGUTLK2",154,0)
 F %=1,2 S %1(%)=$TR(%1(%),".,;:?/!-","        ")
"RTN","RGUTLK2",155,0)
P1 S (%2(1),%2(2))=""
"RTN","RGUTLK2",156,0)
 F %=1,2 D
"RTN","RGUTLK2",157,0)
 .F %(%)=%(%)+1:1:$L(%1(%)," ") S %2(%)=$P(%1(%)," ",%(%)) Q:%2(%)'=""
"RTN","RGUTLK2",158,0)
 Q:%2(1)="" 1
"RTN","RGUTLK2",159,0)
 Q:%2(1)'=$E(%2(2),1,$L(%2(1))) -(%(1)=1)
"RTN","RGUTLK2",160,0)
 G P1
"RTN","RGUTLK2",161,0)
HELP(X) ; Application-specific help
"RTN","RGUTLK2",162,0)
 N %
"RTN","RGUTLK2",163,0)
 S %=""
"RTN","RGUTLK2",164,0)
 F  S %=$O(X(%)) Q:%=""  D:$Y>20 PAUSE W $G(X(%)),!
"RTN","RGUTLK2",165,0)
 Q
"RTN","RGUTLK2",166,0)
 ; Generic help
"RTN","RGUTLK2",167,0)
HELP1 N %
"RTN","RGUTLK2",168,0)
 W !!
"RTN","RGUTLK2",169,0)
 D:%CIAHLP'="" @%CIAHLP
"RTN","RGUTLK2",170,0)
 W !,"Enter a blank line for default action.",!
"RTN","RGUTLK2",171,0)
 D:$Y>20 PAUSE
"RTN","RGUTLK2",172,0)
 W:%CIAOPT'["W" "Enter ?? to see all possible selections.",!
"RTN","RGUTLK2",173,0)
 D:$Y>20 PAUSE
"RTN","RGUTLK2",174,0)
 W "Enter a space to retrieve previous selection.",!
"RTN","RGUTLK2",175,0)
 D:$Y>20 PAUSE
"RTN","RGUTLK2",176,0)
 W "Enter a valid identifier for lookup."
"RTN","RGUTLK2",177,0)
 W:(%CIAOPT'["*")&(%CIAXRFS[U) "  Append a * to include all indices."
"RTN","RGUTLK2",178,0)
 W !
"RTN","RGUTLK2",179,0)
 I %CIAOPT["M" D
"RTN","RGUTLK2",180,0)
 .D:$Y>20 PAUSE
"RTN","RGUTLK2",181,0)
 .W "Separate multiple selections by semicolons."
"RTN","RGUTLK2",182,0)
 R !!,"Press any key to continue...",*%:DTIME
"RTN","RGUTLK2",183,0)
 Q
"RTN","RGUTLK2",184,0)
 ; Help at choice prompt
"RTN","RGUTLK2",185,0)
HELP2 N %
"RTN","RGUTLK2",186,0)
 W $$XY(0,16),%CIAEOS,!
"RTN","RGUTLK2",187,0)
 W $S(%CIAOPT(0)["K":"Enter N for next choices.",1:"Press RETURN for more choices.")
"RTN","RGUTLK2",188,0)
 W ?35,"Enter B for previous choices.",!
"RTN","RGUTLK2",189,0)
 W "Enter ^ to abort lookup.",?35,"Enter choice number to select.",!
"RTN","RGUTLK2",190,0)
 W "Any other entry = new lookup."
"RTN","RGUTLK2",191,0)
 W:%CIAOPT(0)["M" ?35,"Separate multiple selections by semicolons."
"RTN","RGUTLK2",192,0)
 R !!,"Press any key to continue...",*%:DTIME
"RTN","RGUTLK2",193,0)
 Q
"RTN","RGUTLK2",194,0)
PAUSE Q:%CIARS
"RTN","RGUTLK2",195,0)
 N %
"RTN","RGUTLK2",196,0)
 R !,"Press any key for more...",*%:DTIME
"RTN","RGUTLK2",197,0)
 W $$XY(0,%CIAY+2),%CIAEOS
"RTN","RGUTLK2",198,0)
 Q
"RTN","RGUTLK2",199,0)
XY(X,Y) ;I %CIARS W:'X *13 S $X=X,$Y=Y Q ""
"RTN","RGUTLK2",200,0)
 S:%CIARS Y=$Y
"RTN","RGUTLK2",201,0)
 Q $$XY^RGUT(X,Y)
"RTN","RGUTLKP")
0^51^B29106476
"RTN","RGUTLKP",1,0)
RGUTLKP ;RG/IND/DKM - File lookup utility;20-Jan-2015 13:23;DKM
"RTN","RGUTLKP",2,0)
 ;;3.0;RG UTILITIES;;Mar 20, 2007;Build 98
"RTN","RGUTLKP",3,0)
 ;;
"RTN","RGUTLKP",4,0)
 ;=================================================================
"RTN","RGUTLKP",5,0)
 ; Inputs:
"RTN","RGUTLKP",6,0)
 ;   %CIADIC  = Global root or file #
"RTN","RGUTLKP",7,0)
 ;   %CIAOPT  = Options
"RTN","RGUTLKP",8,0)
 ;      A allow automatic selection of exact match
"RTN","RGUTLKP",9,0)
 ;      B sound bell with selection prompt
"RTN","RGUTLKP",10,0)
 ;      C use roll & scroll mode
"RTN","RGUTLKP",11,0)
 ;      D index is in date/time format
"RTN","RGUTLKP",12,0)
 ;      E use line editor
"RTN","RGUTLKP",13,0)
 ;      F forget the entry (i.e., ^DISV not updated)
"RTN","RGUTLKP",14,0)
 ;      G start with prior entry
"RTN","RGUTLKP",15,0)
 ;      H HTML-formatted output
"RTN","RGUTLKP",16,0)
 ;      I show only lookup identifiers
"RTN","RGUTLKP",17,0)
 ;      J show only secondary identifiers
"RTN","RGUTLKP",18,0)
 ;      K null entry at select prompt exits
"RTN","RGUTLKP",19,0)
 ;      L like X, but allows lookup at select prompt
"RTN","RGUTLKP",20,0)
 ;      M allow multiple selection
"RTN","RGUTLKP",21,0)
 ;      O show entry only once
"RTN","RGUTLKP",22,0)
 ;      P partial lookup
"RTN","RGUTLKP",23,0)
 ;      Q silent lookup
"RTN","RGUTLKP",24,0)
 ;      R reverse search through indices
"RTN","RGUTLKP",25,0)
 ;      S start selection list at last selection
"RTN","RGUTLKP",26,0)
 ;      T forget trapped inputs
"RTN","RGUTLKP",27,0)
 ;      U force uppercase translation
"RTN","RGUTLKP",28,0)
 ;      V extended DISV recall (prompt-specific)
"RTN","RGUTLKP",29,0)
 ;      W use multi-term lookup algorithm
"RTN","RGUTLKP",30,0)
 ;      X do not prompt for input
"RTN","RGUTLKP",31,0)
 ;      Y right justify secondary identifiers
"RTN","RGUTLKP",32,0)
 ;      Z perform special formatting of output
"RTN","RGUTLKP",33,0)
 ;      1 automatic selection if one match only
"RTN","RGUTLKP",34,0)
 ;      2-9 # of columns for selection display (default=1)
"RTN","RGUTLKP",35,0)
 ;      * force all indices to be searched
"RTN","RGUTLKP",36,0)
 ;      ^ allow search to be aborted
"RTN","RGUTLKP",37,0)
 ;   %CIAPRMP = Prompt (optional)
"RTN","RGUTLKP",38,0)
 ;   %CIAXRFS  = Cross-references to examine (all "B"'s by default)
"RTN","RGUTLKP",39,0)
 ;   %CIADATA  = Data to lookup (optional)
"RTN","RGUTLKP",40,0)
 ;   %CIASCN   = Screening criteria (optional)
"RTN","RGUTLKP",41,0)
 ;   %CIAMUL   = Local variable or global reference to
"RTN","RGUTLKP",42,0)
 ;              store multiple hits
"RTN","RGUTLKP",43,0)
 ;   %CIAX     = Column position for prompt (optional)
"RTN","RGUTLKP",44,0)
 ;   %CIAY     = Row position for prompt (optional)
"RTN","RGUTLKP",45,0)
 ;   %CIASID   = Piece # of secondary identifier (optional)
"RTN","RGUTLKP",46,0)
 ;              or executable M code to display same
"RTN","RGUTLKP",47,0)
 ;   %CIATRP   = Special inputs to trap (optional)
"RTN","RGUTLKP",48,0)
 ;   %CIAHLP   = Entry point to invoke help
"RTN","RGUTLKP",49,0)
 ; Outputs:
"RTN","RGUTLKP",50,0)
 ;    Return value = index of selected entry or:
"RTN","RGUTLKP",51,0)
 ;      -1 for forced exit by ^
"RTN","RGUTLKP",52,0)
 ;      -2 for forced exit by ^^
"RTN","RGUTLKP",53,0)
 ;       0 for null entry
"RTN","RGUTLKP",54,0)
 ;=================================================================
"RTN","RGUTLKP",55,0)
ENTRY(%CIADIC,%CIAOPT,%CIAPRMP,%CIAXRFS,%CIADATA,%CIASCN,%CIAMUL,%CIAX,%CIAY,%CIASID,%CIATRP,%CIAHLP) ;
"RTN","RGUTLKP",56,0)
 N %,%1,%N,%S,%Z,%CIAPID,%CIAXRF,%CIASCT,%CIAKEY,%CIAKEY1,%CIADISV,%CIASLCT
"RTN","RGUTLKP",57,0)
 N %CIAXALL,%CIAXRN,%CIASMAX,%CIATRNC,%CIAD,%CIAD1,%CIAD2,%CIABEL,%CIANUM
"RTN","RGUTLKP",58,0)
 N %CIADIR,%CIASLT,%CIACOL,%CIALAST,%CIASAME,%CIAEOS,%CIAEOL,%CIAHTML,%CIARS,%CIAQT
"RTN","RGUTLKP",59,0)
 I $$NEWERR^%ZTER N $ET S $ET=""
"RTN","RGUTLKP",60,0)
 S (%CIAOPT,%CIAOPT(0))=$$UP^XLFSTR($G(%CIAOPT)),%CIAPID="%CIALKP"_$J
"RTN","RGUTLKP",61,0)
 S %CIABEL=$S(%CIAOPT["B":$C(7),1:""),%CIADIR=$S(%CIAOPT["R":-1,1:1)
"RTN","RGUTLKP",62,0)
 S %CIASLT=1,%CIACOL=1,%CIAEOS=$C(27,91,74),%CIAEOL=$C(27,91,75),%CIAHTML=0
"RTN","RGUTLKP",63,0)
 S %CIAX=$G(%CIAX,0),%CIAY=$G(%CIAY,3),DTIME=$G(DTIME,999999)
"RTN","RGUTLKP",64,0)
 S %CIALAST=0,%CIARS=%CIAOPT["C",%CIAQT=%CIAOPT["Q"
"RTN","RGUTLKP",65,0)
 S:%CIARS %CIAEOS="",%CIAY=$Y
"RTN","RGUTLKP",66,0)
 S:%CIAQT %CIAOPT=%CIAOPT_"XHM"
"RTN","RGUTLKP",67,0)
 S:%CIAOPT["H" (%CIABEL,%CIAEOL,%CIAEOS)="",%CIAOPT=%CIAOPT_"X",%CIAHTML=1
"RTN","RGUTLKP",68,0)
 S:%CIAOPT["L" %CIAOPT=%CIAOPT_"X"
"RTN","RGUTLKP",69,0)
 S U="^",DUZ=$G(DUZ,0),IO=$G(IO,$I),IOM=$G(IOM,80),%CIAMUL=$G(%CIAMUL),%CIAHLP=$G(%CIAHLP),%CIATRP=$G(%CIATRP),%CIASCN=$G(%CIASCN),%CIASAME=%CIAOPT["M"&(%CIAMUL'="")
"RTN","RGUTLKP",70,0)
 F %=2:1:9 S:%CIAOPT[% %CIACOL=%
"RTN","RGUTLKP",71,0)
 S:%CIAOPT'["M" %CIAMUL=""
"RTN","RGUTLKP",72,0)
 K:%CIAMUL'="" @%CIAMUL
"RTN","RGUTLKP",73,0)
 S:%CIADIC=+%CIADIC %CIADIC=$$ROOT^DILFD(%CIADIC)
"RTN","RGUTLKP",74,0)
 S:$E(%CIADIC,$L(%CIADIC))="(" %CIADIC=$E(%CIADIC,1,$L(%CIADIC)-1)
"RTN","RGUTLKP",75,0)
 S:$E(%CIADIC,$L(%CIADIC))="," %CIADIC=$E(%CIADIC,1,$L(%CIADIC)-1)
"RTN","RGUTLKP",76,0)
 I %CIADIC["(",$E(%CIADIC,$L(%CIADIC))'=")" S %CIADIC=%CIADIC_")"
"RTN","RGUTLKP",77,0)
 S %CIAPRMP=$G(%CIAPRMP,$S(%CIAOPT["X":"",1:"Enter identifier: "))
"RTN","RGUTLKP",78,0)
 S %CIADISV=$S(%CIADIC[")":$TR(%CIADIC,")",","),1:%CIADIC_"(")_$S(%CIAOPT["V":";"_%CIAPRMP,1:"")
"RTN","RGUTLKP",79,0)
 S %CIASID=$G(%CIASID),%CIAXRFS=$G(%CIAXRFS),%CIADATA=$G(%CIADATA)
"RTN","RGUTLKP",80,0)
 S:%CIASID=+%CIASID %CIASID=$S(%CIASID<0:%CIASID,1:"$P(%Z,U,"_%CIASID_")")
"RTN","RGUTLKP",81,0)
 W:'%CIAHTML $$XY(%CIAX,%CIAY),%CIAEOS,!
"RTN","RGUTLKP",82,0)
 I %CIAOPT["G",$G(^DISV(DUZ,%CIADISV))'="" D
"RTN","RGUTLKP",83,0)
 .S %CIADATA=^(%CIADISV)
"RTN","RGUTLKP",84,0)
 .S:+%CIADATA=%CIADATA %CIADATA=$P($G(@%CIADIC@(%CIADATA,0)),U)
"RTN","RGUTLKP",85,0)
 I %CIAXRFS="" D
"RTN","RGUTLKP",86,0)
 .S (%,%CIAXRFS)="B"
"RTN","RGUTLKP",87,0)
 .F  S %=$O(@%CIADIC@(%)) Q:$E(%)'="B"  S %CIAXRFS=%CIAXRFS_U_%
"RTN","RGUTLKP",88,0)
 F %=1:1:$L(%CIAXRFS,U) S %1=$P(%CIAXRFS,U,%) S:%1'="" %CIAXRFS($P(%1,":"))=$P(%1,":",2),$P(%CIAXRFS,U,%)=$P(%1,":")
"RTN","RGUTLKP",89,0)
 S (%CIAD1,%CIAD2)=""
"RTN","RGUTLKP",90,0)
 D RM(0)
"RTN","RGUTLKP",91,0)
 S %CIAIEN=$$INPUT
"RTN","RGUTLKP",92,0)
 W:'%CIAHTML $$XY(%CIAX+$L(%CIAPRMP),%CIAY),$$TRUNC^RGUT(%CIAD2,IOM-$X),%CIAEOS
"RTN","RGUTLKP",93,0)
 D RM(IOM)
"RTN","RGUTLKP",94,0)
 K ^TMP(%CIAPID)
"RTN","RGUTLKP",95,0)
 Q %CIAIEN
"RTN","RGUTLKP",96,0)
INPUT() ;
"RTN","RGUTLKP",97,0)
INP K ^TMP(%CIAPID)
"RTN","RGUTLKP",98,0)
 D READ
"RTN","RGUTLKP",99,0)
 S:%CIAOPT["U" %CIAD=$$UP^XLFSTR(%CIAD)
"RTN","RGUTLKP",100,0)
 S @$$TRAP^RGUTOS("ERROR^RGUTLKP")
"RTN","RGUTLKP",101,0)
 I %CIAD="",%CIATRP'="" S %CIAD=$G(@%CIATRP@(" "))
"RTN","RGUTLKP",102,0)
 Q:"^^"[%CIAD -$L(%CIAD)
"RTN","RGUTLKP",103,0)
 I "?"[%CIAD D HELP1^RGUTLK2 G INP
"RTN","RGUTLKP",104,0)
 I %CIAD=" " D SAME G:%CIAD="" INP2
"RTN","RGUTLKP",105,0)
 I %CIATRP'="",$D(@%CIATRP@(%CIAD)) D  Q %CIAD
"RTN","RGUTLKP",106,0)
 .S %CIASAME=1
"RTN","RGUTLKP",107,0)
 .D:%CIAOPT'["T" DISV^RGUTLK2(%CIAD)
"RTN","RGUTLKP",108,0)
 .S %CIAD2=$G(@%CIATRP@(%CIAD))
"RTN","RGUTLKP",109,0)
 .S:%CIAD2="" %CIAD2=%CIAD
"RTN","RGUTLKP",110,0)
 S:%CIAD="??" %CIAD=""
"RTN","RGUTLKP",111,0)
 I $E(%CIAD,$L(%CIAD))="*" S %CIAXALL=1,%CIAD=$E(%CIAD,1,$L(%CIAD)-1)
"RTN","RGUTLKP",112,0)
 E  S %CIAXALL=%CIAOPT["*"
"RTN","RGUTLKP",113,0)
 S %CIAIEN=$$LKP^RGUTLK2(%CIAD)
"RTN","RGUTLKP",114,0)
INP2 G INP:%CIAIEN=""!$L(%CIAD1)
"RTN","RGUTLKP",115,0)
 Q %CIAIEN
"RTN","RGUTLKP",116,0)
READ S %CIAD=""
"RTN","RGUTLKP",117,0)
 F  Q:%CIAD'=""!(%CIAD1="")  S %CIAD=$P(%CIAD1,";"),%CIAD1=$P(%CIAD1,";",2,999)
"RTN","RGUTLKP",118,0)
 Q:$L(%CIAD)
"RTN","RGUTLKP",119,0)
 S %CIAD=%CIADATA,%CIADATA=""
"RTN","RGUTLKP",120,0)
 W:'%CIAHTML $$XY(0,%CIAY+2),%CIAEOS,$$XY(%CIAX,%CIAY),%CIAPRMP_%CIAEOL
"RTN","RGUTLKP",121,0)
 I %CIAOPT["X" S:%CIAOPT["E" %CIAOPT=$TR(%CIAOPT,"X"),%CIADATA=%CIAD Q
"RTN","RGUTLKP",122,0)
 I %CIAOPT["E" D
"RTN","RGUTLKP",123,0)
 .N %,%1
"RTN","RGUTLKP",124,0)
 .S:%CIAD?1"`"1.N %CIAD=+$E(%CIAD,2,99),%CIAD=$$FMT^RGUTLK2(%CIAD,$P($G(@%CIADIC@(%CIAD,0)),U))
"RTN","RGUTLKP",125,0)
 .S %1=0,%=%CIAX+$L(%CIAPRMP),%=$$ENTRY^RGUTEDT(%CIAD,IOM-%-1,%,%CIAY,"","RHV",,,,,.%1)
"RTN","RGUTLKP",126,0)
 .S:%1=3 %=U
"RTN","RGUTLKP",127,0)
 .S:%="?" %CIADATA=%CIAD
"RTN","RGUTLKP",128,0)
 .S %CIAD=%
"RTN","RGUTLKP",129,0)
 E  I '$L(%CIAD) R %CIAD:DTIME S:'$T %CIAD=U
"RTN","RGUTLKP",130,0)
 I %CIAOPT["M",%CIAD[";" S %CIAD1=%CIAD G READ
"RTN","RGUTLKP",131,0)
 Q
"RTN","RGUTLKP",132,0)
SAME S %CIASAME=0,%CIAIEN="",%CIAD="",%CIASCT=0
"RTN","RGUTLKP",133,0)
 I %CIAMUL'="" D
"RTN","RGUTLKP",134,0)
 .S %=""
"RTN","RGUTLKP",135,0)
 .F  S %=$O(^DISV(DUZ,%CIADISV,%)) Q:%=""  D SM1
"RTN","RGUTLKP",136,0)
 E  S %=$G(^DISV(DUZ,%CIADISV)) D:%'="" SM1
"RTN","RGUTLKP",137,0)
 S:%CIAHTML %CIAIEN=%CIASCT
"RTN","RGUTLKP",138,0)
 Q
"RTN","RGUTLKP",139,0)
SM1 I %CIATRP'="",$D(@%CIATRP@(%)) S %CIAIEN=%,%CIAD=%
"RTN","RGUTLKP",140,0)
 E  I $$VALD^RGUTLK2(%) S %CIAIEN=%
"RTN","RGUTLKP",141,0)
 I  D DISV^RGUTLK2(%CIAIEN) S %CIASCT=%CIASCT+1
"RTN","RGUTLKP",142,0)
 Q
"RTN","RGUTLKP",143,0)
XY(X,Y) Q $$XY^RGUTLK2(.X,.Y)
"RTN","RGUTLKP",144,0)
RM(X) X ^%ZOSF("RM")
"RTN","RGUTLKP",145,0)
 Q
"RTN","RGUTLKP",146,0)
ERROR W:'%CIAHTML $$XY(0,%CIAY+1),*7,%CIAEOL,$$EC^%ZOSV
"RTN","RGUTLKP",147,0)
 S (%CIADATA,%CIAD1,%CIAD2)=""
"RTN","RGUTLKP",148,0)
 G INP
"RTN","RGUTMTL")
0^52^B15092004
"RTN","RGUTMTL",1,0)
RGUTMTL ;RG/IND/DKM - Multi-term lookup support ;04-May-2006 08:19;DKM
"RTN","RGUTMTL",2,0)
 ;;3.0;RG UTILITIES;;Mar 20, 2007;Build 98
"RTN","RGUTMTL",3,0)
 ;;
"RTN","RGUTMTL",4,0)
 ;=================================================================
"RTN","RGUTMTL",5,0)
 ; Parse term into component words (KWIC)
"RTN","RGUTMTL",6,0)
PARSE2(CIATRM,CIARTN,CIAMIN) ;
"RTN","RGUTMTL",7,0)
 N X,L,C,%
"RTN","RGUTMTL",8,0)
 K CIARTN
"RTN","RGUTMTL",9,0)
 S %="CIARTN(I)",X=$$UP^XLFSTR(CIATRM),CIAMIN=+$G(CIAMIN)
"RTN","RGUTMTL",10,0)
 D S^XTLKWIC
"RTN","RGUTMTL",11,0)
 S L="",C=0
"RTN","RGUTMTL",12,0)
 F  S L=$O(CIARTN(L)) Q:L=""  D
"RTN","RGUTMTL",13,0)
 .I $L(L)<CIAMIN K CIARTN(L)
"RTN","RGUTMTL",14,0)
 .E  S C=C+1
"RTN","RGUTMTL",15,0)
 Q C
"RTN","RGUTMTL",16,0)
 ; Parse term into component words
"RTN","RGUTMTL",17,0)
PARSE(CIATRM,CIARTN,CIAMIN) ;
"RTN","RGUTMTL",18,0)
 N X,Y,Z,L,C
"RTN","RGUTMTL",19,0)
 K CIARTN
"RTN","RGUTMTL",20,0)
 S CIATRM=$$UP^XLFSTR(CIATRM),C=0,CIAMIN=+$G(CIAMIN,1),Z=""
"RTN","RGUTMTL",21,0)
 F X=1:1 Q:'$L(CIATRM)  D:$E(CIATRM,X)'?1AN
"RTN","RGUTMTL",22,0)
 .S Y=Z,Z=$E(CIATRM,X),L=$E(CIATRM,1,X-1),CIATRM=$E(CIATRM,X+1,999),X=0
"RTN","RGUTMTL",23,0)
 .I $L(L)'<CIAMIN,L'=+L,'$D(CIARTN(L)) S CIARTN(L)=Y,C=C+1,Y=""
"RTN","RGUTMTL",24,0)
 Q C
"RTN","RGUTMTL",25,0)
 ; Create/delete an MTL cross reference for term
"RTN","RGUTMTL",26,0)
XREF(CIART,CIATRM,CIADA,CIADEL) ;
"RTN","RGUTMTL",27,0)
 N CIAZ,CIAG
"RTN","RGUTMTL",28,0)
 S CIAZ=$L(CIART),CIAG=$S($E(CIART,CIAZ)=")":$E(CIART,1,CIAZ-1)_",",1:CIART_"(")_"CIAZ,",CIAZ=$C(1)
"RTN","RGUTMTL",29,0)
 F  S CIAZ=$O(CIADA(CIAZ),-1) Q:'CIAZ  S CIAG=CIAG_""""_CIADA(CIAZ)_""","
"RTN","RGUTMTL",30,0)
 S CIAG=CIAG_""""_CIADA_""")"
"RTN","RGUTMTL",31,0)
 Q:'$$PARSE(CIATRM,.CIAZ)
"RTN","RGUTMTL",32,0)
 S CIAZ="",CIADEL=''$G(CIADEL)
"RTN","RGUTMTL",33,0)
 L +@CIART:30
"RTN","RGUTMTL",34,0)
 F  S CIAZ=$O(CIAZ(CIAZ)) Q:CIAZ=""  D
"RTN","RGUTMTL",35,0)
 .I ''$D(@CIAG)=CIADEL D
"RTN","RGUTMTL",36,0)
 ..I CIADEL K @CIAG  K:$D(@CIART@(CIAZ))<10 @CIART@(CIAZ)
"RTN","RGUTMTL",37,0)
 ..E  D:'$D(@CIART@(CIAZ)) REFNEW(CIAZ) S @CIAG=""
"RTN","RGUTMTL",38,0)
 ..D REFCNT(CIAZ,$S(CIADEL:-1,1:1))
"RTN","RGUTMTL",39,0)
 L -@CIART
"RTN","RGUTMTL",40,0)
 Q
"RTN","RGUTMTL",41,0)
 ; Increment/decrement reference count for term and its stems
"RTN","RGUTMTL",42,0)
REFCNT(CIAX,CIAI) ;
"RTN","RGUTMTL",43,0)
 Q:'$L(CIAX)
"RTN","RGUTMTL",44,0)
 I $D(@CIART@(CIAX)) D
"RTN","RGUTMTL",45,0)
 .N CIAZ
"RTN","RGUTMTL",46,0)
 .S CIAZ=$G(@CIART@(CIAX))+CIAI
"RTN","RGUTMTL",47,0)
 .I CIAZ<1 K @CIART@(CIAX)
"RTN","RGUTMTL",48,0)
 .E  S @CIART@(CIAX)=CIAZ
"RTN","RGUTMTL",49,0)
 D REFCNT($E(CIAX,1,$L(CIAX)-1),CIAI)
"RTN","RGUTMTL",50,0)
 Q
"RTN","RGUTMTL",51,0)
 ; Create new term reference
"RTN","RGUTMTL",52,0)
REFNEW(CIAX) ;
"RTN","RGUTMTL",53,0)
 N CIAZ,CIAC,CIAABR
"RTN","RGUTMTL",54,0)
 S CIAZ=CIAX,CIAC=0,CIAABR=0
"RTN","RGUTMTL",55,0)
 F  S CIAZ=$$STEM(CIAZ,CIAX) Q:'$L(CIAZ)  S CIAC=CIAC+$G(@CIART@(CIAZ)),CIAZ=CIAZ_$C(255)
"RTN","RGUTMTL",56,0)
 S @CIART@(CIAX)=CIAC
"RTN","RGUTMTL",57,0)
 Q
"RTN","RGUTMTL",58,0)
 ; Lookup a term in an MTL index
"RTN","RGUTMTL",59,0)
 ; CIART  = Root of index (e.g., ^CIACOD(990.9,"AD"))
"RTN","RGUTMTL",60,0)
 ; CIATRM = Term to lookup
"RTN","RGUTMTL",61,0)
 ; CIARTN = Root of returned array (note: killed before populated)
"RTN","RGUTMTL",62,0)
 ; CIAABR = If nonzero, user can abort lookup with ^
"RTN","RGUTMTL",63,0)
LKP(CIART,CIATRM,CIARTN,CIAABR) ;
"RTN","RGUTMTL",64,0)
 N CIAX,CIAY,CIAW,CIAF,CIAIEN,CIAL,CIAM,CIATRM1
"RTN","RGUTMTL",65,0)
 I $$NEWERR^%ZTER N $ET S $ET=""
"RTN","RGUTMTL",66,0)
 K @CIARTN
"RTN","RGUTMTL",67,0)
 S CIAABR=+$G(CIAABR),@$$TRAP^RGUTOS("LKP2^RGUTMTL")
"RTN","RGUTMTL",68,0)
 I $$PARSE(CIATRM,.CIATRM)=1 S CIAW(1,$O(CIATRM("")))=""
"RTN","RGUTMTL",69,0)
 E  D
"RTN","RGUTMTL",70,0)
 .S CIATRM="",CIAM=9999999999
"RTN","RGUTMTL",71,0)
 .F  S CIATRM=$O(CIATRM(CIATRM)) Q:CIATRM=""  D  Q:CIAL<0
"RTN","RGUTMTL",72,0)
 ..S CIAX=CIATRM(CIATRM)["=",CIAY=CIATRM(CIATRM)["~",CIATRM1="",CIAL=$S(CIAY:9999999999,1:-1)
"RTN","RGUTMTL",73,0)
 ..I 'CIAY F  S CIATRM1=$$STEM(CIATRM1,CIATRM,CIAX) Q:CIATRM1=""  D:$D(^(CIATRM1))>1  Q:CIAL>CIAM
"RTN","RGUTMTL",74,0)
 ...S:CIAL=-1 CIAL=0
"RTN","RGUTMTL",75,0)
 ...S CIAL=CIAL+$G(^(CIATRM1))
"RTN","RGUTMTL",76,0)
 ...S CIATRM1=CIATRM1_$C(255)
"RTN","RGUTMTL",77,0)
 ..S CIAW(CIAL,CIATRM)=""
"RTN","RGUTMTL",78,0)
 ..I CIAL>0,CIAL<CIAM S CIAM=CIAL
"RTN","RGUTMTL",79,0)
 ..D:CIAABR ABORT
"RTN","RGUTMTL",80,0)
 Q:$D(CIAW(-1)) 0
"RTN","RGUTMTL",81,0)
 S CIAW="",CIAF=0
"RTN","RGUTMTL",82,0)
 F  S CIAW=$O(CIAW(CIAW)),CIATRM="" Q:CIAW=""  D  Q:CIAF=-1
"RTN","RGUTMTL",83,0)
 .F  S CIATRM=$O(CIAW(CIAW,CIATRM)) Q:CIATRM=""  D  Q:CIAF=-1
"RTN","RGUTMTL",84,0)
 ..S CIAX=CIATRM(CIATRM)["=",CIAY=CIATRM(CIATRM)["~"
"RTN","RGUTMTL",85,0)
 ..I CIAF D
"RTN","RGUTMTL",86,0)
 ...S CIAIEN=0
"RTN","RGUTMTL",87,0)
 ...F  S CIAIEN=$O(@CIARTN@(CIAIEN)),CIATRM1="" Q:'CIAIEN  D  Q:CIAF=-1
"RTN","RGUTMTL",88,0)
 ....F  S CIATRM1=$$STEM(CIATRM1,CIATRM,CIAX) Q:CIATRM1=""  Q:$D(^(CIATRM1,CIAIEN))
"RTN","RGUTMTL",89,0)
 ....I CIAY-(CIATRM1="") K @CIARTN@(CIAIEN) S:$D(@CIARTN)'>1 CIAF=-1
"RTN","RGUTMTL",90,0)
 ..E  D
"RTN","RGUTMTL",91,0)
 ...S CIATRM1="",CIAF=1
"RTN","RGUTMTL",92,0)
 ...F  S CIATRM1=$$STEM(CIATRM1,CIATRM,CIAX) Q:CIATRM1=""  M @CIARTN=^(CIATRM1)
"RTN","RGUTMTL",93,0)
 ...S:$D(@CIARTN)'>1 CIAF=-1
"RTN","RGUTMTL",94,0)
 Q $D(@CIARTN)>1
"RTN","RGUTMTL",95,0)
LKP2 K @CIARTN
"RTN","RGUTMTL",96,0)
 Q -1
"RTN","RGUTMTL",97,0)
 ; Check for user abort
"RTN","RGUTMTL",98,0)
ABORT N CIAZ
"RTN","RGUTMTL",99,0)
 R CIAZ#1:0
"RTN","RGUTMTL",100,0)
 D:CIAZ=U RAISE^RGUTOS()
"RTN","RGUTMTL",101,0)
 Q
"RTN","RGUTMTL",102,0)
 ; Return in successive calls all terms sharing common stem
"RTN","RGUTMTL",103,0)
 ; (sets naked reference)
"RTN","RGUTMTL",104,0)
STEM(CIALAST,CIASTEM,CIAF) ;
"RTN","RGUTMTL",105,0)
 D:CIAABR ABORT
"RTN","RGUTMTL",106,0)
 I CIALAST="" S CIALAST=CIASTEM Q:$D(@CIART@(CIALAST)) CIALAST
"RTN","RGUTMTL",107,0)
 Q:$G(CIAF) ""
"RTN","RGUTMTL",108,0)
 S CIALAST=$O(@CIART@(CIALAST))
"RTN","RGUTMTL",109,0)
 Q $S($E(CIALAST,1,$L(CIASTEM))=CIASTEM:CIALAST,1:"")
"RTN","RGUTNTEG")
0^72^B4457644
"RTN","RGUTNTEG",1,0)
RGUTNTEG ;ISC/XTSUMBLD KERNEL - Package checksum checker ;3070531.172703
"RTN","RGUTNTEG",2,0)
 ;;3.0;RG UTILITIES;;Mar 20,2007;Build 98
"RTN","RGUTNTEG",3,0)
 ;;7.3;3070531.172703
"RTN","RGUTNTEG",4,0)
 S XT4="I 1",X=$T(+3) W !!,"Checksum routine created on ",$P(X,";",4)," by KERNEL V",$P(X,";",3),!
"RTN","RGUTNTEG",5,0)
CONT F XT1=1:1 S XT2=$T(ROU+XT1) Q:XT2=""  S X=$P(XT2," ",1),XT3=$P(XT2,";",3) X XT4 I $T W !,X X ^%ZOSF("TEST") S:'$T XT3=0 X:XT3 ^%ZOSF("RSUM") W ?10,$S('XT3:"Routine not in UCI",XT3'=Y:"Calculated "_$C(7)_Y_", off by "_(Y-XT3),1:"ok")
"RTN","RGUTNTEG",6,0)
 ;
"RTN","RGUTNTEG",7,0)
 K %1,%2,%3,X,Y,XT1,XT2,XT3,XT4 Q
"RTN","RGUTNTEG",8,0)
ONE S XT4="I $D(^UTILITY($J,X))",X=$T(+3) W !!,"Checksum routine created on ",$P(X,";",4)," by KERNEL V",$P(X,";",3),!
"RTN","RGUTNTEG",9,0)
 W !,"Check a subset of routines:" K ^UTILITY($J) X ^%ZOSF("RSEL")
"RTN","RGUTNTEG",10,0)
 W ! G CONT
"RTN","RGUTNTEG",11,0)
ROU ;;
"RTN","RGUTNTEG",12,0)
RGUT ;;7860723
"RTN","RGUTNTEG",13,0)
RGUTSTX ;;4121035
"RTN","RGUTNTEG",14,0)
RGUTSTX0 ;;3170389
"RTN","RGUTNTEG",15,0)
RGUTSTX1 ;;5106879
"RTN","RGUTNTEG",16,0)
RGUTALR ;;928023
"RTN","RGUTNTEG",17,0)
RGUTBIG ;;6024487
"RTN","RGUTNTEG",18,0)
RGUTDAT ;;5928509
"RTN","RGUTNTEG",19,0)
RGUTDIC ;;7938841
"RTN","RGUTNTEG",20,0)
RGUTDT ;;3374353
"RTN","RGUTNTEG",21,0)
RGUTEDT ;;16189636
"RTN","RGUTNTEG",22,0)
RGUTIMP ;;4666764
"RTN","RGUTNTEG",23,0)
RGUTIN0 ;;1050344
"RTN","RGUTNTEG",24,0)
RGUTIN16 ;;1582494
"RTN","RGUTNTEG",25,0)
RGUTIN18 ;;1178580
"RTN","RGUTNTEG",26,0)
RGUTIN8 ;;1256732
"RTN","RGUTNTEG",27,0)
RGUTLK2 ;;13861180
"RTN","RGUTNTEG",28,0)
RGUTLKP ;;7525106
"RTN","RGUTNTEG",29,0)
RGUTMTL ;;4714339
"RTN","RGUTNTEG",30,0)
RGUTOS ;;2258460
"RTN","RGUTNTEG",31,0)
RGUTOS1 ;;2630722
"RTN","RGUTNTEG",32,0)
RGUTRPC ;;4585641
"RTN","RGUTNTEG",33,0)
RGUTTSK ;;891526
"RTN","RGUTNTEG",34,0)
RGUTUSR ;;1781283
"RTN","RGUTNTEG",35,0)
RGUTUU ;;1311666
"RTN","RGUTNTEG",36,0)
RGUTINIT ;;3174314
"RTN","RGUTNTEG",37,0)
RGUTHFS ;;2629858
"RTN","RGUTNTEG",38,0)
RGUTDDR ;;9459760
"RTN","RGUTNTEG",39,0)
RGUTRPRT ;;1778623
"RTN","RGUTNTEG",40,0)
RGUTREG ;;578780
"RTN","RGUTNTEG",41,0)
RGUTBC28 ;;2148213
"RTN","RGUTNTEG",42,0)
RGUTBC39 ;;2796261
"RTN","RGUTNTEG",43,0)
RGUTBCDA ;;3981182
"RTN","RGUTNTEG",44,0)
RGUTIN68 ;;1159584
"RTN","RGUTNTEG",45,0)
RGUTIN58 ;;1357669
"RTN","RGUTNTEG",46,0)
RGUT1 ;;508281
"RTN","RGUTOS")
0^53^B7841558
"RTN","RGUTOS",1,0)
RGUTOS ;RG/IND/DKM - Platform-dependent operations;04-May-2006 08:19;DKM
"RTN","RGUTOS",2,0)
 ;;3.0;RG UTILITIES;;Mar 20, 2007;Build 98
"RTN","RGUTOS",3,0)
 ;;
"RTN","RGUTOS",4,0)
 ;=================================================================
"RTN","RGUTOS",5,0)
 ; Return version #
"RTN","RGUTOS",6,0)
VER() Q $P($T(+2),";",3)
"RTN","RGUTOS",7,0)
CVTFN(CIAFIL,CIAROOT) ;
"RTN","RGUTOS",8,0)
 N CIAZ,CIAZ1,CIAD
"RTN","RGUTOS",9,0)
 S CIAD=$$DIRDLM,CIAROOT=$G(CIAROOT)
"RTN","RGUTOS",10,0)
 S:$E(CIAROOT,$L(CIAROOT))=$E(CIAD,3) CIAROOT=$E(CIAROOT,1,$L(CIAROOT)-1)
"RTN","RGUTOS",11,0)
 S CIAZ=$L(CIAFIL,"/"),CIAZ1=$P(CIAFIL,"/",1,CIAZ-1),CIAFIL=$P(CIAFIL,"/",CIAZ)
"RTN","RGUTOS",12,0)
 S:$L(CIAZ1) CIAROOT=CIAROOT_$E(CIAD,$S($L(CIAROOT):2,1:1))_$TR(CIAZ1,"/.-",$E(CIAD,2))
"RTN","RGUTOS",13,0)
 Q CIAROOT_$S($L(CIAROOT):$E(CIAD,3),1:"")_CIAFIL
"RTN","RGUTOS",14,0)
 ; Set right margin
"RTN","RGUTOS",15,0)
RM(X) ;EP
"RTN","RGUTOS",16,0)
 X ^%ZOSF("RM")
"RTN","RGUTOS",17,0)
 Q
"RTN","RGUTOS",18,0)
 ; Test for tag/routine
"RTN","RGUTOS",19,0)
TEST(X) ;EP
"RTN","RGUTOS",20,0)
 N Z
"RTN","RGUTOS",21,0)
 S:X[U Z=$P(X,U),X=$P(X,U,2)
"RTN","RGUTOS",22,0)
 Q:'$L(X)!(X'?.1"%"1.AN) 0
"RTN","RGUTOS",23,0)
 X ^%ZOSF("TEST")
"RTN","RGUTOS",24,0)
 Q $S('$T:0,$G(Z)="":1,Z'?.1"%"1.AN:0,1:$T(@Z^@X)'="")
"RTN","RGUTOS",25,0)
ETRAP() Q $$NEWERR^%ZTER
"RTN","RGUTOS",26,0)
 ; Open a host file
"RTN","RGUTOS",27,0)
OPENX(X1,X2) ;EP
"RTN","RGUTOS",28,0)
 D OPEN(.X1,.X2)
"RTN","RGUTOS",29,0)
 Q X1
"RTN","RGUTOS",30,0)
 ;;
"RTN","RGUTOS",31,0)
 ;=================================================================
"RTN","RGUTOS",32,0)
 ; Open a host file
"RTN","RGUTOS",33,0)
OPEN(X1,X2) ;EP
"RTN","RGUTOS",34,0)
 O X1:$S("Rr"[$G(X2):"RS","Ww"[X2:"WNS","Bb"[X2:"RF",1:""):0
"RTN","RGUTOS",35,0)
 E  ZT "NOPEN"
"RTN","RGUTOS",36,0)
 U X1
"RTN","RGUTOS",37,0)
 S ^TMP("RGUTHFS",$J,X1)=""
"RTN","RGUTOS",38,0)
 Q
"RTN","RGUTOS",39,0)
 ; Close a host file
"RTN","RGUTOS",40,0)
CLOSE(X) ;EP
"RTN","RGUTOS",41,0)
 C X
"RTN","RGUTOS",42,0)
 K ^TMP("RGUTHFS",$J,X)
"RTN","RGUTOS",43,0)
 Q
"RTN","RGUTOS",44,0)
 ; Close all open host files
"RTN","RGUTOS",45,0)
CLOSEALL ;EP
"RTN","RGUTOS",46,0)
 N Z
"RTN","RGUTOS",47,0)
 S Z=""
"RTN","RGUTOS",48,0)
 F  S Z=$O(^TMP("RGUTHFS",$J,Z)) Q:Z=""  C Z
"RTN","RGUTOS",49,0)
 K ^TMP("RGUTHFS",$J)
"RTN","RGUTOS",50,0)
 Q
"RTN","RGUTOS",51,0)
EOF ZT:$ZA=-1 "ENDOFFILE"
"RTN","RGUTOS",52,0)
 Q
"RTN","RGUTOS",53,0)
EOFERR() Q:$ZE["ENDOFFILE"
"RTN","RGUTOS",54,0)
 ; Read a line of data
"RTN","RGUTOS",55,0)
READ(X,Y) ;EP
"RTN","RGUTOS",56,0)
 N $ET
"RTN","RGUTOS",57,0)
 S $ET="",$ZT="READX"
"RTN","RGUTOS",58,0)
 U $G(Y,$I)
"RTN","RGUTOS",59,0)
 Q:$ZEOF 1
"RTN","RGUTOS",60,0)
 R X:5
"RTN","RGUTOS",61,0)
 Q:$T 0
"RTN","RGUTOS",62,0)
READX Q 1
"RTN","RGUTOS",63,0)
 ; Delete a host file
"RTN","RGUTOS",64,0)
DELETE(X) ;EP
"RTN","RGUTOS",65,0)
 S X=$ZF(-1,"rm """_X_"""")
"RTN","RGUTOS",66,0)
 Q
"RTN","RGUTOS",67,0)
 ; Rename a host file
"RTN","RGUTOS",68,0)
RENAME(X1,X2) ;EP
"RTN","RGUTOS",69,0)
 S X1=$ZF(-1,"mv """_X1_""" """_X2_"""")
"RTN","RGUTOS",70,0)
 Q
"RTN","RGUTOS",71,0)
 ; Generate directory listing
"RTN","RGUTOS",72,0)
DIR(X1,X2,X3) ;EP
"RTN","RGUTOS",73,0)
 N Z,Z1,FDLM
"RTN","RGUTOS",74,0)
 S FDLM=$E($$DIRDLM,1)
"RTN","RGUTOS",75,0)
 S X3=$G(X3,$NA(^UTILITY("DIR",$J)))
"RTN","RGUTOS",76,0)
 K @X3
"RTN","RGUTOS",77,0)
 S:'$G(X2) X2=9999999999
"RTN","RGUTOS",78,0)
 F Z=1:1:X2 S Z1=$ZSEARCH(X1),X1="" Q:Z1=""  D
"RTN","RGUTOS",79,0)
 .S Z1=$P(Z1,FDLM,$L(Z1,FDLM))
"RTN","RGUTOS",80,0)
 .S:$TR(Z1,".")'="" @X3@(Z1)=""
"RTN","RGUTOS",81,0)
 Q
"RTN","RGUTOS",82,0)
 ; Return path delimiters
"RTN","RGUTOS",83,0)
DIRDLM() ;EP
"RTN","RGUTOS",84,0)
 Q "///"
"RTN","RGUTOS",85,0)
 ; Return default working directory
"RTN","RGUTOS",86,0)
DEFDIR(X) ;EP
"RTN","RGUTOS",87,0)
 N FDLM
"RTN","RGUTOS",88,0)
 S FDLM=$E($$DIRDLM,1)
"RTN","RGUTOS",89,0)
 S X=$G(X,$P($G(^XTV(8989.3,1,"DEV")),U))
"RTN","RGUTOS",90,0)
 S:$E(X,$L(X))'=FDLM X=X_FDLM
"RTN","RGUTOS",91,0)
 Q X
"RTN","RGUTOS",92,0)
 ; Parse current error
"RTN","RGUTOS",93,0)
ERR(X1,X2,X3) ;EP
"RTN","RGUTOS",94,0)
 S X1=$E($P($ZE,">"),2,99),X2=$P($P($ZE,">",2),":"),X3=X1
"RTN","RGUTOS",95,0)
 S:X2["*" X2=""
"RTN","RGUTOS",96,0)
 S:$E(X1)="Z" X3=$E(X1,2,99),X1="ZTRAP"
"RTN","RGUTOS",97,0)
 Q
"RTN","RGUTOS",98,0)
 ; Raise an exception
"RTN","RGUTOS",99,0)
RAISE(X) ;EP
"RTN","RGUTOS",100,0)
 ZT $G(X)
"RTN","RGUTOS",101,0)
 ; Set error trap
"RTN","RGUTOS",102,0)
TRAP(X) ;EP
"RTN","RGUTOS",103,0)
 Q $S($D(X):"$ZT="""_X_"""",1:"$ZT")
"RTN","RGUTOS",104,0)
 ; Return size of a file
"RTN","RGUTOS",105,0)
SIZE(X) ;EP
"RTN","RGUTOS",106,0)
 Q 0
"RTN","RGUTOS",107,0)
 ; Return free disk space
"RTN","RGUTOS",108,0)
FREE(X) ;EP
"RTN","RGUTOS",109,0)
 Q 0
"RTN","RGUTOS",110,0)
 ; Return host ip address
"RTN","RGUTOS",111,0)
HOSTIP() ;EP
"RTN","RGUTOS",112,0)
 Q $P($P($ZU(131,1),","),":",2)
"RTN","RGUTOS",113,0)
 ; Return host name
"RTN","RGUTOS",114,0)
HOSTNAME() ;EP
"RTN","RGUTOS",115,0)
 Q $P($P($ZU(131,1),","),":")
"RTN","RGUTOS",116,0)
 ; Return client ip address
"RTN","RGUTOS",117,0)
CLIENTIP() ;EP
"RTN","RGUTOS",118,0)
 N IP,$ET
"RTN","RGUTOS",119,0)
 S $ET="S $EC=""""",IP=$ZU(111,0)
"RTN","RGUTOS",120,0)
 Q $A(IP,1)_"."_$A(IP,2)_"."_$A(IP,3)_"."_$A(IP,4)
"RTN","RGUTOS1")
0^54^B10411038
"RTN","RGUTOS1",1,0)
RGUTOS ;RG/IND/DKM - Platform-dependent operations;04-May-2006 08:19;DKM
"RTN","RGUTOS1",2,0)
 ;;3.0;RG UTILITIES;;Mar 20, 2007;Build 98
"RTN","RGUTOS1",3,0)
 ;;
"RTN","RGUTOS1",4,0)
 ;=================================================================
"RTN","RGUTOS1",5,0)
 ; Return version # of RTL
"RTN","RGUTOS1",6,0)
VER() ;EP
"RTN","RGUTOS1",7,0)
 Q +$P($T(RGUTOS+1),";",3)
"RTN","RGUTOS1",8,0)
 ; Set right margin
"RTN","RGUTOS1",9,0)
RM(X) ;EP
"RTN","RGUTOS1",10,0)
 X ^%ZOSF("RM")
"RTN","RGUTOS1",11,0)
 Q
"RTN","RGUTOS1",12,0)
 ; Test for routine/tag
"RTN","RGUTOS1",13,0)
TEST(X) ;EP
"RTN","RGUTOS1",14,0)
 N Z
"RTN","RGUTOS1",15,0)
 S:X[U Z=$P(X,U),X=$P(X,U,2)
"RTN","RGUTOS1",16,0)
 Q:'$L(X)!(X'?.1"%"1.AN) 0
"RTN","RGUTOS1",17,0)
 X ^%ZOSF("TEST")
"RTN","RGUTOS1",18,0)
 Q $S('$T:0,$G(Z)="":1,Z'?.1"%"1.AN:0,1:$T(@Z^@X)'="")
"RTN","RGUTOS1",19,0)
 ; Raise an exception
"RTN","RGUTOS1",20,0)
RAISE(X) ;EP
"RTN","RGUTOS1",21,0)
 ZT $G(X)
"RTN","RGUTOS1",22,0)
 ; Return code to set error trap
"RTN","RGUTOS1",23,0)
TRAP(X) ;EP
"RTN","RGUTOS1",24,0)
 Q $$SUBST^RGUT(^%ZOSF("TRAP"),"X",""""_X_"""")
"RTN","RGUTOS1",25,0)
 ; Check for $ET capability
"RTN","RGUTOS1",26,0)
ETRAP() ;EP
"RTN","RGUTOS1",27,0)
 Q $$NEWERR^%ZTER
"RTN","RGUTOS1",28,0)
 ; Open a file (extrinsic)
"RTN","RGUTOS1",29,0)
OPENX(X1,X2) ;EP
"RTN","RGUTOS1",30,0)
 D OPEN(.X1,.X2)
"RTN","RGUTOS1",31,0)
 Q X1
"RTN","RGUTOS1",32,0)
 ; Open a file
"RTN","RGUTOS1",33,0)
OPEN(X1,X2) ;EP
"RTN","RGUTOS1",34,0)
 N IO,POP,X3
"RTN","RGUTOS1",35,0)
 D PARSE(.X1,.X3),OPEN^%ZISH(X3_X1,X3,X1,$G(X2,"R"),32767)
"RTN","RGUTOS1",36,0)
 I POP ZT "OPEN"
"RTN","RGUTOS1",37,0)
 S ^XTMP("RGUTHFS",$J,IO)=X3_X1,X1=IO
"RTN","RGUTOS1",38,0)
 Q
"RTN","RGUTOS1",39,0)
 ; Close a file
"RTN","RGUTOS1",40,0)
CLOSE(X) ;EP
"RTN","RGUTOS1",41,0)
 N Y
"RTN","RGUTOS1",42,0)
 S Y=$G(^XTMP("RGUTHFS",$J,X)),IO=X
"RTN","RGUTOS1",43,0)
 K ^(X)
"RTN","RGUTOS1",44,0)
 D CLOSE^%ZISH(Y)
"RTN","RGUTOS1",45,0)
 Q
"RTN","RGUTOS1",46,0)
 ; Close all open HFS
"RTN","RGUTOS1",47,0)
CLOSEALL ;EP
"RTN","RGUTOS1",48,0)
 N Z
"RTN","RGUTOS1",49,0)
 S Z=""
"RTN","RGUTOS1",50,0)
 F  S Z=$O(^XTMP("RGUTHFS",$J,Z)) Q:Z=""  D CLOSE(Z)
"RTN","RGUTOS1",51,0)
 Q
"RTN","RGUTOS1",52,0)
 ; Parse out directory from filename
"RTN","RGUTOS1",53,0)
PARSE(X,Y) ;EP
"RTN","RGUTOS1",54,0)
 N D,Z
"RTN","RGUTOS1",55,0)
 S D=$E($$DIRDLM,3),Z=$L(X,D),Y=$P(X,D,1,Z-1),Y=$S($L(Y):Y,1:$$PWD^%ZISH)_$S(Z>1:D,1:""),X=$P(X,D,Z)
"RTN","RGUTOS1",56,0)
 Q
"RTN","RGUTOS1",57,0)
 ; Read a line
"RTN","RGUTOS1",58,0)
READ(X,Y) ;EP
"RTN","RGUTOS1",59,0)
 N IO,%ZA,%ZB,%ZC,%ZL
"RTN","RGUTOS1",60,0)
 S IO=$G(Y,$I)
"RTN","RGUTOS1",61,0)
 D READNXT^%ZISH(.X)
"RTN","RGUTOS1",62,0)
 U IO
"RTN","RGUTOS1",63,0)
 Q $$STATUS^%ZISH&'$L(X)
"RTN","RGUTOS1",64,0)
 ; Delete a file
"RTN","RGUTOS1",65,0)
DELETE(X) ;EP
"RTN","RGUTOS1",66,0)
 N Z
"RTN","RGUTOS1",67,0)
 D PARSE(.X,.Z)
"RTN","RGUTOS1",68,0)
 S:$L(X) Z(X)="",Z=$$DEL^%ZISH(Z,"Z")
"RTN","RGUTOS1",69,0)
 Q
"RTN","RGUTOS1",70,0)
 ; Rename a file
"RTN","RGUTOS1",71,0)
RENAME(X1,X2) ;EP
"RTN","RGUTOS1",72,0)
 N X3,X4
"RTN","RGUTOS1",73,0)
 D PARSE(.X1,.X3),PARSE(.X2,.X4)
"RTN","RGUTOS1",74,0)
 I $$MV^%ZISH(X3,X1,X4,X2)
"RTN","RGUTOS1",75,0)
 Q
"RTN","RGUTOS1",76,0)
 ; List files
"RTN","RGUTOS1",77,0)
DIR(X1,X2,X3) ;EP
"RTN","RGUTOS1",78,0)
 N Z
"RTN","RGUTOS1",79,0)
 D PARSE(.X1,.Z)
"RTN","RGUTOS1",80,0)
 S Z(X1)="",X3=$G(X3,"^UTILITY(""DIR"",$J)")
"RTN","RGUTOS1",81,0)
 K @X3
"RTN","RGUTOS1",82,0)
 I $$LIST^%ZISH(Z,"Z",X3)
"RTN","RGUTOS1",83,0)
 Q
"RTN","RGUTOS1",84,0)
 ; Force error if at EOF
"RTN","RGUTOS1",85,0)
EOF I $$STATUS^%ZISH ZT "EOF"
"RTN","RGUTOS1",86,0)
 Q
"RTN","RGUTOS1",87,0)
 ; Returns true if current error is EOF
"RTN","RGUTOS1",88,0)
EOFERR() ;EP
"RTN","RGUTOS1",89,0)
 Q $$EC^%ZOSV["EOF"
"RTN","RGUTOS1",90,0)
 ; URL format filename-->HFS format
"RTN","RGUTOS1",91,0)
CVTFN(CIAFIL,CIAROOT) ;EP
"RTN","RGUTOS1",92,0)
 N CIAZ,CIAZ1,CIAD
"RTN","RGUTOS1",93,0)
 S CIAD=$$DIRDLM,CIAROOT=$G(CIAROOT)
"RTN","RGUTOS1",94,0)
 S:$E(CIAROOT,$L(CIAROOT))=$E(CIAD,3) CIAROOT=$E(CIAROOT,1,$L(CIAROOT)-1)
"RTN","RGUTOS1",95,0)
 S CIAZ=$L(CIAFIL,"/"),CIAZ1=$P(CIAFIL,"/",1,CIAZ-1),CIAFIL=$P(CIAFIL,"/",CIAZ)
"RTN","RGUTOS1",96,0)
 S:$L(CIAZ1) CIAROOT=CIAROOT_$E(CIAD,$S($L(CIAROOT):2,1:1))_$TR(CIAZ1,"/.-",$E(CIAD,2))
"RTN","RGUTOS1",97,0)
 Q CIAROOT_$S($L(CIAROOT):$E(CIAD,3),1:"")_CIAFIL
"RTN","RGUTOS1",98,0)
 ; Return directory delimiters
"RTN","RGUTOS1",99,0)
DIRDLM() ;EP
"RTN","RGUTOS1",100,0)
 N X
"RTN","RGUTOS1",101,0)
 S X=$$PWD^%ZISH
"RTN","RGUTOS1",102,0)
 Q $S(X["[":"[.]",X["\":"\\\",1:"///")
"RTN","RGUTOS1",103,0)
 ; Parse error data
"RTN","RGUTOS1",104,0)
ERR(X1,X2,X3) ;EP
"RTN","RGUTOS1",105,0)
 N X
"RTN","RGUTOS1",106,0)
 S X=$$EC^%ZOSV,X1=$$VERSION^%ZOSV(1)
"RTN","RGUTOS1",107,0)
 G ERRMSM:X1["MSM",ERRDSM:X1["DSM"
"RTN","RGUTOS1",108,0)
 S (X1,X2,X3)=""
"RTN","RGUTOS1",109,0)
 Q
"RTN","RGUTOS1",110,0)
ERRMSM S X1=$E($P(X,">"),2,99),X2=$P($P(X,">",2),":"),X3=X1
"RTN","RGUTOS1",111,0)
 S:X2["*" X2=""
"RTN","RGUTOS1",112,0)
 S:$E(X1)="Z" X3=$E(X1,2,99),X1="ZTRAP"
"RTN","RGUTOS1",113,0)
 Q
"RTN","RGUTOS1",114,0)
ERRDSM S X1=$P($P(X,", ",2),"-",3),X2=$P($P(X,", "),":"),X3=$$TRIM^RGUT($P(X,", ",$S(X1="ZTRAP":4,1:3)))
"RTN","RGUTOS1",115,0)
 Q
"RTN","RGUTREG")
0^64^B709436
"RTN","RGUTREG",1,0)
RGUTREG ;RG/IND/DKM - Various registration actions ;04-May-2006 08:19;DKM
"RTN","RGUTREG",2,0)
 ;;3.0;RG UTILITIES;;Mar 20, 2007;Build 98
"RTN","RGUTREG",3,0)
 ;;
"RTN","RGUTREG",4,0)
 ;=================================================================
"RTN","RGUTREG",5,0)
 ; Register a protocol to an extended action protocol
"RTN","RGUTREG",6,0)
 ; Input: P-Parent protocol
"RTN","RGUTREG",7,0)
 ;        C-Child protocol
"RTN","RGUTREG",8,0)
REGPROT(P,C,ERR) ;
"RTN","RGUTREG",9,0)
 N IENARY,PIEN,AIEN,FDA
"RTN","RGUTREG",10,0)
 D
"RTN","RGUTREG",11,0)
 .I '$L(P)!('$L(C)) S ERR="Missing input parameter" Q
"RTN","RGUTREG",12,0)
 .S IENARY(1)=$$FIND1^DIC(101,"","",P)
"RTN","RGUTREG",13,0)
 .S AIEN=$$FIND1^DIC(101,"","",C)
"RTN","RGUTREG",14,0)
 .I 'IENARY(1)!'AIEN S ERR="Unknown protocol name" Q
"RTN","RGUTREG",15,0)
 .S FDA(101.01,"?+2,"_IENARY(1)_",",.01)=AIEN
"RTN","RGUTREG",16,0)
 .D UPDATE^DIE("S","FDA","IENARY","ERR")
"RTN","RGUTREG",17,0)
 Q:$Q $G(ERR)=""
"RTN","RGUTREG",18,0)
 Q
"RTN","RGUTRPC")
0^56^B16812427
"RTN","RGUTRPC",1,0)
RGUTRPC ;RG/IND/DKM - RPC Encapsulations for RGUT routines ;04-May-2006 08:19;DKM
"RTN","RGUTRPC",2,0)
 ;;3.0;RG UTILITIES;;Mar 20, 2007;Build 98
"RTN","RGUTRPC",3,0)
 ;;
"RTN","RGUTRPC",4,0)
 ;=================================================================
"RTN","RGUTRPC",5,0)
 ; RPC: RGUTDIC
"RTN","RGUTRPC",6,0)
DIC(CIADATA,CIABM,CIACMD,CIAARG) ;
"RTN","RGUTRPC",7,0)
 S CIADATA(0)=$$ENTRY^RGUTDIC(CIABM,CIACMD)
"RTN","RGUTRPC",8,0)
 Q
"RTN","RGUTRPC",9,0)
 ; RPC: RGUTSTX
"RTN","RGUTRPC",10,0)
MSYNTAX(CIADATA,CIACODE,CIAOPT) ;
"RTN","RGUTRPC",11,0)
 S CIADATA=$$ENTRY^RGUTSTX(CIACODE,.CIAOPT)
"RTN","RGUTRPC",12,0)
 Q
"RTN","RGUTRPC",13,0)
 ; RPC: Return a group of entries from a file
"RTN","RGUTRPC",14,0)
 ; CIAFN   = File #
"RTN","RGUTRPC",15,0)
 ; CIAFROM = Starting entry (default is null)
"RTN","RGUTRPC",16,0)
 ; CIADIR  = Direction (default = 1)
"RTN","RGUTRPC",17,0)
 ; CIASCN  = Screening logic (optional)
"RTN","RGUTRPC",18,0)
 ; CIAMAX  = Maximum entries (default = 20)
"RTN","RGUTRPC",19,0)
 ; CIAXRF  = Cross reference (default = B)
"RTN","RGUTRPC",20,0)
FILGET(CIADATA,CIAFN,CIAFROM,CIADIR,CIASCN,CIAMAX,CIAXRF) ;
"RTN","RGUTRPC",21,0)
 N CIAIEN,CIAGBL,CIATOT,Y
"RTN","RGUTRPC",22,0)
 S CIAFROM=$G(CIAFROM),CIADIR=$S($G(CIADIR)<0:-1,1:1),CIAMAX=$G(CIAMAX,20),CIAXRF=$G(CIAXRF,"B"),CIASCN=$G(CIASCN),CIAGBL=$$ROOT^DILFD(CIAFN,,1),CIATOT=0
"RTN","RGUTRPC",23,0)
 Q:'$L(CIAGBL)
"RTN","RGUTRPC",24,0)
 F  Q:CIATOT'<CIAMAX  S CIAFROM=$O(@CIAGBL@(CIAXRF,CIAFROM),CIADIR),CIAIEN=0 Q:'$L(CIAFROM)  D
"RTN","RGUTRPC",25,0)
 .F  S CIAIEN=$O(@CIAGBL@(CIAXRF,CIAFROM,CIAIEN)) Q:'CIAIEN  D
"RTN","RGUTRPC",26,0)
 ..Q:'$D(@CIAGBL@(CIAIEN,0))
"RTN","RGUTRPC",27,0)
 ..I $L(CIASCN) S Y=CIAIEN X CIASCN E  Q
"RTN","RGUTRPC",28,0)
 ..S CIATOT=CIATOT+1,@CIADATA@(CIATOT)=CIAIEN_U_CIAFROM
"RTN","RGUTRPC",29,0)
 Q
"RTN","RGUTRPC",30,0)
 ; RPC: Show all or selected entries for a file
"RTN","RGUTRPC",31,0)
 ; CIAGBL = File # or closed global reference
"RTN","RGUTRPC",32,0)
 ; CIAIEN = Optional list of IENs to retrieve (default=ALL)
"RTN","RGUTRPC",33,0)
 ;          May be passed as single IEN or array with IENs as subscripts
"RTN","RGUTRPC",34,0)
FILENT(CIADATA,CIAGBL,CIAIEN) ;
"RTN","RGUTRPC",35,0)
 N CIAG,CIAX
"RTN","RGUTRPC",36,0)
 S:CIAGBL=+CIAGBL CIAGBL=$$ROOT^DILFD(CIAGBL,,1)
"RTN","RGUTRPC",37,0)
 S CIADATA=$$TMPGBL
"RTN","RGUTRPC",38,0)
 Q:'$L(CIAGBL)
"RTN","RGUTRPC",39,0)
 S:$G(CIAIEN) CIAIEN(+CIAIEN)=""
"RTN","RGUTRPC",40,0)
 S CIAG=$S($D(CIAIEN):"CIAIEN",1:CIAGBL),CIAIEN=0
"RTN","RGUTRPC",41,0)
 F  S CIAIEN=$O(@CIAG@(CIAIEN)) Q:'CIAIEN  D
"RTN","RGUTRPC",42,0)
 .S CIAX=$P($G(@CIAGBL@(CIAIEN,0)),U)
"RTN","RGUTRPC",43,0)
 .S:$L(CIAX) @CIADATA@(CIAIEN)=CIAIEN_U_CIAX
"RTN","RGUTRPC",44,0)
 Q
"RTN","RGUTRPC",45,0)
 ; RPC: Show IEN of next/previous entry in a file
"RTN","RGUTRPC",46,0)
FILNXT(CIADATA,CIAGBL,CIAIEN) ;
"RTN","RGUTRPC",47,0)
 N CIAD
"RTN","RGUTRPC",48,0)
 S:CIAGBL=+CIAGBL CIAGBL=$$ROOT^DILFD(CIAGBL,,1)
"RTN","RGUTRPC",49,0)
 I CIAIEN<0 S CIAIEN=-CIAIEN,CIAD=-1
"RTN","RGUTRPC",50,0)
 E  S CIAD=1
"RTN","RGUTRPC",51,0)
 S CIADATA=+$O(@CIAGBL@(CIAIEN),CIAD)
"RTN","RGUTRPC",52,0)
 Q
"RTN","RGUTRPC",53,0)
 ; RPC: Convert date input to FM format
"RTN","RGUTRPC",54,0)
STRTODAT(DATA,VAL,FMT) ;
"RTN","RGUTRPC",55,0)
 N %DT,X,Y
"RTN","RGUTRPC",56,0)
 I VAL'["@",VAL[" " S VAL=$TR(VAL," ","@")
"RTN","RGUTRPC",57,0)
 I VAL["@",$TR($P(VAL,"@",2),":0")="" S $P(VAL,"@",2)="00:00:01"
"RTN","RGUTRPC",58,0)
 S %DT=$G(FMT,"TS"),X=VAL
"RTN","RGUTRPC",59,0)
 D ^%DT
"RTN","RGUTRPC",60,0)
 S DATA=$S(Y>0:Y,1:"")
"RTN","RGUTRPC",61,0)
 Q
"RTN","RGUTRPC",62,0)
 ; Return reference to temp global
"RTN","RGUTRPC",63,0)
TMPGBL(X) ;EP
"RTN","RGUTRPC",64,0)
 K ^TMP("RGUTRPC"_$G(X),$J) Q $NA(^($J))
"RTN","RGUTRPC",65,0)
 ; Register/unregister RPCs within a given namespace to a context
"RTN","RGUTRPC",66,0)
REGNMSP(NMSP,CTX,DEL) ;EP
"RTN","RGUTRPC",67,0)
 N RPC,IEN,LEN
"RTN","RGUTRPC",68,0)
 S LEN=$L(NMSP),CTX=+$$GETOPT(CTX)
"RTN","RGUTRPC",69,0)
 I $G(DEL) D
"RTN","RGUTRPC",70,0)
 .S IEN=0
"RTN","RGUTRPC",71,0)
 .F  S IEN=$O(^DIC(19,CTX,"RPC","B",IEN)) Q:'IEN  D
"RTN","RGUTRPC",72,0)
 ..I $E($G(^XWB(8994,IEN,0)),1,LEN)=NMSP,$$REGRPC(IEN,CTX,1)
"RTN","RGUTRPC",73,0)
 E  D
"RTN","RGUTRPC",74,0)
 .Q:LEN<2
"RTN","RGUTRPC",75,0)
 .S RPC=NMSP
"RTN","RGUTRPC",76,0)
 .F  D:$L(RPC)  S RPC=$O(^XWB(8994,"B",RPC)) Q:NMSP'=$E(RPC,1,LEN)
"RTN","RGUTRPC",77,0)
 ..F IEN=0:0 S IEN=$O(^XWB(8994,"B",RPC,IEN)) Q:'IEN  I $$REGRPC(IEN,.CTX)
"RTN","RGUTRPC",78,0)
 Q
"RTN","RGUTRPC",79,0)
 ; Register/unregister an RPC to/from a context
"RTN","RGUTRPC",80,0)
 ; RPC = IEN or name of RPC
"RTN","RGUTRPC",81,0)
 ; CTX = IEN or name of context
"RTN","RGUTRPC",82,0)
 ; DEL = If nonzero, the RPC is unregistered (defaults to 0)
"RTN","RGUTRPC",83,0)
 ; Returns -1 if already registered; 0 if failed; 1 if succeeded
"RTN","RGUTRPC",84,0)
REGRPC(RPC,CTX,DEL) ;EP
"RTN","RGUTRPC",85,0)
 S RPC=+$$GETRPC(RPC)
"RTN","RGUTRPC",86,0)
 Q $S(RPC<1:0,1:$$REGMULT(19.05,"RPC",RPC,.CTX,.DEL))
"RTN","RGUTRPC",87,0)
 ; Add/remove a context to/from the ITEM multiple of another context.
"RTN","RGUTRPC",88,0)
REGCTX(SRC,DST,DEL) ;EP
"RTN","RGUTRPC",89,0)
 S SRC=+$$GETOPT(SRC)
"RTN","RGUTRPC",90,0)
 Q $S('SRC:0,1:$$REGMULT(19.01,10,SRC,.DST,.DEL))
"RTN","RGUTRPC",91,0)
 ; Add/delete an entry to/from a specified OPTION multiple.
"RTN","RGUTRPC",92,0)
 ; SFN = Subfile #
"RTN","RGUTRPC",93,0)
 ; NOD = Subnode for multiple
"RTN","RGUTRPC",94,0)
 ; ITM = Item IEN to add
"RTN","RGUTRPC",95,0)
 ; CTX = Option to add to
"RTN","RGUTRPC",96,0)
 ; DEL = Delete flag (optional)
"RTN","RGUTRPC",97,0)
REGMULT(SFN,NOD,ITM,CTX,DEL) ;
"RTN","RGUTRPC",98,0)
 N FDA,IEN
"RTN","RGUTRPC",99,0)
 S CTX=+$$GETOPT(CTX)
"RTN","RGUTRPC",100,0)
 S DEL=+$G(DEL)
"RTN","RGUTRPC",101,0)
 S IEN=+$O(^DIC(19,CTX,NOD,"B",ITM,0))
"RTN","RGUTRPC",102,0)
 Q:'IEN=DEL -1
"RTN","RGUTRPC",103,0)
 K ^TMP("DIERR",$J)
"RTN","RGUTRPC",104,0)
 I DEL S FDA(SFN,IEN_","_CTX_",",.01)="@"
"RTN","RGUTRPC",105,0)
 E  S FDA(SFN,"+1,"_CTX_",",.01)=ITM
"RTN","RGUTRPC",106,0)
 D UPDATE^DIE("","FDA")
"RTN","RGUTRPC",107,0)
 S FDA='$D(^TMP("DIERR",$J)) K ^($J)
"RTN","RGUTRPC",108,0)
 Q FDA
"RTN","RGUTRPC",109,0)
 ; Register a protocol to an extended action protocol
"RTN","RGUTRPC",110,0)
 ; Input: P-Parent protocol
"RTN","RGUTRPC",111,0)
 ;        C-Child protocol
"RTN","RGUTRPC",112,0)
REGPROT(P,C,ERR) ;EP
"RTN","RGUTRPC",113,0)
 N IENARY,PIEN,AIEN,FDA
"RTN","RGUTRPC",114,0)
 D
"RTN","RGUTRPC",115,0)
 .I '$L(P)!('$L(C)) S ERR="Missing input parameter" Q
"RTN","RGUTRPC",116,0)
 .S IENARY(1)=$$FIND1^DIC(101,"","",P)
"RTN","RGUTRPC",117,0)
 .S AIEN=$$FIND1^DIC(101,"","",C)
"RTN","RGUTRPC",118,0)
 .I 'IENARY(1)!'AIEN S ERR="Unknown protocol name" Q
"RTN","RGUTRPC",119,0)
 .S FDA(101.01,"?+2,"_IENARY(1)_",",.01)=AIEN
"RTN","RGUTRPC",120,0)
 .D UPDATE^DIE("S","FDA","IENARY","ERR")
"RTN","RGUTRPC",121,0)
 Q:$Q $G(ERR)=""
"RTN","RGUTRPC",122,0)
 Q
"RTN","RGUTRPC",123,0)
 ; Remove nonexistent RPCs from context
"RTN","RGUTRPC",124,0)
CLNRPC(CTX) ;EP
"RTN","RGUTRPC",125,0)
 N IEN
"RTN","RGUTRPC",126,0)
 S CTX=+$$GETOPT(CTX)
"RTN","RGUTRPC",127,0)
 F IEN=0:0 S IEN=$O(^DIC(19,CTX,"RPC","B",IEN)) Q:'IEN  D:'$D(^XWB(8994,IEN)) REGRPC(IEN,CTX,1)
"RTN","RGUTRPC",128,0)
 Q
"RTN","RGUTRPC",129,0)
 ; Return IEN of option
"RTN","RGUTRPC",130,0)
GETOPT(X) ;EP
"RTN","RGUTRPC",131,0)
 N Y
"RTN","RGUTRPC",132,0)
 Q:X=+X X
"RTN","RGUTRPC",133,0)
 S Y=$$FIND1^DIC(19,"","X",X)
"RTN","RGUTRPC",134,0)
 W:'Y "Cannot find option "_X,!!
"RTN","RGUTRPC",135,0)
 Q Y
"RTN","RGUTRPC",136,0)
 ; Return IEN of RPC
"RTN","RGUTRPC",137,0)
GETRPC(X) ;EP
"RTN","RGUTRPC",138,0)
 N Y
"RTN","RGUTRPC",139,0)
 Q:X=+X X
"RTN","RGUTRPC",140,0)
 S Y=$$FIND1^DIC(8994,"","X",X)
"RTN","RGUTRPC",141,0)
 W:'Y "Cannot find RPC "_X,!!
"RTN","RGUTRPC",142,0)
 Q Y
"RTN","RGUTRPRT")
0^63^B2852241
"RTN","RGUTRPRT",1,0)
RGUTRPRT ;RG/IND/DKM - Routine Pretty Print Program ;20-Jan-2015 13:23;DKM
"RTN","RGUTRPRT",2,0)
 ;;3.0;RG UTILITIES;;Mar 20, 2007;Build 98
"RTN","RGUTRPRT",3,0)
 ;;
"RTN","RGUTRPRT",4,0)
 ;=================================================================
"RTN","RGUTRPRT",5,0)
 N R,C,D,P,N,M,L,X,Y,B,W,Z,S,A,F,T,Q
"RTN","RGUTRPRT",6,0)
 D HOME^%ZIS,TITLE^RGUT("Routine Pretty Print")
"RTN","RGUTRPRT",7,0)
 X ^%ZOSF("RSEL")
"RTN","RGUTRPRT",8,0)
 I $O(^UTILITY($J,0))="" W "No routines selected.",!! K ^UTILITY($J) Q
"RTN","RGUTRPRT",9,0)
 D ^%ZIS
"RTN","RGUTRPRT",10,0)
 Q:POP
"RTN","RGUTRPRT",11,0)
 X ^%ZOSF("UCI")
"RTN","RGUTRPRT",12,0)
 S A=Y,R=0,C="     >>> ",W=IOM-$L(C)-1,M=$L(C)+1,B=$$UND^RGUT(W),T=$E(IOST,1,2)="C-",F=$S(T:IOF,1:""""""),Q=0
"RTN","RGUTRPRT",13,0)
 F  S R=$O(^UTILITY($J,R)) Q:R=""  D
"RTN","RGUTRPRT",14,0)
 .I IO'=IO(0) U IO(0) W !,"Printing "_R_"..."
"RTN","RGUTRPRT",15,0)
 .U IO
"RTN","RGUTRPRT",16,0)
 .S D=$$ENTRY^RGUTDT($H),P=0,$Y=IOSL,S=0
"RTN","RGUTRPRT",17,0)
 .X "ZL @R F N=1:1 S L=$T(+N) Q:'$L(L)  S ^UTILITY($J,R,N)=L,S=S+$L(L)+2"
"RTN","RGUTRPRT",18,0)
 .S S="("_$$FMTNUM^RGUT(S)_" bytes)"
"RTN","RGUTRPRT",19,0)
 .F N=0:0 S N=$O(^UTILITY($J,R,N)) Q:'N  D  Q:Q
"RTN","RGUTRPRT",20,0)
 ..S L=^(N),X=$P(L," "),L=X_$E("        ",$L(X)+1,8)_" "_$P(L," ",2,999),Z=""
"RTN","RGUTRPRT",21,0)
 ..F  Q:L=""!Q  D
"RTN","RGUTRPRT",22,0)
 ...S X=$E(L,1,W),L=$E(L,W+1,999)
"RTN","RGUTRPRT",23,0)
 ...D:IOSL-2<$Y HDR
"RTN","RGUTRPRT",24,0)
 ...Q:Q
"RTN","RGUTRPRT",25,0)
 ...W Z,?M,X,!
"RTN","RGUTRPRT",26,0)
 ...S Z=C
"RTN","RGUTRPRT",27,0)
 K ^UTILITY($J)
"RTN","RGUTRPRT",28,0)
 D ^%ZISC
"RTN","RGUTRPRT",29,0)
 Q
"RTN","RGUTRPRT",30,0)
HDR I P,T R "Press enter to continue...",Q:$G(DTIME,300) S Q=Q["^"!'$T Q:Q
"RTN","RGUTRPRT",31,0)
 S P=P+1,$Y=0
"RTN","RGUTRPRT",32,0)
 W @F,!?M,A,$$CTR(R),$$RJ("Page "_P),!
"RTN","RGUTRPRT",33,0)
 W ?M,$G(^DD("SITE")),$$CTR(S),$$RJ(D),!
"RTN","RGUTRPRT",34,0)
 W ?M,B,!!
"RTN","RGUTRPRT",35,0)
 S:P=1 F=IOF
"RTN","RGUTRPRT",36,0)
 Q
"RTN","RGUTRPRT",37,0)
CTR(X) W ?(IOM-$L(X)\2+M),X
"RTN","RGUTRPRT",38,0)
 Q ""
"RTN","RGUTRPRT",39,0)
RJ(X) W ?(IOM-$L(X)),X
"RTN","RGUTRPRT",40,0)
 Q ""
"RTN","RGUTSTX")
0^27^B18037383
"RTN","RGUTSTX",1,0)
RGUTSTX ;RG/IND/DKM - M syntax analyzer;04-May-2006 08:19;DKM
"RTN","RGUTSTX",2,0)
 ;;3.0;RG UTILITIES;;Mar 20, 2007;Build 98
"RTN","RGUTSTX",3,0)
 ;;
"RTN","RGUTSTX",4,0)
 ;=================================================================
"RTN","RGUTSTX",5,0)
 ; Perform syntactic analysis of a line of M code.
"RTN","RGUTSTX",6,0)
 ; Inputs:
"RTN","RGUTSTX",7,0)
 ;   CIAM = M statement(s)
"RTN","RGUTSTX",8,0)
 ;   CIAO = Options:
"RTN","RGUTSTX",9,0)
 ;      L = Line label allowed
"RTN","RGUTSTX",10,0)
 ;      . = Dotted syntax allowed
"RTN","RGUTSTX",11,0)
 ;      N = Do not init parsing tables
"RTN","RGUTSTX",12,0)
 ;      D = Do not delete parsing tables
"RTN","RGUTSTX",13,0)
 ;      Z = Process all Z-extensions as valid
"RTN","RGUTSTX",14,0)
 ; Outputs:
"RTN","RGUTSTX",15,0)
 ;   Returns 0 if successfully parsed.  Otherwise returns E^P^M
"RTN","RGUTSTX",16,0)
 ;   where E is an error code (see ERRORS label), P is the
"RTN","RGUTSTX",17,0)
 ;   character position where the error occurred, and M is the
"RTN","RGUTSTX",18,0)
 ;   error message.
"RTN","RGUTSTX",19,0)
 ;=================================================================
"RTN","RGUTSTX",20,0)
ENTRY(CIAM,CIAO) ;
"RTN","RGUTSTX",21,0)
 N CIAPSN,CIALEN,CIAERR,CIARN,CIAQT,CIAF,CIAPID,CIACMD
"RTN","RGUTSTX",22,0)
 S CIAM=$$UP^XLFSTR(CIAM),CIAO=$$UP^XLFSTR($G(CIAO)),CIAPSN=1,CIALEN=$L(CIAM),CIAERR=0,CIAQT="""",CIAF=0,CIAPID="RGUTSTX",U="^"
"RTN","RGUTSTX",23,0)
 D LOAD:CIAO'["N",PARSE:CIALEN
"RTN","RGUTSTX",24,0)
 K:CIAO'["D" ^TMP(CIAPID,$J)
"RTN","RGUTSTX",25,0)
 Q $S(CIAERR:CIAERR_U_$S(CIAPSN>CIALEN:CIALEN,1:CIAPSN)_U_$S(CIAERR<0:$$EC^%ZOSV,1:$P($T(ERRORS+CIAERR),";;",2)),1:0)
"RTN","RGUTSTX",26,0)
PARSE N CIAZ,CIAZ1
"RTN","RGUTSTX",27,0)
 S @$$TRAP^RGUTOS("ERROR^RGUTSTX")
"RTN","RGUTSTX",28,0)
 I CIAO["L" D  Q:CIAERR
"RTN","RGUTSTX",29,0)
 .S:$E(CIAM)'=" " CIAPSN=$$LABEL^RGUTSTX0
"RTN","RGUTSTX",30,0)
 .I $$NEXT^RGUTSTX0("("),'$$NEXT^RGUTSTX0(")") D
"RTN","RGUTSTX",31,0)
 ..F CIAPSN=CIAPSN:1 D  Q:$E(CIAM,CIAPSN)'=","!CIAERR
"RTN","RGUTSTX",32,0)
 ...S CIAPSN=$$NAME^RGUTSTX0(CIAPSN,"L%")
"RTN","RGUTSTX",33,0)
 ..Q:CIAERR
"RTN","RGUTSTX",34,0)
 ..S:'$$NEXT^RGUTSTX0(")") CIAERR=3
"RTN","RGUTSTX",35,0)
 .S:" "'[$E(CIAM,CIAPSN) CIAERR=2
"RTN","RGUTSTX",36,0)
 I CIAO["." F CIAPSN=CIAPSN:1:CIALEN+1 Q:". "'[$E(CIAM,CIAPSN)
"RTN","RGUTSTX",37,0)
 F  Q:CIAERR  D SKPSPC Q:";"[$E(CIAM,CIAPSN)  D
"RTN","RGUTSTX",38,0)
 .S CIACMD=""
"RTN","RGUTSTX",39,0)
 .F CIAPSN=CIAPSN:1 S CIAZ=$E(CIAM,CIAPSN) Q:CIAZ'?1A  S CIACMD=CIACMD_CIAZ
"RTN","RGUTSTX",40,0)
 .I CIACMD="" S CIAERR=4 Q
"RTN","RGUTSTX",41,0)
 .I $D(^TMP(CIAPID,$J,"CMD",CIACMD)) S CIACMD=^(CIACMD)
"RTN","RGUTSTX",42,0)
 .E  I CIAO["Z" S CIACMD="PC;OPT;ARGS("":M"")"
"RTN","RGUTSTX",43,0)
 .E  S CIAERR=4 Q
"RTN","RGUTSTX",44,0)
 .F CIARN=1:1:$L(CIACMD,";") D CMD^RGUTSTX0($P(CIACMD,";",CIARN)) Q:CIAERR!'CIARN
"RTN","RGUTSTX",45,0)
 .I 'CIAERR," "'[$E(CIAM,CIAPSN) S CIAERR=2
"RTN","RGUTSTX",46,0)
 .E  S CIAPSN=CIAPSN+1
"RTN","RGUTSTX",47,0)
 Q
"RTN","RGUTSTX",48,0)
 ; Skip over blanks
"RTN","RGUTSTX",49,0)
SKPSPC F  Q:'$$NEXT^RGUTSTX0(" ")
"RTN","RGUTSTX",50,0)
 Q
"RTN","RGUTSTX",51,0)
 ; Load tables
"RTN","RGUTSTX",52,0)
LOAD N CIAZ,CIAZ1,CIAZ2,CIAL
"RTN","RGUTSTX",53,0)
 K ^TMP(CIAPID,$J)
"RTN","RGUTSTX",54,0)
 F CIAL="CMD","FCN","SYS" D
"RTN","RGUTSTX",55,0)
 .F CIAZ=1:1 S CIAZ1=$P($T(@CIAL+CIAZ),";;",2,999) Q:CIAZ1=""  D
"RTN","RGUTSTX",56,0)
 ..S CIAZ2=$P(CIAZ1,";"),CIAZ1=$P(CIAZ1,";",2,999)
"RTN","RGUTSTX",57,0)
 ..F  Q:CIAZ2=""  D
"RTN","RGUTSTX",58,0)
 ...S ^TMP(CIAPID,$J,CIAL,$P(CIAZ2,","))=CIAZ1,CIAZ2=$P(CIAZ2,",",2,999)
"RTN","RGUTSTX",59,0)
 Q
"RTN","RGUTSTX",60,0)
ERROR S CIAERR=-1
"RTN","RGUTSTX",61,0)
 Q
"RTN","RGUTSTX",62,0)
CMD ;;*Commands*
"RTN","RGUTSTX",63,0)
 ;;B,BREAK;PC;OPT;ARGS()
"RTN","RGUTSTX",64,0)
 ;;C,CLOSE;PC;ARGS(":M")
"RTN","RGUTSTX",65,0)
 ;;D,DO;PC;OPT;LBL(2)
"RTN","RGUTSTX",66,0)
 ;;E,ELSE;NPC;OPT;ARGS()
"RTN","RGUTSTX",67,0)
 ;;F,FOR;NPC;OPT;FOR
"RTN","RGUTSTX",68,0)
 ;;G,GOTO;PC;LBL(1)
"RTN","RGUTSTX",69,0)
 ;;H,HALT,HANG;PC;OPT;EXP()
"RTN","RGUTSTX",70,0)
 ;;I,IF;NPC;OPT;ARGS()
"RTN","RGUTSTX",71,0)
 ;;J,JOB;PC;LBL(2)
"RTN","RGUTSTX",72,0)
 ;;K,KILL;PC;OPT;KILL
"RTN","RGUTSTX",73,0)
 ;;L,LOCK;PC;OPT;LOCK
"RTN","RGUTSTX",74,0)
 ;;M,MERGE;PC;MERGE
"RTN","RGUTSTX",75,0)
 ;;N,NEW;PC;OPT;NEW
"RTN","RGUTSTX",76,0)
 ;;O,OPEN;PC;ARGS(":M")
"RTN","RGUTSTX",77,0)
 ;;Q,QUIT;PC;OPT;EXP()
"RTN","RGUTSTX",78,0)
 ;;R,READ;PC;READ
"RTN","RGUTSTX",79,0)
 ;;S,SET;PC;SET
"RTN","RGUTSTX",80,0)
 ;;U,USE;PC;ARGS(":M")
"RTN","RGUTSTX",81,0)
 ;;V,VIEW;PC;ARGS(":M")
"RTN","RGUTSTX",82,0)
 ;;W,WRITE;PC;WRITE
"RTN","RGUTSTX",83,0)
 ;;X,XECUTE;PC;ARGS(":")
"RTN","RGUTSTX",84,0)
 ;;ZT,ZTRAP;PC;OPT;EXP()
"RTN","RGUTSTX",85,0)
 ;;ZS,ZSAVE;PC;OPT;EXP()
"RTN","RGUTSTX",86,0)
 ;;ZR,ZREMOVE;PC;OPT;LBL(1)
"RTN","RGUTSTX",87,0)
 ;;ZP,ZPRINT
"RTN","RGUTSTX",88,0)
 ;;
"RTN","RGUTSTX",89,0)
FCN ;;*Intrinsic functions*
"RTN","RGUTSTX",90,0)
 ;;A,ASCII;;1-2
"RTN","RGUTSTX",91,0)
 ;;C,CHAR;;1-999
"RTN","RGUTSTX",92,0)
 ;;D,DATA;;1-1;V
"RTN","RGUTSTX",93,0)
 ;;E,EXTRACT;S;1-3
"RTN","RGUTSTX",94,0)
 ;;F,FIND;;2-3
"RTN","RGUTSTX",95,0)
 ;;FN,FNUMBER;;2-3
"RTN","RGUTSTX",96,0)
 ;;G,GET;;1-2;V
"RTN","RGUTSTX",97,0)
 ;;J,JUSTIFY;;1-3
"RTN","RGUTSTX",98,0)
 ;;L,LENGTH;;1-2
"RTN","RGUTSTX",99,0)
 ;;N,NEXT;;1-2
"RTN","RGUTSTX",100,0)
 ;;NA,NAME;;1-2;V
"RTN","RGUTSTX",101,0)
 ;;O,ORDER;;1-2;V
"RTN","RGUTSTX",102,0)
 ;;P,PIECE;S;2-4
"RTN","RGUTSTX",103,0)
 ;;Q,QUERY;;1-2;V
"RTN","RGUTSTX",104,0)
 ;;R,RANDOM;;1-1
"RTN","RGUTSTX",105,0)
 ;;S,SELECT;:;1-999
"RTN","RGUTSTX",106,0)
 ;;T,TEXT;;1-1;L
"RTN","RGUTSTX",107,0)
 ;;TR,TRANSLATE;;2-3
"RTN","RGUTSTX",108,0)
 ;;V,VIEW;;1-999
"RTN","RGUTSTX",109,0)
 ;;
"RTN","RGUTSTX",110,0)
SYS ;;*System variables*
"RTN","RGUTSTX",111,0)
 ;;D,DEVICE
"RTN","RGUTSTX",112,0)
 ;;ET,ETRAP;SN
"RTN","RGUTSTX",113,0)
 ;;H,HOROLOG
"RTN","RGUTSTX",114,0)
 ;;I,IO
"RTN","RGUTSTX",115,0)
 ;;J,JOB
"RTN","RGUTSTX",116,0)
 ;;K,KEY
"RTN","RGUTSTX",117,0)
 ;;P,PRINCIPAL
"RTN","RGUTSTX",118,0)
 ;;S,STORAGE
"RTN","RGUTSTX",119,0)
 ;;SY,SYSTEM
"RTN","RGUTSTX",120,0)
 ;;T,TEST
"RTN","RGUTSTX",121,0)
 ;;TL,TLEVEL
"RTN","RGUTSTX",122,0)
 ;;TR,TRESTART
"RTN","RGUTSTX",123,0)
 ;;X;S
"RTN","RGUTSTX",124,0)
 ;;Y;S
"RTN","RGUTSTX",125,0)
 ;;ZT,ZTRAP;S
"RTN","RGUTSTX",126,0)
 ;;ZE,ZERROR;S
"RTN","RGUTSTX",127,0)
 ;;ES,ESTACK;N
"RTN","RGUTSTX",128,0)
 ;;EC,ECODE;S
"RTN","RGUTSTX",129,0)
ERRORS ;;*Error messages*
"RTN","RGUTSTX",130,0)
 ;;Bad variable name
"RTN","RGUTSTX",131,0)
 ;;Syntax error
"RTN","RGUTSTX",132,0)
 ;;Unbalanced parentheses
"RTN","RGUTSTX",133,0)
 ;;Unrecognized command
"RTN","RGUTSTX",134,0)
 ;;Postconditional not allowed
"RTN","RGUTSTX",135,0)
 ;;Missing operand
"RTN","RGUTSTX",136,0)
 ;;Unrecognized intrinsic function/variable
"RTN","RGUTSTX",137,0)
 ;;Incorrect number of arguments
"RTN","RGUTSTX",138,0)
 ;;Missing closing quote
"RTN","RGUTSTX",139,0)
 ;;Illegal pattern
"RTN","RGUTSTX",140,0)
 ;;Bad label name
"RTN","RGUTSTX",141,0)
 ;;Name too long
"RTN","RGUTSTX",142,0)
 ;;13
"RTN","RGUTSTX0")
0^28^B19756996
"RTN","RGUTSTX0",1,0)
RGUTSTX0 ;RG/IND/DKM - Continuation of RGUTSTX;04-May-2006 08:19;DKM
"RTN","RGUTSTX0",2,0)
 ;;3.0;RG UTILITIES;;Mar 20, 2007;Build 98
"RTN","RGUTSTX0",3,0)
 ;;
"RTN","RGUTSTX0",4,0)
 ;=================================================================
"RTN","RGUTSTX0",5,0)
CMD(CIALBL) ;
"RTN","RGUTSTX0",6,0)
 D:CIALBL'="" @CIALBL
"RTN","RGUTSTX0",7,0)
 Q
"RTN","RGUTSTX0",8,0)
 ; Postconditional
"RTN","RGUTSTX0",9,0)
PC D:$$NEXT(":") EXP()
"RTN","RGUTSTX0",10,0)
 Q:CIAERR
"RTN","RGUTSTX0",11,0)
 I " "'[$E(CIAM,CIAPSN) S CIAERR=2
"RTN","RGUTSTX0",12,0)
 E  S CIAPSN=CIAPSN+1
"RTN","RGUTSTX0",13,0)
 Q
"RTN","RGUTSTX0",14,0)
 ; No postconditional
"RTN","RGUTSTX0",15,0)
NPC I $$NEXT(":") S CIAERR=5
"RTN","RGUTSTX0",16,0)
 E  I " "'[$E(CIAM,CIAPSN) S CIAERR=2
"RTN","RGUTSTX0",17,0)
 E  S CIAPSN=CIAPSN+1
"RTN","RGUTSTX0",18,0)
 Q
"RTN","RGUTSTX0",19,0)
 ; Arguments optional
"RTN","RGUTSTX0",20,0)
OPT S:" "[$E(CIAM,CIAPSN) CIARN=0
"RTN","RGUTSTX0",21,0)
 Q
"RTN","RGUTSTX0",22,0)
 ; Multiple arguments
"RTN","RGUTSTX0",23,0)
ARGS(CIAEX) ;
"RTN","RGUTSTX0",24,0)
 S CIAEX=$G(CIAEX)
"RTN","RGUTSTX0",25,0)
 F  D EXP(CIAEX) Q:CIAERR!'$$NEXT(",")
"RTN","RGUTSTX0",26,0)
 Q
"RTN","RGUTSTX0",27,0)
 ; Expression
"RTN","RGUTSTX0",28,0)
EXP(CIAEX) ;
"RTN","RGUTSTX0",29,0)
 D EXP^RGUTSTX1(.CIAEX)
"RTN","RGUTSTX0",30,0)
 Q
"RTN","RGUTSTX0",31,0)
 ; Label reference
"RTN","RGUTSTX0",32,0)
LBL(CIAA) F  D LBL1(.CIAA) Q:CIAERR!'$$NEXT(",")
"RTN","RGUTSTX0",33,0)
 Q
"RTN","RGUTSTX0",34,0)
LBL1(CIAA) ;
"RTN","RGUTSTX0",35,0)
 S CIAA=+$G(CIAA)
"RTN","RGUTSTX0",36,0)
 D LBL2
"RTN","RGUTSTX0",37,0)
 Q:CIAERR
"RTN","RGUTSTX0",38,0)
 D:$$NEXT("+") EXP(")")
"RTN","RGUTSTX0",39,0)
 Q:CIAERR
"RTN","RGUTSTX0",40,0)
 D:$$NEXT(U) LBL2
"RTN","RGUTSTX0",41,0)
 I 'CIAERR,CIAA=2 D PARAMS(".;0-999")
"RTN","RGUTSTX0",42,0)
 I 'CIAERR,CIAA D EXP(")"):$$NEXT(":")
"RTN","RGUTSTX0",43,0)
 Q
"RTN","RGUTSTX0",44,0)
LBL2 I $$NEXT("@") D
"RTN","RGUTSTX0",45,0)
 .D EXP("=")
"RTN","RGUTSTX0",46,0)
 E  S:$E(CIAM,CIAPSN)?.1AN.1"%" CIAPSN=$$LABEL
"RTN","RGUTSTX0",47,0)
 Q
"RTN","RGUTSTX0",48,0)
 ; Write command
"RTN","RGUTSTX0",49,0)
WRITE F  D  Q:CIAERR!'$$NEXT(",")
"RTN","RGUTSTX0",50,0)
 .I $$NEXT("!#") D  Q:'$$NEXT("?",0)
"RTN","RGUTSTX0",51,0)
 ..F  Q:'$$NEXT("!#")
"RTN","RGUTSTX0",52,0)
 .I $$NEXT("?*")
"RTN","RGUTSTX0",53,0)
 .D EXP()
"RTN","RGUTSTX0",54,0)
 Q
"RTN","RGUTSTX0",55,0)
 ; Read command
"RTN","RGUTSTX0",56,0)
READ N CIAZ
"RTN","RGUTSTX0",57,0)
 F  D  Q:CIAERR!'$$NEXT(",")
"RTN","RGUTSTX0",58,0)
 .I $$NEXT("!#") D  Q:'$$NEXT("?",0)
"RTN","RGUTSTX0",59,0)
 ..F  Q:'$$NEXT("!#")
"RTN","RGUTSTX0",60,0)
 .I $$NEXT("?") D EXP() Q
"RTN","RGUTSTX0",61,0)
 .I $$NEXT(CIAQT) D QT2^RGUTSTX1 Q
"RTN","RGUTSTX0",62,0)
 .S CIAZ=$$NEXT("*")
"RTN","RGUTSTX0",63,0)
 .D LVAL("LGS")
"RTN","RGUTSTX0",64,0)
 .I 'CIAERR,'CIAZ,$$NEXT("#") D EXP()
"RTN","RGUTSTX0",65,0)
 .I 'CIAERR,$$NEXT(":") D EXP()
"RTN","RGUTSTX0",66,0)
 Q
"RTN","RGUTSTX0",67,0)
 ; Lock command
"RTN","RGUTSTX0",68,0)
LOCK D LIST("LG+:","LG")
"RTN","RGUTSTX0",69,0)
 Q
"RTN","RGUTSTX0",70,0)
 ; Set command
"RTN","RGUTSTX0",71,0)
SET D LIST("LGS=","LGS")
"RTN","RGUTSTX0",72,0)
 Q
"RTN","RGUTSTX0",73,0)
 ; New command
"RTN","RGUTSTX0",74,0)
NEW D LIST("N","")
"RTN","RGUTSTX0",75,0)
 Q
"RTN","RGUTSTX0",76,0)
 ; Kill command
"RTN","RGUTSTX0",77,0)
KILL D LIST("KGL","")
"RTN","RGUTSTX0",78,0)
 Q
"RTN","RGUTSTX0",79,0)
 ; Merge command
"RTN","RGUTSTX0",80,0)
MERGE D LIST("LG=")
"RTN","RGUTSTX0",81,0)
 Q
"RTN","RGUTSTX0",82,0)
 ; For command
"RTN","RGUTSTX0",83,0)
FOR D LVAL("LGS")
"RTN","RGUTSTX0",84,0)
 I '$$NEXT("=") S CIAERR=2 Q
"RTN","RGUTSTX0",85,0)
 F  D  Q:" "[$E(CIAM,CIAPSN)  I '$$NEXT(",") S CIAERR=2 Q
"RTN","RGUTSTX0",86,0)
 .D EXP(),EXP():$$NEXT(":"),EXP():$$NEXT(":")
"RTN","RGUTSTX0",87,0)
 Q
"RTN","RGUTSTX0",88,0)
 ; Evaluate L-value
"RTN","RGUTSTX0",89,0)
 ; CIAL: Allowed types:
"RTN","RGUTSTX0",90,0)
 ;     L=Local array
"RTN","RGUTSTX0",91,0)
 ;     G=Global arrays
"RTN","RGUTSTX0",92,0)
 ;     S=Settable intrinsics/system variables
"RTN","RGUTSTX0",93,0)
 ;     N=Newable system variables
"RTN","RGUTSTX0",94,0)
 ;     K=Killable system variables
"RTN","RGUTSTX0",95,0)
LVAL(CIAL) ;
"RTN","RGUTSTX0",96,0)
 I $$NEXT("@",0) D  Q
"RTN","RGUTSTX0",97,0)
 .S CIAL="="
"RTN","RGUTSTX0",98,0)
 .D EXP(.CIAL)
"RTN","RGUTSTX0",99,0)
 S CIAL=$G(CIAL)
"RTN","RGUTSTX0",100,0)
 I CIAL["G",$$NEXT(U) D  Q
"RTN","RGUTSTX0",101,0)
 .N CIAF
"RTN","RGUTSTX0",102,0)
 .D GLBL^RGUTSTX1
"RTN","RGUTSTX0",103,0)
 I $TR(CIAL,"SNK")'=CIAL,$$NEXT("$") D  Q
"RTN","RGUTSTX0",104,0)
 .N CIAZ
"RTN","RGUTSTX0",105,0)
 .S CIAZ=$$INT(.CIAPSN,CIAL)
"RTN","RGUTSTX0",106,0)
 .D:'CIAERR PARAMS(CIAZ)
"RTN","RGUTSTX0",107,0)
 S CIAPSN=$$NAME(CIAPSN,"%")
"RTN","RGUTSTX0",108,0)
 I 'CIAERR,CIAL["L" D PARAMS()
"RTN","RGUTSTX0",109,0)
 Q
"RTN","RGUTSTX0",110,0)
 ; Evaluate parameters/subscripts
"RTN","RGUTSTX0",111,0)
PARAMS(CIAX) ;
"RTN","RGUTSTX0",112,0)
 D:$$NEXT("(") PLIST^RGUTSTX1(.CIAX)
"RTN","RGUTSTX0",113,0)
 Q
"RTN","RGUTSTX0",114,0)
 ; New/Kill/Set/Lock argument list
"RTN","RGUTSTX0",115,0)
LIST(CIAL1,CIAL2) ;
"RTN","RGUTSTX0",116,0)
 N CIAP,CIAI
"RTN","RGUTSTX0",117,0)
 S CIAP=0
"RTN","RGUTSTX0",118,0)
 F  D  Q:CIAERR!'$$NEXT(",")
"RTN","RGUTSTX0",119,0)
 .I 'CIAP,CIAL1["+",$$NEXT("+-")
"RTN","RGUTSTX0",120,0)
 .I $D(CIAL2),$$NEXT("(") D  Q:CIAERR
"RTN","RGUTSTX0",121,0)
 ..I CIAP S CIAERR=2 Q
"RTN","RGUTSTX0",122,0)
 ..E  S CIAP=1
"RTN","RGUTSTX0",123,0)
 .S CIAI=$S(CIAP:CIAL2,1:CIAL1)
"RTN","RGUTSTX0",124,0)
 .D LVAL(.CIAI)
"RTN","RGUTSTX0",125,0)
 .Q:CIAERR
"RTN","RGUTSTX0",126,0)
 .I $$NEXT(")") D  Q:CIAERR
"RTN","RGUTSTX0",127,0)
 ..I CIAP S CIAP=0
"RTN","RGUTSTX0",128,0)
 ..E  S CIAERR=2
"RTN","RGUTSTX0",129,0)
 .I 'CIAP,CIAL1[":",$$NEXT(":") D EXP()
"RTN","RGUTSTX0",130,0)
 .I 'CIAP,CIAL1["=" D
"RTN","RGUTSTX0",131,0)
 ..I '$$NEXT("=") S:CIAI'["@" CIAERR=2
"RTN","RGUTSTX0",132,0)
 ..E  D EXP():$D(CIAL2),LVAL(CIAL1):'$D(CIAL2)
"RTN","RGUTSTX0",133,0)
 I 'CIAERR,CIAP S CIAERR=3
"RTN","RGUTSTX0",134,0)
 Q
"RTN","RGUTSTX0",135,0)
 ; Check for validity of label name
"RTN","RGUTSTX0",136,0)
LABEL(CIAP) ;
"RTN","RGUTSTX0",137,0)
 Q $$NAME(.CIAP,"L%")
"RTN","RGUTSTX0",138,0)
 ; Check for validity of variable/label name
"RTN","RGUTSTX0",139,0)
NAME(CIAP,CIAF) ;
"RTN","RGUTSTX0",140,0)
 N CIAP1
"RTN","RGUTSTX0",141,0)
 S (CIAP,CIAP1)=$G(CIAP,CIAPSN),CIAF=$G(CIAF)
"RTN","RGUTSTX0",142,0)
 I CIAF["$",$E(CIAM,CIAP)="$" S CIAP=CIAP+1,CIAP1=CIAP
"RTN","RGUTSTX0",143,0)
 I CIAF["%",$E(CIAM,CIAP)="%" S CIAP=CIAP+1
"RTN","RGUTSTX0",144,0)
 F CIAP=CIAP:1 Q:$E(CIAM,CIAP)'?@$S(CIAF["L":"1AN",CIAP=CIAP1:"1A",1:"1AN")
"RTN","RGUTSTX0",145,0)
 I CIAP=CIAP1 S CIAERR=$S(CIAF["L":11,1:1)
"RTN","RGUTSTX0",146,0)
 E  S:CIAP-CIAP1>8 CIAERR=12
"RTN","RGUTSTX0",147,0)
 Q CIAP
"RTN","RGUTSTX0",148,0)
 ; Instrinsic function/system variable
"RTN","RGUTSTX0",149,0)
INT(CIAP,CIAL) ;
"RTN","RGUTSTX0",150,0)
 N CIAP2,CIAINT,CIANM
"RTN","RGUTSTX0",151,0)
 S CIAP=$G(CIAP,CIAPSN),CIAP2=$$NAME(CIAP),CIAL=$G(CIAL)
"RTN","RGUTSTX0",152,0)
 Q:CIAERR ""
"RTN","RGUTSTX0",153,0)
 S CIANM=$E(CIAM,CIAP,CIAP2-1)
"RTN","RGUTSTX0",154,0)
 I $E(CIAM,CIAP2)="(" S:$D(^TMP(CIAPID,$J,"FCN",CIANM)) CIAINT=^(CIANM)
"RTN","RGUTSTX0",155,0)
 E  S:$D(^TMP(CIAPID,$J,"SYS",CIANM)) CIAINT=^(CIANM)
"RTN","RGUTSTX0",156,0)
 I '$D(CIAINT),CIAO["Z" S CIAINT=";0-999"
"RTN","RGUTSTX0",157,0)
 I '$D(CIAINT) S CIAERR=7
"RTN","RGUTSTX0",158,0)
 E  I CIAL'="",$TR(CIAL,$P(CIAINT,";"))=CIAL S CIAERR=2,CIAINT=""
"RTN","RGUTSTX0",159,0)
 E  S CIAP=CIAP2
"RTN","RGUTSTX0",160,0)
 Q $G(CIAINT)
"RTN","RGUTSTX0",161,0)
 ; Check next character
"RTN","RGUTSTX0",162,0)
NEXT(CIAC,CIAI) ;
"RTN","RGUTSTX0",163,0)
 I CIAPSN'>CIALEN,CIAC[$E(CIAM,CIAPSN) S CIAPSN=CIAPSN+$G(CIAI,1)
"RTN","RGUTSTX0",164,0)
 Q $T
"RTN","RGUTSTX1")
0^29^B21990330
"RTN","RGUTSTX1",1,0)
RGUTSTX1 ;RG/IND/DKM - Continuation of RGUTSTX;04-May-2006 08:19;DKM
"RTN","RGUTSTX1",2,0)
 ;;3.0;RG UTILITIES;;Mar 20, 2007;Build 98
"RTN","RGUTSTX1",3,0)
 ;;
"RTN","RGUTSTX1",4,0)
 ;=================================================================
"RTN","RGUTSTX1",5,0)
 ; Parse an expression
"RTN","RGUTSTX1",6,0)
EXP(CIAEX) ;
"RTN","RGUTSTX1",7,0)
 N CIAF,CIAC,CIAPN
"RTN","RGUTSTX1",8,0)
 S (CIAF,CIAPN)=0,CIAEX=$G(CIAEX)
"RTN","RGUTSTX1",9,0)
 F  D  Q:CIAF<0!CIAERR
"RTN","RGUTSTX1",10,0)
 .S CIAC=$E(CIAM,CIAPSN),CIAPSN=CIAPSN+1
"RTN","RGUTSTX1",11,0)
 .D @("OP"_CIAF)
"RTN","RGUTSTX1",12,0)
 I 'CIAERR,CIAPN S CIAERR=3
"RTN","RGUTSTX1",13,0)
 S CIAEX=$S($G(CIAPN(CIAPN,"@")):"@",1:"")_CIAEX
"RTN","RGUTSTX1",14,0)
 Q
"RTN","RGUTSTX1",15,0)
 ; Operands
"RTN","RGUTSTX1",16,0)
OP0 I CIAC'=".",CIAEX["." S CIAEX=$TR(CIAEX,".")
"RTN","RGUTSTX1",17,0)
 G:CIAC'="" COLON2:CIAC=":",GLBL:CIAC=U,DOT:CIAC=".",INDIR:CIAC="@",FCN:CIAC="$",UNARY:"'+-"[CIAC,QT:CIAC=CIAQT,NUM:CIAC?1N,OPNPAR:CIAC="(",VAR:CIAC?1A,VAR:CIAC="%"
"RTN","RGUTSTX1",18,0)
 S CIAERR=6
"RTN","RGUTSTX1",19,0)
 Q
"RTN","RGUTSTX1",20,0)
 ; Operators
"RTN","RGUTSTX1",21,0)
OP1 G END:CIAC="",INDIR2:CIAC="@",DONE:CIAEX["="&'CIAPN!(CIAC=" ")
"RTN","RGUTSTX1",22,0)
 K CIAPN(CIAPN,"@")
"RTN","RGUTSTX1",23,0)
 I CIAC="*",$$NEXT(CIAC)
"RTN","RGUTSTX1",24,0)
 G COLON:CIAC=":",CLSPAR:CIAC=")",RBRKT:CIAC="]",BINARY:"!#&*-_+=\/<>["[CIAC,NOT:CIAC="'",PTRN:CIAC="?"
"RTN","RGUTSTX1",25,0)
DONE S CIAPSN=CIAPSN-1
"RTN","RGUTSTX1",26,0)
END S CIAF=-1
"RTN","RGUTSTX1",27,0)
 Q
"RTN","RGUTSTX1",28,0)
 ; Negated operator
"RTN","RGUTSTX1",29,0)
NOT S:'$$NEXT("=<>[]?&!",0) CIAERR=2
"RTN","RGUTSTX1",30,0)
 Q
"RTN","RGUTSTX1",31,0)
 ; Parse a global reference
"RTN","RGUTSTX1",32,0)
GLBL D:$$NEXT("[") PLIST(";1-2","]")
"RTN","RGUTSTX1",33,0)
 Q:CIAERR
"RTN","RGUTSTX1",34,0)
 S:'$$NEXT("(",0) CIAPSN=$$NAME^RGUTSTX0(CIAPSN,"$%")
"RTN","RGUTSTX1",35,0)
 I 'CIAERR,$$NEXT("(") D PLIST(";1-999")
"RTN","RGUTSTX1",36,0)
 S CIAF=1
"RTN","RGUTSTX1",37,0)
 Q
"RTN","RGUTSTX1",38,0)
 ; Indirection (prefix)
"RTN","RGUTSTX1",39,0)
INDIR S CIAPN(CIAPN,"@")=$G(CIAPN(CIAPN,"@"))+1
"RTN","RGUTSTX1",40,0)
 Q
"RTN","RGUTSTX1",41,0)
 ; Indirection (suffix)
"RTN","RGUTSTX1",42,0)
INDIR2 I +$G(CIAPN(CIAPN,"@"))'>0 S CIAERR=2
"RTN","RGUTSTX1",43,0)
 E  I '$$NEXT("(") S CIAERR=2
"RTN","RGUTSTX1",44,0)
 E  D
"RTN","RGUTSTX1",45,0)
 .S CIAPN(CIAPN,"@")=-(CIAPN(CIAPN,"@")>1)
"RTN","RGUTSTX1",46,0)
 .D PLIST()
"RTN","RGUTSTX1",47,0)
 Q
"RTN","RGUTSTX1",48,0)
 ; Intrinsic function/system variable
"RTN","RGUTSTX1",49,0)
FCN G:$$NEXT("$") EXT
"RTN","RGUTSTX1",50,0)
INT N CIAZ,CIAZ1
"RTN","RGUTSTX1",51,0)
 S CIAZ1=$E(CIAM,CIAPSN),CIAZ=$$INT^RGUTSTX0(.CIAPSN),CIAF=1
"RTN","RGUTSTX1",52,0)
 I 'CIAERR,$$NEXT("(") D PLIST(CIAZ)
"RTN","RGUTSTX1",53,0)
 Q
"RTN","RGUTSTX1",54,0)
 ; Extrinsic function
"RTN","RGUTSTX1",55,0)
EXT S:'$$NEXT(U,0) CIAPSN=$$LABEL^RGUTSTX0
"RTN","RGUTSTX1",56,0)
 Q:CIAERR
"RTN","RGUTSTX1",57,0)
 S:$$NEXT(U) CIAPSN=$$LABEL^RGUTSTX0
"RTN","RGUTSTX1",58,0)
 Q:CIAERR
"RTN","RGUTSTX1",59,0)
 D:$$NEXT("(") PLIST(".;0-999")
"RTN","RGUTSTX1",60,0)
 S CIAF=1
"RTN","RGUTSTX1",61,0)
 Q
"RTN","RGUTSTX1",62,0)
 ; Unary operator
"RTN","RGUTSTX1",63,0)
UNARY Q
"RTN","RGUTSTX1",64,0)
 ; String literal
"RTN","RGUTSTX1",65,0)
QT D QT2
"RTN","RGUTSTX1",66,0)
 S CIAF=1
"RTN","RGUTSTX1",67,0)
 Q
"RTN","RGUTSTX1",68,0)
 ; Find matching quote
"RTN","RGUTSTX1",69,0)
QT2 F CIAPSN=CIAPSN:1:CIALEN I $$NEXT(CIAQT),'$$NEXT(CIAQT,0) Q
"RTN","RGUTSTX1",70,0)
 S:$E(CIAM,CIAPSN-1)'=CIAQT CIAERR=9
"RTN","RGUTSTX1",71,0)
 Q
"RTN","RGUTSTX1",72,0)
 ; Numeric constant
"RTN","RGUTSTX1",73,0)
NUM N CIAZ,CIAZ1
"RTN","RGUTSTX1",74,0)
 S CIAZ=0,CIAF=1
"RTN","RGUTSTX1",75,0)
 F CIAPSN=CIAPSN-1:1 S CIAZ1=$E(CIAM,CIAPSN) D @("NUM"_CIAZ) Q:CIAZ<0
"RTN","RGUTSTX1",76,0)
 S:CIAZ=-2 CIAERR=2
"RTN","RGUTSTX1",77,0)
 Q
"RTN","RGUTSTX1",78,0)
NUM0 S CIAZ=$S(CIAZ1?1N:1,CIAZ1=".":2,1:-2)
"RTN","RGUTSTX1",79,0)
 Q
"RTN","RGUTSTX1",80,0)
NUM1 S CIAZ=$S(CIAZ1?1N:1,CIAZ1=".":3,1:-1)
"RTN","RGUTSTX1",81,0)
 Q
"RTN","RGUTSTX1",82,0)
NUM2 S CIAZ=$S(CIAZ1?1N:3,1:-2)
"RTN","RGUTSTX1",83,0)
 Q
"RTN","RGUTSTX1",84,0)
NUM3 S CIAZ=$S(CIAZ1?1N:3,CIAZ1="E":4,1:-1)
"RTN","RGUTSTX1",85,0)
 Q
"RTN","RGUTSTX1",86,0)
NUM4 S CIAZ=$S(CIAZ1="+":5,CIAZ1="-":5,CIAZ1=".":7,CIAZ1?1N:6,1:-2)
"RTN","RGUTSTX1",87,0)
 Q
"RTN","RGUTSTX1",88,0)
NUM5 S CIAZ=$S(CIAZ1?1N:6,CIAZ1=".":7,1:-2)
"RTN","RGUTSTX1",89,0)
 Q
"RTN","RGUTSTX1",90,0)
NUM6 S CIAZ=$S(CIAZ1?1N:6,CIAZ1=".":8,1:-1)
"RTN","RGUTSTX1",91,0)
 Q
"RTN","RGUTSTX1",92,0)
NUM7 S CIAZ=$S(CIAZ1?1N:8,1:-2)
"RTN","RGUTSTX1",93,0)
 Q
"RTN","RGUTSTX1",94,0)
NUM8 S CIAZ=$S(CIAZ1?1N:8,1:-1)
"RTN","RGUTSTX1",95,0)
 Q
"RTN","RGUTSTX1",96,0)
 ; Open parenthesis
"RTN","RGUTSTX1",97,0)
OPNPAR S CIAPN=CIAPN+1
"RTN","RGUTSTX1",98,0)
 K CIAPN(CIAPN)
"RTN","RGUTSTX1",99,0)
 Q
"RTN","RGUTSTX1",100,0)
 ; Period (variable by reference or FP number)
"RTN","RGUTSTX1",101,0)
DOT I CIAEX[".",$E(CIAM,CIAPSN)'?1N D
"RTN","RGUTSTX1",102,0)
 .I '$$NEXT("@") S CIAPSN=$$NAME^RGUTSTX0(CIAPSN,"%"),CIAF=-1
"RTN","RGUTSTX1",103,0)
 .E  D INDIR
"RTN","RGUTSTX1",104,0)
 E  D NUM
"RTN","RGUTSTX1",105,0)
 Q
"RTN","RGUTSTX1",106,0)
 ; Variable name
"RTN","RGUTSTX1",107,0)
VAR S CIAPSN=$$NAME^RGUTSTX0(CIAPSN-1,"%"),CIAF=1
"RTN","RGUTSTX1",108,0)
 D:$$NEXT("(") PLIST()
"RTN","RGUTSTX1",109,0)
 Q
"RTN","RGUTSTX1",110,0)
 ; Closing parenthesis
"RTN","RGUTSTX1",111,0)
CLSPAR I 'CIAPN,CIAEX[")" G DONE
"RTN","RGUTSTX1",112,0)
 I CIAPN S CIAPN=CIAPN-1
"RTN","RGUTSTX1",113,0)
 E  S CIAERR=3
"RTN","RGUTSTX1",114,0)
 Q
"RTN","RGUTSTX1",115,0)
 ; Right bracket (] or ]])
"RTN","RGUTSTX1",116,0)
RBRKT I 'CIAPN,CIAEX["]" G DONE
"RTN","RGUTSTX1",117,0)
 I $$NEXT(CIAC)
"RTN","RGUTSTX1",118,0)
 ; Binary operator
"RTN","RGUTSTX1",119,0)
BINARY S CIAF=0
"RTN","RGUTSTX1",120,0)
 Q
"RTN","RGUTSTX1",121,0)
 ; Colon operand
"RTN","RGUTSTX1",122,0)
COLON2 S:CIAEX'["M" CIAERR=6
"RTN","RGUTSTX1",123,0)
 Q
"RTN","RGUTSTX1",124,0)
 ; Colon operator
"RTN","RGUTSTX1",125,0)
COLON G:CIAEX'[":" DONE
"RTN","RGUTSTX1",126,0)
 S CIAF=0
"RTN","RGUTSTX1",127,0)
 S:CIAEX'["M" CIAEX=$TR(CIAEX,":")
"RTN","RGUTSTX1",128,0)
 Q
"RTN","RGUTSTX1",129,0)
 ; Pattern match
"RTN","RGUTSTX1",130,0)
PTRN N CIAZ,CIAZ1
"RTN","RGUTSTX1",131,0)
 I $$NEXT("@") S CIAF=0 Q
"RTN","RGUTSTX1",132,0)
 S CIAZ=CIAPSN,@$$TRAP^RGUTOS("PERR^RGUTSTX1"),CIAZ1=0
"RTN","RGUTSTX1",133,0)
 F  D  Q:CIAZ1<0!CIAERR
"RTN","RGUTSTX1",134,0)
 .D QT2:$$NEXT(CIAQT),PTRN1:$$NEXT("("),PTRN2:$$NEXT(")")
"RTN","RGUTSTX1",135,0)
 .I CIAZ1,$$NEXT(",")
"RTN","RGUTSTX1",136,0)
 .S:'$$NEXT("ACELNPU.0123456789") CIAZ1=-1
"RTN","RGUTSTX1",137,0)
 S:'CIAERR CIAZ=CIAZ?@$E(CIAM,CIAZ,CIAPSN-1)
"RTN","RGUTSTX1",138,0)
 Q
"RTN","RGUTSTX1",139,0)
PTRN1 S CIAZ1=CIAZ1+1
"RTN","RGUTSTX1",140,0)
 Q
"RTN","RGUTSTX1",141,0)
PTRN2 S CIAZ1=CIAZ1-1
"RTN","RGUTSTX1",142,0)
 S:CIAZ1<0 CIAPSN=CIAPSN-1
"RTN","RGUTSTX1",143,0)
 Q
"RTN","RGUTSTX1",144,0)
PERR S CIAERR=10
"RTN","RGUTSTX1",145,0)
 Q
"RTN","RGUTSTX1",146,0)
 ; Process a parameter list
"RTN","RGUTSTX1",147,0)
PLIST(CIAP,CIAT) ;
"RTN","RGUTSTX1",148,0)
 N CIAC,CIAP1,CIAP2,CIAZ
"RTN","RGUTSTX1",149,0)
 S CIAT=$G(CIAT,")"),CIAP=$G(CIAP,";0-999"),CIAP2=$P(CIAP,";",2),CIAP1=+CIAP2,CIAP2=+$P(CIAP2,"-",2),CIAC=0,CIAZ=$P(CIAP,";")
"RTN","RGUTSTX1",150,0)
 I '$$NEXT(CIAT,0) D
"RTN","RGUTSTX1",151,0)
 .F CIAC=1:1 D  Q:CIAERR!'$$NEXT(",")
"RTN","RGUTSTX1",152,0)
 ..D @("PL"_$P(CIAP,";",CIAC+2))
"RTN","RGUTSTX1",153,0)
 I 'CIAERR,CIAC<CIAP1!(CIAC>CIAP2) S CIAERR=8
"RTN","RGUTSTX1",154,0)
 I 'CIAERR,'$$NEXT(CIAT) S CIAERR=3
"RTN","RGUTSTX1",155,0)
 Q
"RTN","RGUTSTX1",156,0)
PL N CIAEX
"RTN","RGUTSTX1",157,0)
 I CIAZ=".",$$NEXT(",",0) Q
"RTN","RGUTSTX1",158,0)
 S CIAEX=CIAT_CIAZ
"RTN","RGUTSTX1",159,0)
 D EXP(.CIAEX)
"RTN","RGUTSTX1",160,0)
 I CIAZ[":",CIAEX[":" S CIAERR=2
"RTN","RGUTSTX1",161,0)
 Q
"RTN","RGUTSTX1",162,0)
PLV D LVAL^RGUTSTX0("LG")
"RTN","RGUTSTX1",163,0)
 Q
"RTN","RGUTSTX1",164,0)
PLL D LBL1^RGUTSTX0()
"RTN","RGUTSTX1",165,0)
 Q
"RTN","RGUTSTX1",166,0)
 ; Get next character
"RTN","RGUTSTX1",167,0)
NEXT(CIAC,CIAI) ;
"RTN","RGUTSTX1",168,0)
 Q $$NEXT^RGUTSTX0(CIAC,.CIAI)
"RTN","RGUTTSK")
0^57^B1046191
"RTN","RGUTTSK",1,0)
RGUTTSK ;RG/IND/DKM - Encapsulates TaskMan API ;04-May-2006 08:19;DKM
"RTN","RGUTTSK",2,0)
 ;;3.0;RG UTILITIES;;Mar 20, 2007;Build 98
"RTN","RGUTTSK",3,0)
 ;;
"RTN","RGUTTSK",4,0)
 ;=================================================================
"RTN","RGUTTSK",5,0)
QUEUE(ZTRTN,ZTDESC,ZTDTH,ZTSAVE,ZTIO,ZTUCI,ZTPRI) ;
"RTN","RGUTTSK",6,0)
 N %CIAZ,%CIAZ1,%CIAZ2,ZTKIL,ZTSK,ZTCPU
"RTN","RGUTTSK",7,0)
 S:'$G(ZTDTH) ZTDTH=$H
"RTN","RGUTTSK",8,0)
 S:ZTDTH'?1.N1","1.N ZTDTH=$$FMTH^XLFDT(ZTDTH)
"RTN","RGUTTSK",9,0)
 Q:ZTDTH<0 0
"RTN","RGUTTSK",10,0)
 S:$G(ZTUCI)'="" ZTUCI=$TR(ZTUCI,":",","),ZTCPU=$P(ZTUCI,",",2),ZTUCI=$P(ZTUCI,",")
"RTN","RGUTTSK",11,0)
 S ZTSAVE=$G(ZTSAVE),ZTIO=$G(ZTIO),U="^"
"RTN","RGUTTSK",12,0)
 F %CIAZ=1:1:$L(ZTSAVE,U) D
"RTN","RGUTTSK",13,0)
 .S %CIAZ1=$P(ZTSAVE,U,%CIAZ),%CIAZ2=$P(%CIAZ1,"=",2,999),%CIAZ1=$P(%CIAZ1,"=")
"RTN","RGUTTSK",14,0)
 .S:%CIAZ1'="" ZTSAVE(%CIAZ1)=%CIAZ2
"RTN","RGUTTSK",15,0)
 D ^%ZTLOAD
"RTN","RGUTTSK",16,0)
 Q +$G(ZTSK)
"RTN","RGUTUSR")
0^58^B4180510
"RTN","RGUTUSR",1,0)
RGUTUSR ;RG/IND/DKM - Parse recipient list;04-May-2006 08:19;DKM
"RTN","RGUTUSR",2,0)
 ;;3.0;RG UTILITIES;;Mar 20, 2007;Build 98
"RTN","RGUTUSR",3,0)
 ;;
"RTN","RGUTUSR",4,0)
 ;=================================================================
"RTN","RGUTUSR",5,0)
 ; Takes a list of recipients (which may be DUZ #'s, names,
"RTN","RGUTUSR",6,0)
 ; mail groups, or special tokens) as input and produces an
"RTN","RGUTUSR",7,0)
 ; array of DUZ's as output.  If a list element is found in
"RTN","RGUTUSR",8,0)
 ; in the token list CIALST, the value of the token entry will
"RTN","RGUTUSR",9,0)
 ; be substituted.
"RTN","RGUTUSR",10,0)
 ; Inputs:
"RTN","RGUTUSR",11,0)
 ;     RGUTSR = Semicolon-delimited list of recipients
"RTN","RGUTUSR",12,0)
 ;     CIALST = Special token list
"RTN","RGUTUSR",13,0)
 ; Outputs:
"RTN","RGUTUSR",14,0)
 ;     CIAOUT = Local array to receive DUZ list
"RTN","RGUTUSR",15,0)
 ;=================================================================
"RTN","RGUTUSR",16,0)
ENTRY(RGUTSR,CIAOUT,CIALST) ;
"RTN","RGUTUSR",17,0)
 N CIAZ,CIAZ1,CIAZ2
"RTN","RGUTUSR",18,0)
 K CIAOUT
"RTN","RGUTUSR",19,0)
 F CIAZ=1:1:$L(RGUTSR,";") S CIAZ1=$P(RGUTSR,";",CIAZ) D:CIAZ1'=""  S:CIAZ1 CIAOUT(+CIAZ1)=""
"RTN","RGUTUSR",20,0)
 .S:$D(CIALST(CIAZ1)) CIAZ1=CIALST(CIAZ1)
"RTN","RGUTUSR",21,0)
 .Q:CIAZ1?.N
"RTN","RGUTUSR",22,0)
 .I CIAZ1?1"-"1.N D MGRP(-CIAZ1) S CIAZ1=0 Q
"RTN","RGUTUSR",23,0)
 .S CIAZ2=$E(CIAZ1,1,2)
"RTN","RGUTUSR",24,0)
 .I CIAZ2="G." D MGRP($E(CIAZ1,3,999)) Q
"RTN","RGUTUSR",25,0)
 .I CIAZ2="L." D LIST($E(CIAZ1,3,999)) Q
"RTN","RGUTUSR",26,0)
 .S CIAZ1=$$LKP(CIAZ1)
"RTN","RGUTUSR",27,0)
 Q
"RTN","RGUTUSR",28,0)
LKP(CIANAME) ;
"RTN","RGUTUSR",29,0)
 N CIAZ,CIAZ1
"RTN","RGUTUSR",30,0)
 I $D(^VA(200,"B",CIANAME)) S CIAZ=CIANAME G L1
"RTN","RGUTUSR",31,0)
 S CIAZ=$O(^(CIANAME)),CIAZ1=$O(^(CIAZ))
"RTN","RGUTUSR",32,0)
 Q:(CIAZ="")!(CIANAME'=$E(CIAZ,1,$L(CIANAME))) 0
"RTN","RGUTUSR",33,0)
 Q:(CIAZ1'="")&(CIANAME=$E(CIAZ1,1,$L(CIANAME))) 0
"RTN","RGUTUSR",34,0)
L1 S CIAZ1=$O(^(CIAZ,0)),CIAZ=$O(^(CIAZ1))
"RTN","RGUTUSR",35,0)
 Q:'CIAZ1!CIAZ 0
"RTN","RGUTUSR",36,0)
 Q CIAZ1
"RTN","RGUTUSR",37,0)
LIST(CIALIST) ;
"RTN","RGUTUSR",38,0)
 Q:CIALIST=""
"RTN","RGUTUSR",39,0)
 S:CIALIST'=+CIALIST CIALIST=+$O(^CCCDSS(25193.6,"B",CIALIST,0))
"RTN","RGUTUSR",40,0)
 S @$$TRAP^RGUTOS("LERR^RGUTUSR")
"RTN","RGUTUSR",41,0)
 X:$D(^CCCDSS(25193.6,CIALIST,1)) ^(1)
"RTN","RGUTUSR",42,0)
LERR Q
"RTN","RGUTUSR",43,0)
MGRP(CIAMGRP) ;
"RTN","RGUTUSR",44,0)
 N CIAX
"RTN","RGUTUSR",45,0)
 S CIAX(0)=""
"RTN","RGUTUSR",46,0)
 D MGRP2(CIAMGRP)
"RTN","RGUTUSR",47,0)
 Q
"RTN","RGUTUSR",48,0)
MGRP2(CIAMGRP) ;
"RTN","RGUTUSR",49,0)
 N CIAZ,CIAZ1
"RTN","RGUTUSR",50,0)
 Q:CIAMGRP=""
"RTN","RGUTUSR",51,0)
 S:CIAMGRP'=+CIAMGRP CIAMGRP=+$O(^XMB(3.8,"B",CIAMGRP,0))
"RTN","RGUTUSR",52,0)
 Q:$D(CIAX(CIAMGRP))
"RTN","RGUTUSR",53,0)
 S CIAX(CIAMGRP)=""
"RTN","RGUTUSR",54,0)
 F CIAZ=0:0 S CIAZ=+$O(^XMB(3.8,CIAMGRP,1,CIAZ)) Q:'CIAZ  S CIAOUT(+^(CIAZ,0))=""
"RTN","RGUTUSR",55,0)
 F CIAZ=0:0 S CIAZ=+$O(^XMB(3.8,CIAMGRP,5,CIAZ)) Q:'CIAZ  D MGRP2(^(CIAZ,0))
"RTN","RGUTUSR",56,0)
 Q
"RTN","RGUTUU")
0^59^B2050600
"RTN","RGUTUU",1,0)
RGUTUU ;RG/IND/DKM - UUEncode and UUDecode functions.;04-May-2006 08:19;DKM
"RTN","RGUTUU",2,0)
 ;;3.0;RG UTILITIES;;Mar 20, 2007;Build 98
"RTN","RGUTUU",3,0)
 ;;
"RTN","RGUTUU",4,0)
 ;=================================================================
"RTN","RGUTUU",5,0)
ENCODE(X) ;
"RTN","RGUTUU",6,0)
 N CIAZ,CIAZ1,CIAZ2,CIAZ3,CIAZ4,CIAZ5,CIAZ6
"RTN","RGUTUU",7,0)
 S CIAZ=$$INIT,CIAZ1=""
"RTN","RGUTUU",8,0)
 F CIAZ2=1:3:$L(X) D
"RTN","RGUTUU",9,0)
 .S CIAZ3=0,CIAZ6=""
"RTN","RGUTUU",10,0)
 .F CIAZ4=0:1:2 D
"RTN","RGUTUU",11,0)
 ..S CIAZ5=$A(X,CIAZ2+CIAZ4),CIAZ3=CIAZ3*256+$S(CIAZ5<0:0,1:CIAZ5)
"RTN","RGUTUU",12,0)
 .F CIAZ4=1:1:4 S CIAZ6=$E(CIAZ,CIAZ3#64+2)_CIAZ6,CIAZ3=CIAZ3\64
"RTN","RGUTUU",13,0)
 .S CIAZ1=CIAZ1_CIAZ6
"RTN","RGUTUU",14,0)
 S CIAZ2=$L(X)#3
"RTN","RGUTUU",15,0)
 S:CIAZ2 CIAZ3=$L(CIAZ1),$E(CIAZ1,CIAZ3-2+CIAZ2,CIAZ3)=$E("==",CIAZ2,2)
"RTN","RGUTUU",16,0)
 Q CIAZ1
"RTN","RGUTUU",17,0)
DECODE(X) ;
"RTN","RGUTUU",18,0)
 N CIAZ,CIAZ1,CIAZ2,CIAZ3,CIAZ4,CIAZ5,CIAZ6
"RTN","RGUTUU",19,0)
 S CIAZ=$$INIT,CIAZ1=""
"RTN","RGUTUU",20,0)
 F CIAZ2=1:4:$L(X) D
"RTN","RGUTUU",21,0)
 .S CIAZ3=0,CIAZ6=""
"RTN","RGUTUU",22,0)
 .F CIAZ4=0:1:3 D
"RTN","RGUTUU",23,0)
 ..S CIAZ5=$F(CIAZ,$E(X,CIAZ2+CIAZ4))-3
"RTN","RGUTUU",24,0)
 ..S CIAZ3=CIAZ3*64+$S(CIAZ5<0:0,1:CIAZ5)
"RTN","RGUTUU",25,0)
 .F CIAZ4=0:1:2 S CIAZ6=$C(CIAZ3#256)_CIAZ6,CIAZ3=CIAZ3\256
"RTN","RGUTUU",26,0)
 .S CIAZ1=CIAZ1_CIAZ6
"RTN","RGUTUU",27,0)
 Q $E(CIAZ1,1,$L(CIAZ1)-$L(X,"=")+1)
"RTN","RGUTUU",28,0)
INIT() Q "=ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"
"RTN","RGXY")
1^73
"RTN","RGZOSF")
1^74
"VER")
8.0^22.0
**END**
**END**
